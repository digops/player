window.VASTPlayer=(function(){var c={};function j(A,B){var e=new RegExp("(^|\\s)"+B+"(\\s|$)","g");if(e.test(A.className)){return}A.className=(A.className+" "+B).replace(/\s+/g," ").replace(/(^ | $)/g,"")}function l(A,B){var e=new RegExp("(^|\\s)"+B+"(\\s|$)","g");A.className=A.className.replace(e,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function b(A,B){var e=new RegExp("(^|\\s)"+B+"(\\s|$)","g");return e.test(A.className)}function w(B,A){if(B){for(var e=0;e<B.length;e++){if(A(B[e])===false){break}}}}function k(B){var A=[];for(var e in B){if(B.hasOwnProperty(e)){A.push(e)}}return A}function r(e){return typeof e==="object"&&e!==null&&e.constructor===Object}function z(e){return e?(r(e)?k(e).length==0:e.length==0):true}function p(A,e){w(k(e),function(B){if(r(A[B])&&r(e[B])&&!z(A[B])){p(A[B],e[B])}else{if(typeof A[B]!=="undefined"){A[B]=e[B]}}});return A}function u(A,e){w(k(e),function(B){if(r(A[B])&&r(e[B])&&!z(A[B])){u(A[B],e[B])}else{A[B]=e[B]}});return A}function y(B,A){for(var e=0;e<B.length;e++){if(!A(B[e])){return false}}return true}function g(G,E,D,C){if(E instanceof Array){for(var A=0;A<E.length;A++){g(G,E[A],D,C)}}else{var F=E.split(".")[0];var e=E.split(".")[1]||null;var B=function(H){if(D.call(C?C:G,H)===false){H.stopPropagation();H.preventDefault()}};if(!G.__events){G.__events={}}G.__events=G.__events||{};G.__events[F]=G.__events[F]||[];G.__events[F].push({tag:e,handler:B});G.addEventListener(F,B,false)}}function x(E,C){if(C instanceof Array){for(var B=0;B<C.length;B++){x(E,C[B])}}else{var D=C.split(".")[0];var e=C.split(".")[1]||null;var A=E.__events[D];for(var B=0;B<A.length;B++){if(A[B]&&(e===null||A[B].tag==e)){E.removeEventListener(D,A[B].handler,false);A[B]=null}}}}function i(A){var B=document.createElement("DIV");B.innerHTML=A;return B.firstChild}function v(){var e=navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description;return !!e}function s(B,e){var A={};w(document.cookie.split(";"),function(C){var D=C.split("=");if(D.length==2){A[D[0].trim()]=D[1].trim()}});return A[B]&&!isNaN(A[B])?A[B]:e}function m(e,A){document.cookie=e+"="+A+"; path=/"}function a(){if(window.XDomainRequest){return new XDomainRequest()}else{if(window.XMLHttpRequest){return new XMLHttpRequest()}else{return false}}}function f(B,E){var A=this;var D=a();D.onload=function(){if(!D.responseXML){D.responseXML=(new DOMParser).parseFromString(D.responseText,"text/xml")}if(E){setTimeout(function(){E(true,D)},0)}};D.onerror=function(){if(E){E(false,D)}};D.open("GET",B,true);try{D.send(null)}catch(C){}return D}function q(e,A){var B=a();B.open("POST",e,true);B.send(A)}function d(){var e,A={};if(e=navigator.userAgent.match(/\bandroid\s(\d+)\.(\d+)(\.(\d+))?\b/i)){A.is_android=true;A.version=[e[1]|0,e[2]|0,e[4]|0]}else{if(/iPhone/.test(navigator.platform)||/iPhone/.test(navigator.userAgent)){A.is_iphone=true}else{if(/iPad/.test(navigator.platform)||/iPad/.test(navigator.userAgent)){A.is_ipad=true}else{if(/iPod/.test(navigator.platform)||/iPod/.test(navigator.userAgent)){A.is_ipod=true}}}}A.is_mobile=A.is_android||A.is_iphone||A.is_ipad||A.is_ipod;return A}var n={enable:false,on:function(){this.enable=true},off:function(){this.enable=false},log:function(){if(this.enable){var B=new Date;var e=("0"+B.getHours()).substr(-2)+":"+("0"+B.getMinutes()).substr(-2)+":"+("0"+B.getSeconds()).substr(-2);var A="[DEBUG]["+e+"]"+[].join.call(arguments," ");console.info(A)}}};CustomObject={proxy:function(A,B){if(A instanceof Array){for(var e=0;e<A.length;e++){this.proxy(A[e],B)}}else{this.on(A,function(){var C=Array.prototype.splice.call(arguments,1);B.trigger.apply(B,[A].concat(C))})}},one:function(B,A,e){this.on(B,function(C){C.handler.remove();A.apply(this,arguments)},e)},on:function(D,C,B){var e=this;this._handlers=this._handlers||{};if(D instanceof Array){for(var A=0;A<D.length;A++){this.on(D[A],C,B)}}else{if(typeof this._handlers[D]==="undefined"){this._handlers[D]=[]}this._handlers[D].push({handler:C,scope:B||this,remove:function(){for(var E=0;E<e._handlers[D].length;E++){if(e._handlers[D][E]===this){e._handlers[D][E]=null}}}})}return this},off:function(A){if(A=="*"){this._handlers={}}else{this._handlers=this._handlers||{};A=A instanceof Array?A:[A];for(var e=0;e<A.length;e++){var B=A[e];if(typeof this._handlers[B]!=="undefined"){delete this._handlers[B]}}}},trigger:function(D){this._handlers=this._handlers||{};var B=Array.prototype.splice.call(arguments,1);var e=(this._handlers[D]||[]).concat(this._handlers["*"]||[]);for(var C=0;C<e.length;C++){if(h=e[C]){var A=h.handler.apply(h.scope,[{type:D,handler:h}].concat(B));if(A===false){break}}}return this},triggerAsync:function(B){var e=this;var A=Array.prototype.splice.call(arguments,1);setTimeout(function(){e.trigger.apply(e,[B].concat(A))})}};(function t(A,E,C){function B(J,H){if(!E[J]){if(!A[J]){var G=typeof require=="function"&&require;if(!H&&G){return G(J,!0)}if(e){return e(J,!0)}var I=new Error("Cannot find module '"+J+"'");throw I.code="MODULE_NOT_FOUND",I}var F=E[J]={exports:{}};A[J][0].call(F.exports,function(K){var L=A[J][1][K];return B(L?L:K)},F,F.exports,t,A,E,C)}return E[J].exports}var e=typeof require=="function"&&require;for(var D=0;D<C.length;D++){B(C[D])}return B})({1:[function(E,e,Q){var H=e.exports={};var I;var K;function F(){throw new Error("setTimeout has not been defined")}function O(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){I=setTimeout}else{I=F}}catch(R){I=F}try{if(typeof clearTimeout==="function"){K=clearTimeout}else{K=O}}catch(R){K=O}}());function D(R){if(I===setTimeout){return setTimeout(R,0)}if((I===F||!I)&&setTimeout){I=setTimeout;return setTimeout(R,0)}try{return I(R,0)}catch(S){try{return I.call(null,R,0)}catch(S){return I.call(this,R,0)}}}function C(R){if(K===clearTimeout){return clearTimeout(R)}if((K===O||!K)&&clearTimeout){K=clearTimeout;return clearTimeout(R)}try{return K(R)}catch(S){try{return K.call(null,R)}catch(S){return K.call(this,R)}}}var L=[];var P=false;var G;var M=-1;function J(){if(!P||!G){return}P=false;if(G.length){L=G.concat(L)}else{M=-1}if(L.length){N()}}function N(){if(P){return}var S=D(J);P=true;var R=L.length;while(R){G=L;L=[];while(++M<R){if(G){G[M].run()}}M=-1;R=L.length}G=null;P=false;C(S)}H.nextTick=function(R){var S=new Array(arguments.length-1);if(arguments.length>1){for(var T=1;T<arguments.length;T++){S[T-1]=arguments[T]}}L.push(new A(R,S));if(L.length===1&&!P){D(N)}};function A(R,S){this.fun=R;this.array=S}A.prototype.run=function(){this.fun.apply(null,this.array)};H.title="browser";H.browser=true;H.env={};H.argv=[];H.version="";H.versions={};function B(){}H.on=B;H.addListener=B;H.once=B;H.off=B;H.removeListener=B;H.removeAllListeners=B;H.emit=B;H.prependListener=B;H.prependOnceListener=B;H.listeners=function(R){return[]};H.binding=function(R){throw new Error("process.binding is not supported")};H.cwd=function(){return"/"};H.chdir=function(R){throw new Error("process.chdir is not supported")};H.umask=function(){return 0}},{}],2:[function(A,B,e){(function(H){Function.prototype.$asyncbind=function G(M,L){var P=this;if(L===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function K(T){var U=[];if(!T){try{T=H.nextTick}catch(S){T=function(W){setTimeout(W,0)}}}function Q(){for(var Y=0;Y<U.length;Y+=2){var X=U[Y+1],Z=U[Y];for(var W=0;W<X.length;W++){X[W].call(null,Z)}}U=[]}function V(W){return W&&(W instanceof Object)&&typeof W.then==="function"}function R(Y){function ab(ai){var ah;if(ac||af<0||(ah=ae[af]).length===0){return}U.push(ag,ah);ae=[[],[]];if(U.length===2){ai?Q():T(Q)}}function W(ah){if(af>=0){return}if(V(ah)){return ah.then(W,aa)}af=0;ag=ah;ab(true)}function aa(ah){if(af>=0){return}if(V(ah)){return ah.then(W,aa)}af=1;ag=ah;ab(true)}function Z(ai,ah){ae[0].push(ai);ae[1].push(ah);ab()}function X(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[af]+"}="+ag.toString()}function ad(){try{Y.call(null,W,aa)}catch(ah){aa(ah)}}this.then=Z;this.toString=X;var ae=[[],[]],ac=true,af=-1,ag;ad();ac=false;ab()}R.resolve=function(W){return V(W)?W:{then:function(Y,X){return Y(W)}}};return R}()}return new (Function.prototype.$asyncbind.EagerThenable)(N)}if(L){if(Function.prototype.$asyncbind.wrapAsyncStack){L=Function.prototype.$asyncbind.wrapAsyncStack(L)}return O}function O(Q,R){try{return Q&&(Q instanceof Object)&&typeof Q.then==="function"?Q.then(O,L):P.call(M,Q,R||L)}catch(S){return(R||L)(S)}}function N(Q,R){return P.call(M,Q,R)}N.then=N;return N};window.$error=window.$error||function(K){throw K};var I=A("./lib.js");var C=A("./Exceptions.js");var D=A("./VPAIDPlayer.js");var J=A("./VideoPlayer.js");var E=A("./StaticPlayer.js");B.exports=F;function F(K){this.place=null;this.creative=null;this.player=null;this.video_player=K.video_player||null;this.vpaid_flash_bridge=K.vpaid_flash_bridge||null;this.flash_video_player=K.flash_video_player||null;this.can_use={};this.can_use.flash=I.flash_support();this.can_use.flash_vpaid=this.can_use.flash&&!(!this.vpaid_flash_bridge);this.can_use.flash_video=this.can_use.flash&&!(!this.flash_video_player);this.timeout={mount:10000,start:10000};if(K.timeout){if(typeof K.timeout.mount!=="undefined"){this.timeout.mount=K.timeout.mount}if(typeof K.timeout.start!=="undefined"){this.timeout.start=K.timeout.start}}this.is_mounted=false}F.prototype={eventHandler:function(){},mount:function(L,K){return(function(T,V){var X=(function(Y){return(function(Z){clearTimeout(W);return Y&&(Y.call(this,Z))}).$asyncbind(this,V)}).$asyncbind(this);var M,O,R,P,W;if(this.is_mounted){return V(new Error("Creative already mounted"))}this.place=K;this.creative=L;M=[D,J];O={allow_flash:this.can_use.flash_vpaid,video_player:this.video_player,vpaid_flash_bridge:this.vpaid_flash_bridge,flash_video_player:this.flash_video_player};for(R=0;R<M.length;R++){P=M[R];try{this.player=new P(this.creative,O);break}catch(U){this.player=null}}if(!this.player){return V(new C.VPAIDError(403))}this.wrapEventListener(document);this.wrapEventListener(document.body);if(this.video_player){this.wrapEventListener(this.video_player)}if(this.timeout.mount){W=setTimeout((function(){I.debug.log("Timeout for mount creative");return V(new C.VPAIDError(901))}).bind(this),this.timeout.mount)}function S(){this.is_mounted=true;return T()}var N=(function(Y){return X(V)(Y)}).$asyncbind(this,X(V));try{return this.player.mount(this.place).then((function(Y){return X(S).call(this)}).$asyncbind(this,N),N)}catch(Q){N(Q)}}).$asyncbind(this,true)},start:function(){return(function(O,K){var L=(function(R){return(function(S){clearTimeout(N);return R&&(R.call(this,S))}).$asyncbind(this,K)}).$asyncbind(this);var N;if(!this.is_mounted){return K(new Error("Creative must be mount first"))}this.has_events={};I.debug.log("Play "+this.creative.type+" creative");this.player.eventHandler=(function(S,R){if(S=="AdVideoStart"){this.processVPAIDEvent("AdLinearChange",true)}if(S=="AdVideoComplete"){this.processVPAIDEvent("AdLinearChange",false)}this.processVPAIDEvent(S,R)}).bind(this);if(this.timeout.start){N=setTimeout((function(){if(!this.has_events.AdStarted){I.debug.log("Timeout for start creative");return K(new C.VPAIDError(901))}}).bind(this),this.timeout.start)}function M(){I.debug.log("Done "+this.creative.type+" creative");return this.unmount().then((function(R){return O()}).$asyncbind(this,K),K)}var Q=(function(R){return this.player.unmount().then((function(S){return L(K)(R)}).$asyncbind(this,K),K)}).$asyncbind(this,L(K));try{return this.player.start().then((function(R){return L(M).call(this)}).$asyncbind(this,Q),Q)}catch(P){Q(P)}}).$asyncbind(this,true)},unmount:function(){return(function(L,K){I.debug.log("start UNMOUNT CREATIVE");if(!this.is_mounted){return K(new Error("Creative not mounted now"))}return this.player.unmount().then((function(M){this.player=null;this.place=null;this.creative=null;this.files=null;this.eventHandler=F.prototype.eventHandler;this.is_mounted=false;document.removeAllEventListeners();document.body.removeAllEventListeners();if(this.video_player){this.video_player.removeAllEventListeners()}I.debug.log("done UNMOUNT CREATIVE");return L()}).$asyncbind(this,K),K)}).$asyncbind(this,true)},stop:function(){return(function(M,K){function L(){return M()}if(this.is_mounted){return this.player.stop().then((function(N){return L.call(this)}).$asyncbind(this,K),K)}return L.call(this)}).$asyncbind(this,true)},processVPAIDEvent:function(O,L){var Q=["AdImpression","AdStarted","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdSkipped"];var P={AdError:"error",AdImpression:"impression",AdStarted:"creativeView",AdVideoStart:"start",AdVideoFirstQuartile:"firstQuartile",AdVideoMidpoint:"midpoint",AdVideoThirdQuartile:"thirdQuartile",AdVideoComplete:"complete",AdSkipped:"skip",AdClickThru:"clickthru",AdUserAcceptInvitation:"acceptInvitation",AdUserMinimize:"collapse",AdUserClose:"close",AdPaused:"pause",AdPlaying:"resume"};if(Q.indexOf(O)>=0&&this.has_events[O]){return}this.has_events[O]=true;I.debug.log("VPAID event: "+O);if(O=="AdClickThru"&&this.creative.click_thru){var N=L;if(N){I.open_window(this.creative.click_thru)}}var R=this.creative.events[P[O]];if(R){for(var M=0;M<R.length;M++){var K=R[M];I.fire_pixel(K)}}this.eventHandler("vpaid",O,L)},wrapEventListener:function(M){var K=M.addEventListener;var L=[];M.addEventListener=function(O,P,N){L.push({type:O,listener:P});K.call(this,O,P,N)};M.removeAllEventListeners=function(){L.map(function(N){M.removeEventListener(N.type,N.listener)});M.addEventListener=K}}}}).call(this,A("_process"))},{"./Exceptions.js":3,"./StaticPlayer.js":4,"./VPAIDPlayer.js":7,"./VideoPlayer.js":9,"./lib.js":10,_process:1}],3:[function(A,B,e){(function(F){Function.prototype.$asyncbind=function E(I,H){var L=this;if(H===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function G(P){var Q=[];if(!P){try{P=F.nextTick}catch(O){P=function(S){setTimeout(S,0)}}}function M(){for(var U=0;U<Q.length;U+=2){var T=Q[U+1],V=Q[U];for(var S=0;S<T.length;S++){T[S].call(null,V)}}Q=[]}function R(S){return S&&(S instanceof Object)&&typeof S.then==="function"}function N(U){function X(ae){var ad;if(Y||ab<0||(ad=aa[ab]).length===0){return}Q.push(ac,ad);aa=[[],[]];if(Q.length===2){ae?M():P(M)}}function S(ad){if(ab>=0){return}if(R(ad)){return ad.then(S,W)}ab=0;ac=ad;X(true)}function W(ad){if(ab>=0){return}if(R(ad)){return ad.then(S,W)}ab=1;ac=ad;X(true)}function V(ae,ad){aa[0].push(ae);aa[1].push(ad);X()}function T(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[ab]+"}="+ac.toString()}function Z(){try{U.call(null,S,W)}catch(ad){W(ad)}}this.then=V;this.toString=T;var aa=[[],[]],Y=true,ab=-1,ac;Z();Y=false;X()}N.resolve=function(S){return R(S)?S:{then:function(U,T){return U(S)}}};return N}()}return new (Function.prototype.$asyncbind.EagerThenable)(J)}if(H){if(Function.prototype.$asyncbind.wrapAsyncStack){H=Function.prototype.$asyncbind.wrapAsyncStack(H)}return K}function K(M,N){try{return M&&(M instanceof Object)&&typeof M.then==="function"?M.then(K,H):L.call(I,M,N||H)}catch(O){return(N||H)(O)}}function J(M,N){return L.call(I,M,N)}J.then=J;return J};window.$error=window.$error||function(G){throw G};function C(){}B.exports.NonLinearVPAID=C;function D(H,G){var I={100:"100 XML parsing error",402:"Timeout of MediaFile URI",403:"Could not find MediaFile that is supported by this video player, based on the attributes of the MediaFile element",901:"General VPAID error"};this.code=H;this.message=G?G:I[H]?I[H]:"Unknown VPAID error"}B.exports.VPAIDError=D}).call(this,A("_process"))},{_process:1}],4:[function(A,B,e){(function(E){Function.prototype.$asyncbind=function D(I,H){var L=this;if(H===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function G(P){var Q=[];if(!P){try{P=E.nextTick}catch(O){P=function(S){setTimeout(S,0)}}}function M(){for(var U=0;U<Q.length;U+=2){var T=Q[U+1],V=Q[U];for(var S=0;S<T.length;S++){T[S].call(null,V)}}Q=[]}function R(S){return S&&(S instanceof Object)&&typeof S.then==="function"}function N(U){function X(ae){var ad;if(Y||ab<0||(ad=aa[ab]).length===0){return}Q.push(ac,ad);aa=[[],[]];if(Q.length===2){ae?M():P(M)}}function S(ad){if(ab>=0){return}if(R(ad)){return ad.then(S,W)}ab=0;ac=ad;X(true)}function W(ad){if(ab>=0){return}if(R(ad)){return ad.then(S,W)}ab=1;ac=ad;X(true)}function V(ae,ad){aa[0].push(ae);aa[1].push(ad);X()}function T(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[ab]+"}="+ac.toString()}function Z(){try{U.call(null,S,W)}catch(ad){W(ad)}}this.then=V;this.toString=T;var aa=[[],[]],Y=true,ab=-1,ac;Z();Y=false;X()}N.resolve=function(S){return R(S)?S:{then:function(U,T){return U(S)}}};return N}()}return new (Function.prototype.$asyncbind.EagerThenable)(J)}if(H){if(Function.prototype.$asyncbind.wrapAsyncStack){H=Function.prototype.$asyncbind.wrapAsyncStack(H)}return K}function K(M,N){try{return M&&(M instanceof Object)&&typeof M.then==="function"?M.then(K,H):L.call(I,M,N||H)}catch(O){return(N||H)(O)}}function J(M,N){return L.call(I,M,N)}J.then=J;return J};window.$error=window.$error||function(G){throw G};var F=A("./lib.js");B.exports=C;function C(H,G){this.file=H;this.methods=G.methods||[];this.click_thru=G.click_thru||null;this.backend=F.sortByMap(this.methods,["native","flash"])[0];this.place=null;this.width=H.width;this.height=H.height}C.getSupportMethods=function(I,J){if(I.is_vpaid){return[]}var H=!(!J.allow_flash);var G=[];if(["image/png","image/jpg","image/jpeg"].indexOf(I.type)>=0){G.push("native")}return G};C.prototype={eventHandler:function(H,G){},mount:function(G){return(function(I,H){this.place=G;return I()}).$asyncbind(this,true)},unmount:function(){return(function(H,G){return H()}).$asyncbind(this,true)},play:function(){return(function(I,J){var M=F.html('<div style="position: absolute"></div>');var O=F.html('<div style="position: absolute">x</div>');var P=F.html("<div></div>");M.appendChild(O);M.appendChild(P);var H=this.place.offsetWidth;var L=this.place.offsetHeight;var K=10;var G=Math.min(this.width,H-K*2);var N=this.height;M.style.width=G+"px";M.style.height=N+"px";M.style.left=(H-G)/2+"px";M.style.bottom=K+"px";P.appendChild(this.create_banner(this.file));this.place.appendChild(M);return I()}).$asyncbind(this,true)},create_banner:function(G){var H=G.type;var I=G.url;if(H=="html"){elm=document.createElement("DIV");elm.innerHTML=I}else{if(H=="iframe"){elm=document.createElement("IFRAME");elm.src=I;elm.style.border="none";elm.scrolling="no"}else{if(H=="application/x-shockwave-flash"){elm=document.createElement("OBJECT");elm.setAttribute("type","application/x-shockwave-flash");elm.setAttribute("data",I)}else{elm=document.createElement("IMG");elm.src=I}}}return elm}}}).call(this,A("_process"))},{"./lib.js":10,_process:1}],5:[function(A,B,e){(function(E){Function.prototype.$asyncbind=function L(Q,P){var T=this;if(P===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function O(X){var Y=[];if(!X){try{X=E.nextTick}catch(W){X=function(aa){setTimeout(aa,0)}}}function U(){for(var ac=0;ac<Y.length;ac+=2){var ab=Y[ac+1],ad=Y[ac];for(var aa=0;aa<ab.length;aa++){ab[aa].call(null,ad)}}Y=[]}function Z(aa){return aa&&(aa instanceof Object)&&typeof aa.then==="function"}function V(ac){function af(am){var al;if(ag||aj<0||(al=ai[aj]).length===0){return}Y.push(ak,al);ai=[[],[]];if(Y.length===2){am?U():X(U)}}function aa(al){if(aj>=0){return}if(Z(al)){return al.then(aa,ae)}aj=0;ak=al;af(true)}function ae(al){if(aj>=0){return}if(Z(al)){return al.then(aa,ae)}aj=1;ak=al;af(true)}function ad(am,al){ai[0].push(am);ai[1].push(al);af()}function ab(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[aj]+"}="+ak.toString()}function ah(){try{ac.call(null,aa,ae)}catch(al){ae(al)}}this.then=ad;this.toString=ab;var ai=[[],[]],ag=true,aj=-1,ak;ah();ag=false;af()}V.resolve=function(aa){return Z(aa)?aa:{then:function(ac,ab){return ac(aa)}}};return V}()}return new (Function.prototype.$asyncbind.EagerThenable)(R)}if(P){if(Function.prototype.$asyncbind.wrapAsyncStack){P=Function.prototype.$asyncbind.wrapAsyncStack(P)}return S}function S(U,V){try{return U&&(U instanceof Object)&&typeof U.then==="function"?U.then(S,P):T.call(Q,U,V||P)}catch(W){return(V||P)(W)}}function R(U,V){return T.call(Q,U,V)}R.then=R;return R};window.$error=window.$error||function(O){throw O};var I=A("./lib.js");var D=A("./Exceptions.js");function J(P,O){return(function(U,Q){var T,V,W;function S(){T.id=P.getAttribute("id")||null;T.sequence=parseInt(P.getAttribute("sequence"))||null;return U(T)}if(V=P.getElementsByTagName("Wrapper")[0]){return H(V,O).then((function(X){T=X;return S.call(this)}).$asyncbind(this,Q),Q)}else{function R(){return S.call(this)}if(W=P.getElementsByTagName("InLine")[0]){return G(W,O).then((function(X){T=X;return R.call(this)}).$asyncbind(this,Q),Q)}else{return Q(new Error("Bad vast xml scheme. Allow only wrapper and inline"))}return R.call(this)}}).$asyncbind(this,true)}function H(P,O){return(function(V,Q){var X,W,S,U,R,T;R=P.getElementsByTagName("VASTAdTagURI")[0].textContent.trim();return N(R,O).then((function(Y){X=Y;if(!X||!X.ads[0]){return Q(new Error("Bad wrapped vast tag "+R))}T=X.ads[0];if(W=P.getElementsByTagName("Error")[0]){C({error:W.textContent.trim()},T.creatives)}if(S=P.getElementsByTagName("Impression")[0]){C({impression:S.textContent.trim()},T.creatives)}if(U=P.getElementsByTagName("Creatives")[0]){I.map(U.getElementsByTagName("Creative"),function(ab,Z){var aa=K(ab.getElementsByTagName("TrackingEvents")[0]);C(aa,[T.creatives[Z]])})}return V(T)}).$asyncbind(this,Q),Q)}).$asyncbind(this,true)}function G(P,O){return(function(U,Q){var V,W,T,R;V={title:null,system:null,creatives:[]};if(title_xml=P.getElementsByTagName("AdTitle")[0]){V.title=title_xml.textContent.trim()}if(system_xml=P.getElementsByTagName("AdSystem")[0]){V.system=system_xml.textContent.trim()}W=P.getElementsByTagName("Creative");T=0;return(function S(Y,X){function Z(){T++;return S(Y,X)}if(T<W.length){return M(W[T],O).then((function(aa){R=aa;V.creatives.push(R);return void Z.call(this)}).$asyncbind(this,X),X)}else{return void Y()}}).$asyncbind(this).then((function(X){if(error_xml=P.getElementsByTagName("Error")[0]){C({error:error_xml.textContent.trim()},V.creatives)}if(impression_xml=P.getElementsByTagName("Impression")[0]){C({impression:impression_xml.textContent.trim()},V.creatives)}V.creatives.sort(function(Z,Y){return Z.sequence-Y.sequence});return U(V)}).$asyncbind(this,Q),Q)}).$asyncbind(this,true)}function M(O){return(function(U,Q){var R={type:null,click_thru:null,ad_params:null,files:[],events:{}};R.id=O.getAttribute("id")||null;R.sequence=parseInt(O.getAttribute("sequence"))||null;if(creative_xml=O.getElementsByTagName("Linear")[0]){R.type="linear";R.skipoffset=(creative_xml.getAttribute("skipoffset")||"").trim()||null;if(ad_parameters_xml=creative_xml.getElementsByTagName("AdParameters")[0]){R.ad_params=ad_parameters_xml.textContent.trim()}I.map(creative_xml.getElementsByTagName("MediaFile"),function(V){var W={};W.url=V.textContent.trim();W.type=(V.getAttribute("type")||"").trim()||null;W.width=parseInt(V.getAttribute("width"))||null;W.height=parseInt(V.getAttribute("height"))||null;W.is_vpaid=(V.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";R.files.push(W)});if(click_through_xml=creative_xml.getElementsByTagName("ClickThrough")[0]){R.click_thru=click_through_xml.textContent.trim()}if(click_tracking_xml=creative_xml.getElementsByTagName("ClickTracking")[0]){C({clickthru:click_tracking_xml.textContent.trim()},R)}}else{if(creative_xml=O.getElementsByTagName("NonLinear")[0]){R.type="nonlinear";var T=parseInt(creative_xml.getAttribute("width"))||null;var P=parseInt(creative_xml.getAttribute("height"))||null;if(static_xml=creative_xml.getElementsByTagName("StaticResource")[0]){var S={};S.url=static_xml.textContent.trim();S.type=(static_xml.getAttribute("creativeType")||"").trim()||null;S.width=T;S.height=P;R.files.push(S)}}else{if(creative_xml=O.getElementsByTagName("Companion")[0]){R.type="campanion"}}}if(creative_xml){C(K(creative_xml.getElementsByTagName("TrackingEvents")[0]),R)}return U(R)}).$asyncbind(this,true)}function F(P,O){return(function(W,Q){var U,X,T,S,V;U={version:null,ads:[]};if(!(P=new DOMParser().parseFromString(P,"text/xml"))){return Q(new Error("Bad xml"))}if(!(X=P.getElementsByTagName("VAST")[0])){return Q(new Error("Bad vast tag. Not found VAST"))}T=X.getElementsByTagName("Ad");S=0;return(function R(aa,Y){function ad(){S++;return R(aa,Y)}if(S<T.length){function ac(){return void ad.call(this)}var Z=(function(ae){console.log(ae);return ac.call(this)}).$asyncbind(this,Y);try{return J(T[S],O).then((function(ae){V=ae;U.ads.push(V);return ac.call(this)}).$asyncbind(this,Z),Z)}catch(ab){Z(ab)}}else{return void aa()}}).$asyncbind(this).then((function(Y){if(T.length==0){return Q(new Error("Bad vast tag. Not found Ad"))}U.ads.sort(function(aa,Z){return aa.sequence-Z.sequence});return W(U)}).$asyncbind(this,Q),Q)}).$asyncbind(this,true)}function N(P,O){return(function(T,Q){var S;O=O||{};var R=(function(V){if(V instanceof I.HTTPError){if(V.status==204){return Q(new D.VPAIDError(303))}}console.log(V);return Q(new D.VPAIDError(100))}).$asyncbind(this,Q);try{return I.asyncLoad(P,O.timeout).then((function(V){S=V;function X(){return T()}var W=(function(Z){console.log(Z);return Q(new D.VPAIDError(100))}).$asyncbind(this,Q);try{return F(S,O).then(T,W)}catch(Y){W(Y)}}).$asyncbind(this,R),R)}catch(U){R(U)}}).$asyncbind(this,true)}function K(O){var P={};if(O&&O.tagName.match(/^TrackingEvents$/i)){I.map(O.getElementsByTagName("Tracking"),function(Q){var S={};var R=Q.getAttribute("event");if(typeof P[R]==="undefined"){P[R]=[]}P[R].push(Q.textContent.trim())})}return P}function C(R,S){var S=S instanceof Array?S:[S];for(var Q in R){var T=R[Q] instanceof Array?R[Q]:[R[Q]];for(var P=0;P<S.length;P++){var O=S[P];O.events[Q]=(O.events[Q]||[]).concat(T)}}}B.exports.parse=F;B.exports.load=N}).call(this,A("_process"))},{"./Exceptions.js":3,"./lib.js":10,_process:1}],6:[function(A,B,e){(function(G){Function.prototype.$asyncbind=function F(L,K){var O=this;if(K===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function J(S){var T=[];if(!S){try{S=G.nextTick}catch(R){S=function(V){setTimeout(V,0)}}}function P(){for(var X=0;X<T.length;X+=2){var W=T[X+1],Y=T[X];for(var V=0;V<W.length;V++){W[V].call(null,Y)}}T=[]}function U(V){return V&&(V instanceof Object)&&typeof V.then==="function"}function Q(X){function aa(ah){var ag;if(ab||ae<0||(ag=ad[ae]).length===0){return}T.push(af,ag);ad=[[],[]];if(T.length===2){ah?P():S(P)}}function V(ag){if(ae>=0){return}if(U(ag)){return ag.then(V,Z)}ae=0;af=ag;aa(true)}function Z(ag){if(ae>=0){return}if(U(ag)){return ag.then(V,Z)}ae=1;af=ag;aa(true)}function Y(ah,ag){ad[0].push(ah);ad[1].push(ag);aa()}function W(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[ae]+"}="+af.toString()}function ac(){try{X.call(null,V,Z)}catch(ag){Z(ag)}}this.then=Y;this.toString=W;var ad=[[],[]],ab=true,ae=-1,af;ac();ab=false;aa()}Q.resolve=function(V){return U(V)?V:{then:function(X,W){return X(V)}}};return Q}()}return new (Function.prototype.$asyncbind.EagerThenable)(M)}if(K){if(Function.prototype.$asyncbind.wrapAsyncStack){K=Function.prototype.$asyncbind.wrapAsyncStack(K)}return N}function N(P,Q){try{return P&&(P instanceof Object)&&typeof P.then==="function"?P.then(N,K):O.call(L,P,Q||K)}catch(R){return(Q||K)(R)}}function M(P,Q){return O.call(L,P,Q)}M.then=M;return M};window.$error=window.$error||function(J){throw J};var I=A("./lib.js");var C=A("./Exceptions.js");var H=A("./VASTParser.js");var E=A("./CreativePlayer.js");B.exports=D;function D(J){if(!J.place){throw new Error("place rquired for VASTPlayer")}this.place=J.place;this.debug=J.debug||false;this.onparse_complete=J.onparse_complete||null;this.timeout={load:5000,mount:30000,start:10000};if(J.timeout){if(typeof J.timeout.load!=="undefined"){this.timeout.load=J.timeout.load}if(typeof J.timeout.mount!=="undefined"){this.timeout.mount=J.timeout.mount}if(typeof J.timeout.start!=="undefined"){this.timeout.start=J.timeout.start}}this.creative_player=new E({video_player:J.video_player||null,vpaid_flash_bridge:J.vpaid_flash_bridge||null,flash_video_player:J.flash_video_player||null,timeout:{mount:this.timeout.mount,start:this.timeout.start}});this.creative_player.eventHandler=(function(L,M){switch(L){case"vpaid":switch(M){case"AdLinearChange":var K=arguments[2];this.eventHandler("change_ad_mode",K?"linear":"nonlinear");break}this.eventHandler("vpaid",arguments[1],arguments[2]);break}}).bind(this);if(this.debug){I.debug.prefix=J.debug_prefix||null;I.debug.on()}this.vast=null;this.is_loaded=false}D.prototype={eventHandler:function(){},load:function(J,K){return(function(N,L){function P(){return N()}var M=(function(Q){if(Q.code==303){this.eventHandler("no_content",Q)}else{console.error(Q);this.eventHandler("error",Q)}return P.call(this)}).$asyncbind(this,L);try{return H.load(J,{timeout:this.timeout.load}).then((function(Q){this.vast=Q;if(this.onparse_complete){this.onparse_complete(this.vast)}this.is_loaded=true;this.eventHandler("loaded");return P.call(this)}).$asyncbind(this,M),M)}catch(O){M(O)}}).$asyncbind(this,true)},show:function(){var M,J,K,N;if(!this.is_loaded){throw new Error("Tag not loaded")}return(function L(Q,O){function R(){return L.$asyncbind(this)(Q,O)}if(M=this.arrayNext(this.vast.ads)){return(function P(U,S){function V(){return P.$asyncbind(this)(U,S)}if(K=this.arrayNext(M.creatives)){function T(){return void V.call(this)}if(K.type=="linear"){return this.showCreative(K,this.place).then((function(W){return T.call(this)}).$asyncbind(this,S),S)}return T.call(this)}else{return void U()}}).$asyncbind(this).then((function(S){return void R.call(this)}).$asyncbind(this,O),O)}else{return void Q()}}).$asyncbind(this).then((function(O){this.eventHandler("done")}).$asyncbind(this,$error),$error)},stop:function(){return(function(K,J){return this.creative_player.stop().then((function(L){return K()}).$asyncbind(this,J),J)}).$asyncbind(this,true)},showCreative:function(K,J){return(function(Q,L){var O,N;function S(){return Q()}var M=(function(T){console.error(T);if(T instanceof C.VPAIDError){I.debug.log("VPAID error "+T.code+" "+T.message);O=K.events.error;if(O){for(N=0;N<O.length;N++){I.fire_pixel(O[N],{ERRORCODE:T.code})}}}return S.call(this)}).$asyncbind(this,L);try{var P=(function(U){function T(){return M(U)}if(U instanceof C.NonLinearVPAID){I.debug.log("Skip. Creative is nonlinear. Change creative type");K.type="nonlinear";return this.creative_player.unmount().then((function(V){return Q()}).$asyncbind(this,M),M)}return M(U)}).$asyncbind(this,M);try{I.debug.log("Try to play linear creative");return this.creative_player.mount(K,J).then((function(T){return this.creative_player.start().then((function(U){return S.call(this)}).$asyncbind(this,M),M)}).$asyncbind(this,P),P)}catch(R){P(R)}}catch(R){M(R)}}).$asyncbind(this,true)},arrayNext:function(J){J._cur=typeof J._cur==="undefined"?0:J._cur;return J[J._cur++]},arrayReset:function(J){J._cur=0}}}).call(this,A("_process"))},{"./CreativePlayer.js":2,"./Exceptions.js":3,"./VASTParser.js":5,"./lib.js":10,_process:1}],7:[function(A,B,e){(function(G){Function.prototype.$asyncbind=function F(K,J){var N=this;if(J===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function I(R){var S=[];if(!R){try{R=G.nextTick}catch(Q){R=function(U){setTimeout(U,0)}}}function O(){for(var W=0;W<S.length;W+=2){var V=S[W+1],X=S[W];for(var U=0;U<V.length;U++){V[U].call(null,X)}}S=[]}function T(U){return U&&(U instanceof Object)&&typeof U.then==="function"}function P(W){function Z(ag){var af;if(aa||ad<0||(af=ac[ad]).length===0){return}S.push(ae,af);ac=[[],[]];if(S.length===2){ag?O():R(O)}}function U(af){if(ad>=0){return}if(T(af)){return af.then(U,Y)}ad=0;ae=af;Z(true)}function Y(af){if(ad>=0){return}if(T(af)){return af.then(U,Y)}ad=1;ae=af;Z(true)}function X(ag,af){ac[0].push(ag);ac[1].push(af);Z()}function V(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[ad]+"}="+ae.toString()}function ab(){try{W.call(null,U,Y)}catch(af){Y(af)}}this.then=X;this.toString=V;var ac=[[],[]],aa=true,ad=-1,ae;ab();aa=false;Z()}P.resolve=function(U){return T(U)?U:{then:function(W,V){return W(U)}}};return P}()}return new (Function.prototype.$asyncbind.EagerThenable)(L)}if(J){if(Function.prototype.$asyncbind.wrapAsyncStack){J=Function.prototype.$asyncbind.wrapAsyncStack(J)}return M}function M(O,P){try{return O&&(O instanceof Object)&&typeof O.then==="function"?O.then(M,J):N.call(K,O,P||J)}catch(Q){return(P||J)(Q)}}function L(O,P){return N.call(K,O,P)}L.then=L;return L};window.$error=window.$error||function(I){throw I};var D=A("./Exceptions.js");var H=A("./lib.js");var C=["AdLoaded","AdSkipped","AdStarted","AdStopped","AdLinearChange","AdSkippableStateChange","AdSizeChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"];function E(I,L){this.creative=I;this.vpaid_flash_bridge=L.vpaid_flash_bridge||null;this.video_element=L.video_player||null;this.allow_flash=L.allow_flash&&H.flash_support();this.file=null;this.methods={};for(var N=0;N<this.creative.files.length;N++){var J=[];var M=this.creative.files[N];if((J=this.get_support_methods(M)).length>0){for(var K=0;K<J.length;K++){var O=J[K];this.methods[O]=this.methods[O]||[];this.methods[O].push(M)}}}this.backend=H.sortByMap(Object.keys(this.methods),["js","flash"])[0];if(!this.backend){throw new Error("No support")}this.file=this.methods[this.backend][0];this.scope=window;this.vpaid=null;this.iframe=null;this.place=null;this.vpaid_version=null;this.has_events={};this.scenario="vast"}E.prototype={eventHandler:function(J,I){},get_support_methods:function(J,K){if(!J.is_vpaid){return[]}var I=[];if(["application/javascript","application/x-javascript"].indexOf(J.type)>=0){I.push("js")}if(this.allow_flash&&J.type=="application/x-shockwave-flash"){I.push("flash")}return I},mount:function(I){return(function(K,J){var L;this.place=I;L=this.place.ownerDocument;this.scope=L.defaultView||L.parentWindow;H.debug.log("Mount "+this.backend);return this[this.backend+"_mount"]().then((function(M){return K()}).$asyncbind(this,J),J)}).$asyncbind(this,true)},initVPAID:function(I){return(function(O,K){var M,J,N,L;this.vpaid=I;if(typeof this.vpaid.subscribe!=="function"){return K(new Error("Bad VPAID: not defined subscribe"))}if(typeof this.vpaid.handshakeVersion!=="function"){return K(new Error("Bad VPAID: not defined handshakeVersion"))}this.vpaid_version=this.vpaid.handshakeVersion("2.0");H.debug.log("VPAID version: "+this.vpaid_version);H.map(C,(function(Q){this._vpaid_subscribe(Q,(function(){var R=Array.prototype.slice.call(arguments);setTimeout((function(){this.handle_vpaid_event(Q,R)}).bind(this),0)}).bind(this))}).bind(this));M=this.place.offsetWidth;J=this.place.offsetHeight;H.debug.log("Size: "+M+"x"+J);H.debug.log("Call VPAID initAd "+this.backend);try{if(this.backend=="js"){this.vpaid.initAd(M,J,"normal",500,{AdParameters:this.creative.ad_params},{slot:this.place,videoSlot:this.video_element,videoSlotCanAutoPlay:false})}else{this.vpaid.initAd(M,J,"normal",500,this.creative.ad_params,"")}}catch(P){console.log("error on initAd",P);return K(new D.VPAIDError(901))}N=setTimeout((function(){H.debug.log("ERROR: timeot for AdLoaded");return K(new D.VPAIDError(901))}).bind(this),10000);return this.waitFor(["AdLoaded","AdError"]).then((function(Q){L=Q;clearTimeout(N);if(L.event=="AdLoaded"){return O()}else{return K(new D.VPAIDError(901,L.args[0]))}}).$asyncbind(this,K),K)}).$asyncbind(this,true)},unmount:function(){return(function(J,I){H.debug.log("start UNMOUNT VPAID");this.remove_event_handlers();if(this.backend=="js"){this.iframe.parentElement.removeChild(this.iframe)}this.vpaid=null;H.debug.log("done UNMOUNT VPAID");return J()}).$asyncbind(this,true)},start:function(){return(function(J,I){if(this.backend=="js"){this.iframe.contentWindow.onerror=function(L,K){return I(new Error('Error in vpaid file "'+K+'": '+L))}}this.on_vpaid("AdError",(function(){H.debug.log("VPAID error",JSON.stringify(arguments));return I(Error("VPAID error"))}).bind(this));this.on_vpaid("AdSkipped",(function(){return J()}).bind(this));this.on_vpaid("AdStarted",(function(){H.debug.log("getAdLinear "+(this.vpaid.getAdLinear()?"yes":"no"));return this.waitFor("AdStopped").then((function(K){return J()}).$asyncbind(this,I),I)}).bind(this),true);this.vpaid.startAd()}).$asyncbind(this,true)},stop:function(){return(function(K,I){this.remove_event_handlers();var J=setTimeout((function(){return this.unmount().then((function(L){return K()}).$asyncbind(this,I),I)}).bind(this),5000);this.on_vpaid("AdStopped",(function(){clearTimeout(J);return this.unmount().then((function(L){return K()}).$asyncbind(this,I),I)}).bind(this));H.debug.log("call stopAd");this.vpaid.stopAd()}).$asyncbind(this,true)},js_mount:function(){return(function(K,I){if(!this.video_element){this.video_element=document.createElement("VIDEO");this.video_element.style.position="absolute";this.video_element.style.left=0;this.video_element.style.top=0;this.video_element.style.width="100%";this.video_element.style.height="100%";this.video_element.style.zIndex="-1";this.place.appendChild(this.video_element)}var J=this.iframe=document.createElement("iframe");J.src="javascript:false";J.style.display="none";document.body.appendChild(J);J.contentWindow.trigger_error=function(){return I(new Error("Can't load vpaid file"))};J.contentWindow.trigger_load=(function(){var L,M;M=J.contentWindow.getVPAIDAd;if(typeof M!=="function"){return I(new Error("Bad VPAID: not defined getVPAIDAd"))}if(!(L=M())){return I(new Error("Bad VPAID: getVPAIDAd return nothing"))}return this.initVPAID(L).then((function(N){return K()}).$asyncbind(this,I),I)}).bind(this);J.contentWindow.document.open();J.contentWindow.document.write('<body style="margin:0; padding:0; width:100%; height:100%;" onerror="trigger_error_global()"><script src="'+this.file.url+'" onload="trigger_load()" onerror="trigger_error()"><\/script></body>');J.contentWindow.document.close()}).$asyncbind(this,true)},flash_mount:function(){return(function(M,I){var L=null;var J=this._gen_fn_name("vpaid_on_ready");var K=this._gen_fn_name("vpaid_on_error");this.scope[K]=(function(){return I(new Error("Can't load vpaid file"))}).bind(this);this.scope[J]=(function(){return this.initVPAID(L).then((function(N){return M()}).$asyncbind(this,I),I)}).bind(this);L=H.html('<object type="application/x-shockwave-flash" width="100%" height="100%" data="'+this.vpaid_flash_bridge+'"><param name="allowScriptAccess" value="always"></param><param name="allowNetworking" value="all"></param><param name="wmode" value="transparent"><param name="flashvars" value="onReady='+J+"&onError="+K+"&src="+encodeURIComponent(this.file.url)+'"></param></object>');this.place.appendChild(L)}).$asyncbind(this,true)},remove_event_handlers:function(){this.eventHandler=function(){}},_gen_fn_name:function(I){this.__gen_fn_name_idx=this.__gen_fn_name_idx||0;return I+Math.random().toString(16).split(".")[1]+(this.__gen_fn_name_idx++).toString()},_vpaid_subscribe:function(K,J){if(this.backend=="js"){this.vpaid.subscribe(J,K)}else{var I=this._gen_fn_name(K);this.scope[I]=J;this.vpaid.subscribe(K,I)}},on_vpaid:function(K,J,I){this._vpaid_event_handlers=this._vpaid_event_handlers||{};this._vpaid_event_handlers[K]=this._vpaid_event_handlers[K]||[];this._vpaid_event_handlers[K].push({handler:J,one:I})},handle_vpaid_event:function(K,J){if(K=="AdStarted"){if(this.vpaid.getAdDuration()==-1){H.debug.log("USE GOOGLE TAG SCENARIO");this.scenario="google";this.process_vpaid_event(false,"AdLinearChange",false)}}if(K=="AdLinearChange"){J=this.vpaid.getAdLinear()}if(K=="AdRemainingTimeChange"){var I=this.vpaid.getAdRemainingTime();var L=this.vpaid.getAdDuration();if(I<0||L<0){return}if(I==0){this.process_vpaid_event(true,"AdVideoComplete");this.process_vpaid_event(true,"AdStopped");return}J=I}if(this.scenario=="google"){if(["AdVideoStart"].indexOf(K)>=0){return}}if(this.scenario=="vast"){}this.process_vpaid_event(false,K,J)},process_vpaid_event:function(I,M,J){H.debug.log((I?"Emulate":"Source")+" VPAID event",M);this.has_events[M]=true;this.eventHandler(M,J);var L=null;if(this._vpaid_event_handlers[M]){for(var K=0;K<this._vpaid_event_handlers[M].length;K++){if(L=this._vpaid_event_handlers[M][K]){L.handler.call(this,M,J);if(L.one){this._vpaid_event_handlers[M][K]=null}}}}},waitFor:function(I){var J=arguments;return(function(N,K){var M=J[0] instanceof Array?J[0]:[J[0]];for(var L=0;L<M.length;L++){this.on_vpaid(M[L],function(P,O){return N({event:P,args:O})},true)}}).$asyncbind(this,true)}};B.exports=E}).call(this,A("_process"))},{"./Exceptions.js":3,"./lib.js":10,_process:1}],8:[function(A,B,e){(function(D){Function.prototype.$asyncbind=function C(H,G){var K=this;if(G===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function F(O){var P=[];if(!O){try{O=D.nextTick}catch(N){O=function(R){setTimeout(R,0)}}}function L(){for(var T=0;T<P.length;T+=2){var S=P[T+1],U=P[T];for(var R=0;R<S.length;R++){S[R].call(null,U)}}P=[]}function Q(R){return R&&(R instanceof Object)&&typeof R.then==="function"}function M(T){function W(ad){var ac;if(X||aa<0||(ac=Z[aa]).length===0){return}P.push(ab,ac);Z=[[],[]];if(P.length===2){ad?L():O(L)}}function R(ac){if(aa>=0){return}if(Q(ac)){return ac.then(R,V)}aa=0;ab=ac;W(true)}function V(ac){if(aa>=0){return}if(Q(ac)){return ac.then(R,V)}aa=1;ab=ac;W(true)}function U(ad,ac){Z[0].push(ad);Z[1].push(ac);W()}function S(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[aa]+"}="+ab.toString()}function Y(){try{T.call(null,R,V)}catch(ac){V(ac)}}this.then=U;this.toString=S;var Z=[[],[]],X=true,aa=-1,ab;Y();X=false;W()}M.resolve=function(R){return Q(R)?R:{then:function(T,S){return T(R)}}};return M}()}return new (Function.prototype.$asyncbind.EagerThenable)(I)}if(G){if(Function.prototype.$asyncbind.wrapAsyncStack){G=Function.prototype.$asyncbind.wrapAsyncStack(G)}return J}function J(L,M){try{return L&&(L instanceof Object)&&typeof L.then==="function"?L.then(J,G):K.call(H,L,M||G)}catch(N){return(M||G)(N)}}function I(L,M){return K.call(H,L,M)}I.then=I;return I};window.$error=window.$error||function(F){throw F};B.exports=E;function E(){this.duration=null;this.currentTime=null;this.dom=null;this.init();this.update()}E.prototype={setDuration:function(F){this.duration=F|0;this.update()},setCurrentTime:function(F){this.currentTime=F|0;this.update()},init:function(){this.dom=document.createElement("div");this.dom.style.position="absolute";this.dom.style.top="0px";this.dom.style.left="0";this.dom.style.right="0";this.dom.style.padding="10px 20px";this.dom.style.color="#fff";this.dom.style.background="rgba(100, 100, 100, 0.5)";this.dom.style.font="12px monospace";this.dom.style.textAlign="right"},update:function(){if(this.duration){var F=Math.max(0,this.duration-this.currentTime);this.dom.innerHTML="Ad: "+this.format_time(F)}else{this.dom.innerHTML="Please wait..."}},format_time:function(G){var F=G/60|0;var G=G-F*60;return("00"+F).substr(-2)+":"+("00"+G).substr(-2)}}}).call(this,A("_process"))},{_process:1}],9:[function(A,B,e){(function(E){Function.prototype.$asyncbind=function D(K,J){var N=this;if(J===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function I(R){var S=[];if(!R){try{R=E.nextTick}catch(Q){R=function(U){setTimeout(U,0)}}}function O(){for(var W=0;W<S.length;W+=2){var V=S[W+1],X=S[W];for(var U=0;U<V.length;U++){V[U].call(null,X)}}S=[]}function T(U){return U&&(U instanceof Object)&&typeof U.then==="function"}function P(W){function Z(ag){var af;if(aa||ad<0||(af=ac[ad]).length===0){return}S.push(ae,af);ac=[[],[]];if(S.length===2){ag?O():R(O)}}function U(af){if(ad>=0){return}if(T(af)){return af.then(U,Y)}ad=0;ae=af;Z(true)}function Y(af){if(ad>=0){return}if(T(af)){return af.then(U,Y)}ad=1;ae=af;Z(true)}function X(ag,af){ac[0].push(ag);ac[1].push(af);Z()}function V(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[ad]+"}="+ae.toString()}function ab(){try{W.call(null,U,Y)}catch(af){Y(af)}}this.then=X;this.toString=V;var ac=[[],[]],aa=true,ad=-1,ae;ab();aa=false;Z()}P.resolve=function(U){return T(U)?U:{then:function(W,V){return W(U)}}};return P}()}return new (Function.prototype.$asyncbind.EagerThenable)(L)}if(J){if(Function.prototype.$asyncbind.wrapAsyncStack){J=Function.prototype.$asyncbind.wrapAsyncStack(J)}return M}function M(O,P){try{return O&&(O instanceof Object)&&typeof O.then==="function"?O.then(M,J):N.call(K,O,P||J)}catch(Q){return(P||J)(Q)}}function L(O,P){return N.call(K,O,P)}L.then=L;return L};window.$error=window.$error||function(I){throw I};var C=A("./Exceptions.js");var H=A("./VideoAdUI.js");var F=A("./lib.js");B.exports=G;function G(I,L){this.creative=I;this.video_player=L.video_player||null;this.flash_video_player=L.flash_video_player||null;this.click_thru=I.click_thru||null;this.video=null;this.file=null;this.methods=[];for(var N=0;N<this.creative.files.length;N++){var J=[];var M=this.creative.files[N];if((J=this.get_support_methods(M)).length>0){for(var K=0;K<J.length;K++){var O=J[K];this.methods[O]=this.methods[O]||[];this.methods[O].push(M)}}}this.backend=F.sortByMap(Object.keys(this.methods),["native","hls","flash"])[0];if(!this.backend){throw new Error("No support")}this.file=this.methods[this.backend][0];this.place=null;this.ui=null}G.prototype={eventHandler:function(J,I){},get_support_methods:function(J){if(J.is_vpaid){return[]}var I=[];if(["maybe","probably"].indexOf(document.createElement("VIDEO").canPlayType(J.type))>=0){I.push("native")}if(this.allow_flash&&["video/mp4","video/flv","video/x-flv","video/m4v","application/x-mpegURL"].indexOf(J.type)>=0){I.push("flash")}return I},mount:function(I){return(function(K,J){this.place=I;F.debug.log("Mount "+this.backend);return this["mount_"+this.backend](I).then((function(L){if(this.click_thru){this.video.addEventListener("click",(function(){this.eventHandler("AdClickThru",true)}).bind(this))}return K()}).$asyncbind(this,J),J)}).$asyncbind(this,true)},mount_native:function(){return(function(J,I){if(!this.video_player){this.video_player=document.createElement("VIDEO")}this.place.appendChild(this.video_player);this.video=this.video_player;return J()}).$asyncbind(this,true)},mount_flash:function(){return(function(M,I){if(!this.flash_video_player){return I(new Error("Bad config for video player. Not set flash_video_player url"))}this.video=document.createElement("OBJECT");this.video.setAttribute("type","application/x-shockwave-flash");this.video.setAttribute("width","100%");this.video.setAttribute("height","100%");this.video.setAttribute("data",this.flash_video_player);var O={wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all",quality:"high"};for(var J in O){var N=document.createElement("PARAM");N.setAttribute("name",J);N.setAttribute("value",O[J]);this.video.appendChild(N)}this.place.appendChild(this.video);var L=new Date().getTime();var K=setInterval((function(){var P=new Date().getTime()-L;if(this.video.vjs_setProperty){clearInterval(K);return M()}else{if(P>5000){clearInterval(K);return I(new C.VPAIDError(402))}}}).bind(this),10)}).$asyncbind(this,true)},unmount:function(){return(function(J,I){if(this.backend=="flash"){clearInterval(this._flash_time_interval)}if(this.video.parentElement){this.video.parentElement.removeChild(this.video)}this.video=null;this.eventHandler=G.prototype.eventHandler;F.debug.log("UNMOUNT VIDEO");return J()}).$asyncbind(this,true)},stop:function(){return(function(J,I){return this.unmount().then((function(K){return J()}).$asyncbind(this,I),I)}).$asyncbind(this,true)},start:function(){return(function(J,I){F.debug.log("Play "+this.backend);return this.initUI().then((function(K){return this["play_"+this.backend]().then((function(L){return this.destroyUI().then((function(M){this.eventHandler("AdStopped");return J()}).$asyncbind(this,I),I)}).$asyncbind(this,I),I)}).$asyncbind(this,I),I)}).$asyncbind(this,true)},initUI:function(){return(function(J,I){this.ui=new H();this.place.appendChild(this.ui.dom);return J()}).$asyncbind(this,true)},destroyUI:function(){return(function(J,I){this.place.removeChild(this.ui.dom);return J()}).$asyncbind(this,true)},play_native:function(){return(function(J,I){this.video.addEventListener("canplay",(function(){this.eventHandler("AdStarted");try{this.video.play()}catch(K){}}).bind(this));this.video.addEventListener("timeupdate",(function(){if(!this.video.duration||!this.video.currentTime){return}if(this.handleChangeProgress(this.video.currentTime,this.video.duration)){return J()}}).bind(this));this.video.src=this.file.url;this.video.load()}).$asyncbind(this,true)},play_flash:function(){return(function(J,I){this.video.vjs_setProperty("eventProxyFunction",this._flashFn((function(L,K){}).bind(this)));this.video.vjs_setProperty("errorEventProxyFunction",this._flashFn((function(L,K){console.log("flash video error",arguments)}).bind(this)));this._flash_time_interval=setInterval((function(){var L=this.video.vjs_getProperty("duration");var K=this.video.vjs_getProperty("currentTime");if(!K||!L){return}if(this.handleChangeProgress(K,L)){clearInterval(this._flash_time_interval);return J()}}).bind(this),500);this.video.vjs_src(this.file.url);this.video.vjs_load();this.video.vjs_play()}).$asyncbind(this,true)},handleChangeProgress:function(J,K){this._step=this._step||1;var I=J/K*100;this.ui.setDuration(K);this.ui.setCurrentTime(J);if(I>=0&&this._step==1){this._step++;this.eventHandler("AdStarted");this.eventHandler("AdImpression");this.eventHandler("AdVideoStart")}if(I>=25&&this._step==2){this._step++;this.eventHandler("AdVideoFirstQuartile")}if(I>=50&&this._step==3){this._step++;this.eventHandler("AdVideoMidpoint")}if(I>=75&&this._step==4){this._step++;this.eventHandler("AdVideoThirdQuartile")}if(I>=99&&this._step==5&&K-J<0.5){this._step++;this.eventHandler("AdVideoComplete");return true}},_flashFn:function(K){var L=this.place.ownerDocument;var J=L.defaultView||L.parentWindow;var I="window";var M="__"+Math.random().toString(16).split(".")[1];J[M]=function(){K.apply(J,arguments)};return I+"."+M}}}).call(this,A("_process"))},{"./Exceptions.js":3,"./VideoAdUI.js":8,"./lib.js":10,_process:1}],10:[function(A,B,e){(function(D){Function.prototype.$asyncbind=function M(S,R){var V=this;if(R===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function Q(Z){var aa=[];if(!Z){try{Z=D.nextTick}catch(Y){Z=function(ac){setTimeout(ac,0)}}}function W(){for(var ae=0;ae<aa.length;ae+=2){var ad=aa[ae+1],af=aa[ae];for(var ac=0;ac<ad.length;ac++){ad[ac].call(null,af)}}aa=[]}function ab(ac){return ac&&(ac instanceof Object)&&typeof ac.then==="function"}function X(ae){function ah(ao){var an;if(ai||al<0||(an=ak[al]).length===0){return}aa.push(am,an);ak=[[],[]];if(aa.length===2){ao?W():Z(W)}}function ac(an){if(al>=0){return}if(ab(an)){return an.then(ac,ag)}al=0;am=an;ah(true)}function ag(an){if(al>=0){return}if(ab(an)){return an.then(ac,ag)}al=1;am=an;ah(true)}function af(ao,an){ak[0].push(ao);ak[1].push(an);ah()}function ad(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[al]+"}="+am.toString()}function aj(){try{ae.call(null,ac,ag)}catch(an){ag(an)}}this.then=af;this.toString=ad;var ak=[[],[]],ai=true,al=-1,am;aj();ai=false;ah()}X.resolve=function(ac){return ab(ac)?ac:{then:function(ae,ad){return ae(ac)}}};return X}()}return new (Function.prototype.$asyncbind.EagerThenable)(T)}if(R){if(Function.prototype.$asyncbind.wrapAsyncStack){R=Function.prototype.$asyncbind.wrapAsyncStack(R)}return U}function U(W,X){try{return W&&(W instanceof Object)&&typeof W.then==="function"?W.then(U,R):V.call(S,W,X||R)}catch(Y){return(X||R)(Y)}}function T(W,X){return V.call(S,W,X)}T.then=T;return T};window.$error=window.$error||function(Q){throw Q};B.exports.HTTPError=K;function K(Q){this.status=Q.status;this.xhr=Q}B.exports.html=G;function G(Q){var R=document.createElement("DIV");R.innerHTML=Q;return R.firstChild}B.exports.extend_url=O;function O(Q,S){var R=new Date().getTime()/1000|0;var S=J({CACHEBUSTER:R,CACHE_BUSTER:R,timestamp:R},S);C(Object.keys(S),function(T){Q=Q.replace("["+T+"]",encodeURIComponent(S[T]))});return Q}B.exports.open_window=E;function E(Q,R){var R=R||{};window.open(O(Q,R),"_blank")}B.exports.fire_pixel=N;function N(Q,S){var S=S||{};var Q=O(Q,S);B.exports.debug.log("Fire pixel "+Q);var R=document.createElement("iframe");R.style.display="none";R.onload=(R.onerror=function(){this.parentElement.removeChild(this)});R.src=Q;document.body.appendChild(R)}function H(){if(window.XDomainRequest){return new XDomainRequest()}else{if(window.XMLHttpRequest){return new XMLHttpRequest()}else{return false}}}B.exports.asyncLoad=function(Q,R){return(function(T,S){var U=H();U.onload=function(){if(U.status!==200){return S(new K(U))}return T(U.responseText)};U.onerror=function(){return S(new K(U))};U.open("GET",Q,true);U.send(null)}).$asyncbind(this,true)};B.exports.load=function(R,U){var Q=this;var T=H();T.onload=function(){if(U){U(true,T.responseText)}};T.onerror=function(){if(U){U(false,null)}};T.open("GET",R,true);try{T.send(null)}catch(S){U(false,null)}return T};B.exports.getDeviceInfo=function(){var Q,R={};if(Q=navigator.userAgent.match(/\bandroid\s(\d+)\.(\d+)(\.(\d+))?\b/i)){R.is_android=true;R.version=[Q[1]|0,Q[2]|0,Q[4]|0]}else{if(/iPhone/.test(navigator.platform)||/iPhone/.test(navigator.userAgent)){R.is_iphone=true}else{if(/iPad/.test(navigator.platform)||/iPad/.test(navigator.userAgent)){R.is_ipad=true}else{if(/iPod/.test(navigator.platform)||/iPod/.test(navigator.userAgent)){R.is_ipod=true}}}}R.is_mobile=R.is_android||R.is_iphone||R.is_ipad||R.is_ipod;return R};B.exports.flash_support=function(){var Q=navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description;return !(!Q)};B.exports.wait=function(S,T){var R=new Date().getTime();var Q=setInterval(function(){var U=new Date().getTime()-R;if(U>=S){clearInterval(Q);T()}},100);return Q};B.exports.map=C;function C(S,R){if(S){for(var Q=0;Q<S.length;Q++){if(R(S[Q],Q)===false){break}}}}B.exports.is_object=I;function I(Q){return typeof Q==="object"&&Q!==null&&Q.constructor===Object}B.exports.is_empty=F;function F(Q){return Q?I(Q)?Object.keys(Q).length==0:Q.length==0:true}B.exports.extend=J;function J(R,Q){C(Object.keys(Q),function(S){if(I(R[S])&&I(Q[S])&&!F(R[S])){J(R[S],Q[S])}else{R[S]=Q[S]}});return R}B.exports.clone=L;function L(Q){return JSON.parse(JSON.stringify(Q))}B.exports.debug={enable:false,prefix:null,on:function(){this.enable=true},off:function(){this.enable=false},log:function(){if(this.enable){var T=new Date();var S=this.prefix?"["+this.prefix+"]":"";var Q=("0"+T.getHours()).substr(-2)+":"+("0"+T.getMinutes()).substr(-2)+":"+("0"+T.getSeconds()).substr(-2);var R=S+"[DEBUG]["+Q+"]"+[].join.call(arguments," ");console.info(R)}}};B.exports.sortByMap=P;function P(S,T){var Q=T.filter(function(U){return S.indexOf(U)>=0});var R=S.filter(function(U){return T.indexOf(U)<0});return Q.concat(R)}}).call(this,A("_process"))},{_process:1}],11:[function(A,B,e){(function(D){Function.prototype.$asyncbind=function C(G,F){var J=this;if(F===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function E(N){var O=[];if(!N){try{N=D.nextTick}catch(M){N=function(Q){setTimeout(Q,0)}}}function K(){for(var S=0;S<O.length;S+=2){var R=O[S+1],T=O[S];for(var Q=0;Q<R.length;Q++){R[Q].call(null,T)}}O=[]}function P(Q){return Q&&(Q instanceof Object)&&typeof Q.then==="function"}function L(S){function V(ac){var ab;if(W||Z<0||(ab=Y[Z]).length===0){return}O.push(aa,ab);Y=[[],[]];if(O.length===2){ac?K():N(K)}}function Q(ab){if(Z>=0){return}if(P(ab)){return ab.then(Q,U)}Z=0;aa=ab;V(true)}function U(ab){if(Z>=0){return}if(P(ab)){return ab.then(Q,U)}Z=1;aa=ab;V(true)}function T(ac,ab){Y[0].push(ac);Y[1].push(ab);V()}function R(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[Z]+"}="+aa.toString()}function X(){try{S.call(null,Q,U)}catch(ab){U(ab)}}this.then=T;this.toString=R;var Y=[[],[]],W=true,Z=-1,aa;X();W=false;V()}L.resolve=function(Q){return P(Q)?Q:{then:function(S,R){return S(Q)}}};return L}()}return new (Function.prototype.$asyncbind.EagerThenable)(H)}if(F){if(Function.prototype.$asyncbind.wrapAsyncStack){F=Function.prototype.$asyncbind.wrapAsyncStack(F)}return I}function I(K,L){try{return K&&(K instanceof Object)&&typeof K.then==="function"?K.then(I,F):J.call(G,K,L||F)}catch(M){return(L||F)(M)}}function H(K,L){return J.call(G,K,L)}H.then=H;return H};window.$error=window.$error||function(E){throw E};c.VASTPlayer=A("./VASTPlayer.js")}).call(this,A("_process"))},{"./VASTPlayer.js":6,_process:1}]},{},[11]);function o(B,A){var e=this;this.target=B;this.place=i('<div style="position: absolute; top:0; left:0; width:100%; height:100%; background: black;"></div>');this.video=i('<video style="position: absolute; top:0; left:0; width:100%; height:100%;" />');this.conf={autoplay:true,debug:false,flash_swf:null,vpaid_flash_bridge:null,cssClass:"vast-player",schedule:[]};p(this.conf,A);this.queue=[];this.has_started=false;j(this.target,this.conf.cssClass);if(this.conf.autoplay){setTimeout(function(){e.play()},0)}}o.prototype=u(Object.create(CustomObject),{play:function(){w(this.conf.schedule,function(e){var e=p({tag:null,prepareXML:null},e);if(typeof e.tag==="function"){e.tag=e.tag()}this.queue.push(e)}.bind(this));this.processNextTag();return this},processNextTag:function(){var e=this;var B=this.queue.shift();if(!B){e.trigger("end");return}this.target.appendChild(this.place);this.place.appendChild(this.video);var C={debug:this.conf.debug,debug_prefix:"PLAYER",place:this.place,video_player:this.video,timeout:{load:null,mount:null,start:null},vpaid_flash_bridge:this.conf.vpaid_flash_bridge,flash_video_player:this.conf.flash_swf};var A=this.vast_player=new c.VASTPlayer(C);A.eventHandler=function(D,E){switch(D){case"loaded":if(!e.has_started){e.trigger("start");e.has_started=true}A.show();break;case"change_ad_mode":switch(E){}break;case"vpaid":e.trigger("vastevent",arguments[1],arguments[2],null);break;case"done":e.processNextTag();break;case"error":e.trigger("vasterror");e.processNextTag();break}}.bind(this);A.load(B.tag)},__processVast:function(C){var A=this;var e=i('<div class="Ad"></div>');var D=new VAST(C.tag,{prepareXML:C.prepareXML,linear_options:{place:e,show_skip:false,player_options:{flash_swf:this.conf.flash_swf},vpaid_options:{vpaid_flash_bridge:A.conf.vpaid_flash_bridge}},nonlinear_options:{place:e}});D.on("vasterror",function(H,F,E,G){A.trigger("vasterror",F,E,G)});D.on("vastevent",function(H,E,F,G){A.trigger("vastevent",E,F,G)});var B=function(){var E=A.queue[0];if(E&&!E.is_error){A.target.appendChild(E.linear_options.place);E.on(["lineardone","error"],function(){this.linear_options.place.style.zIndex=-9999;setTimeout(function(){A.target.removeChild(this.linear_options.place)}.bind(this),2000);A.queue.shift();B()});if(E.is_ready){E.start()}else{E.on("ready",function(){this.start()})}}else{A.trigger("end")}};D.on("error",function(H,F,E,G){console.error(F,E,G)});this.queue.push(D);if(this.queue.length==1){A.trigger("start");B()}}});return o})();