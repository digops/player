(function(){var a=document.createElement("STYLE");a.innerHTML='.customPlayer {position: relative;outline: none;background: #000;z-index: 0;font: 400 14px/1.2 \'Roboto\', sans-serif;overflow: hidden;}.customPlayer.fullscreen {position: absolute;top: 0;left: 0;width: 100% !important;height: 100% !important;}.customPlayer .ui  {position: absolute;left: 0;top: 0;right: 0;bottom: 0;z-index: 100;outline: none;}.customPlayer .no-animate,.customPlayer .no-animate *{transition: none !important;}.customPlayer .ui  > .loader {position: absolute;width: 40%;height: 40%;left: 30%;top: 30%;opacity: 1;transition: opacity ease .7s;}.customPlayer .ui  > .loader.hide {opacity: 0;}.customPlayer .ui  > .error.fatal {position: absolute;display: table;top: 0;left: 0;width: 100%;height: 100%;color: rgb(255, 82, 82);font-size: 20pt;text-align: center;z-index: 1000;background: #000;}.customPlayer .ui  > .error>div {display: table-cell;vertical-align: middle;}.customPlayer .ui  .start-screen {position: absolute;left: 0;top: 0;width: 100%;height: 100%;z-index: 10;cursor: pointer;background-color: black;opacity: 1;transition: opacity ease .5s;}.customPlayer .ui  .start-screen.hide {opacity: 0;}.customPlayer .ui  .start-screen > .poster {position: absolute;left: 0;top: 0;width: 100%;height: 100%;background-repeat: no-repeat;background-position: 50% 50%;background-size: contain;opacity: 1;transition: opacity ease .7s;}.customPlayer .ui  .start-screen > .poster.hide {opacity: 0;}.customPlayer .ui  .start-screen svg {position: absolute;width: 40%;height: 40%;left: 30%;top: 30%;}.customPlayer .ui  .start-screen:hover svg > path {fill: rgba(255,255,255,0.9);}.customPlayer .ui >.controls {position: absolute;left: 0px;right: 0px;bottom: 0px;/*height: 40px;*/background: none;background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABFCAYAAACL3IzzAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjBCQUNBRUVFNjM5QjExRTVBQjkzRDJCRDQyRkU1MEE0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjBCQUNBRUVGNjM5QjExRTVBQjkzRDJCRDQyRkU1MEE0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MEJBQ0FFRUM2MzlCMTFFNUFCOTNEMkJENDJGRTUwQTQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MEJBQ0FFRUQ2MzlCMTFFNUFCOTNEMkJENDJGRTUwQTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4PyzKNAAAAbElEQVR42myPUQ6AMAhDK9u1jB/e/0xV6NaQ6M/SBy0w3NcZAfAIEBEECvNJJLaqGjGMw4lUSgzjVlVLxAdnjk9lM9+aUKrmcWqvVI+5oZgbZeH0yo4yr/vWvIZ90TpIX9Xh8NCfmxfK/AgwACr2StbF5TFoAAAAAElFTkSuQmCC\');opacity: 0;transition: opacity ease .3s;z-index: 9;}.customPlayer .ui >.controls.show {opacity: 1;}.customPlayer .ui >.controls svg {width: 100%;height: 100%;fill: #FFFFFF;}.customPlayer .ui >.controls *:hover>svg {fill: #8CA8FE;}.customPlayer .ui >.controls .play-pause {position: absolute;left: 10px;bottom: 5px;cursor: pointer;width: 24px;height: 24px;overflow: hidden;}.customPlayer .ui >.controls .play-pause path.play {display: block;}.customPlayer .ui >.controls .play-pause path.pause {display: none;}.customPlayer .ui.playing > .controls .play-pause path.play {display: none;}.customPlayer .ui.playing > .controls .play-pause path.pause {display: block;}.customPlayer .ui >.controls .timer {position: absolute;bottom: 7px;left: 40px;color: #fff;font-size: 12px;padding: 0;line-height: 20px;height: 20px;vertical-align: middle;}.customPlayer .ui >.controls .time-label {visibility: hidden;position: absolute;color: #fff;background: #000;border-radius: 5px;padding: 5px 10px;text-align: center;bottom: 60px;opacity: 0;cursor: default;transition:visibility 1s 0s,opacity ease .2s;}.customPlayer .ui >.controls .time-label:after {content: "";position: absolute;width: 0;height: 0;top: 100%;left: 50%;border-style: solid;border-color: transparent;border-width: 5px;border-top-color: #000;margin-left: -5px;}.customPlayer .ui >.controls .time-label.show {visibility: visible;opacity: 1;}.customPlayer .ui.small-mode>.controls .time-label {bottom: 75px;font-size: 20px;}.customPlayer .ui >.controls .progress {position: absolute;left: 0px;right: 0px;bottom: 35px;height: 7px;background: none;cursor: pointer;border-bottom: 3px solid rgba(108, 108, 108, 0.5);z-index: 0;transition: border-width ease .3s;}.customPlayer .ui >.controls .progress.readonly {border-bottom-width: 2px;cursor: default;}.customPlayer .ui >.controls .progress .load {position: absolute;height: 3px;left: 0;bottom: -3px;background: rgba(255, 255, 255, 0.7);z-index: 0;transition:width ease .3s,height ease .3s,bottom ease .3s;}.customPlayer .ui >.controls .progress.readonly .load {height: 2px;bottom: -2px;}.customPlayer .ui >.controls .progress .play {position: absolute;left: 0;bottom: -3px;height: 3px;background: #8CA8FE;z-index: 10;transition:width ease .3s,height ease .3s,bottom ease .3s;}.customPlayer .ui >.controls .progress.readonly .play {background: #BEBEBE;height: 2px;bottom: -2px;}.customPlayer .ui >.controls .progress.readonly .play:after {display: none;}.customPlayer .ui >.controls .progress .play:after {content: "";position: absolute;right: 0px;top: 0px;background: inherit;border-radius: 50%;width: 8px;height: 8px;margin: -2px -4px 0 0;border: none;transition:margin ease .3s,width ease .3s,height ease .3s;}.customPlayer .ui >.controls .progress:hover .play:after {width: 12px;height: 12px;margin: -3px -6px 0 0;}.customPlayer .ui >.controls .progress:hover {border-bottom-width: 5px;}.customPlayer .ui >.controls .progress:hover .load {bottom: -5px;height: 5px;}.customPlayer .ui >.controls .progress:hover .play{bottom: -5px;height: 5px;}.customPlayer .ui >.controls .tray {position: absolute;bottom: 0px;right: 0px;height: 35px;white-space: nowrap;}.customPlayer .ui >.controls .tray > *{position: relative;width: 24px;height: 24px;margin: 5px;display: inline-block;cursor: pointer;vertical-align: middle;box-sizing: content-box;}.customPlayer .ui >.controls .volume svg {position: absolute;left: 0px;width: 24px;height: 24px;}.customPlayer .ui >.controls .volume svg .mute {display: none;}.customPlayer .ui .muted>.controls .volume svg .unmute {display: none;}.customPlayer .ui .muted>.controls .volume svg .mute {display: block;}.customPlayer .ui >.controls .volume {position: relative;outline: none;width: 100px;}.customPlayer .ui >.controls .volume .vlevel{display: none;position: absolute;width: 100%;box-sizing: border-box;height: 100px;bottom: 100%;left: 0px;border-width: 10px 10px 0 10px;border-style: solid;border-color: rgba(0,0,0,0.3);}.customPlayer .ui >.controls .volume .vlevel:before {position: absolute;content: "";left: 0;top: 0;width: 100%;height: 100%;background: rgba(154, 154, 156, 0.5);}.customPlayer .ui >.controls .volume .vlevel>.value{position: absolute;bottom: 0px;left: 0px;background: #fff;width: 100%;height: 100%;}.customPlayer .ui >.controls .volume .level{position: absolute;right: 0px;left: 30px;top: 50%;margin-top: -12px;height: 3px;border-style: solid;border-color: rgba(0,0,0,0);border-width: 10px 0;}.customPlayer .ui >.controls .volume .level:before {content: "";position: absolute;width: 100%;left: 0;top: 0;height: 3px;background: rgba(108, 108, 108, 0.5);}.customPlayer .ui >.controls .volume .level>.value{position: absolute;left: 0;width: 100%;height: 3px;background: #FFFFFF;transition: width ease .3s;}.customPlayer .ui >.controls .volume .level>.value:after {content: "";position: absolute;right: 0px;top: 0px;background: inherit;border-radius: 50%;width: 8px;height: 8px;margin: -2px -4px 0 0;border: none;transition:margin ease .3s,width ease .3s,height ease .3s;}/*.customPlayer .ui >.controls .volume:hover .level>.value:after {width: 12px;height: 12px;margin: -3px -6px 0 0;}*/.customPlayer .ui.small-mode > .controls .progress {border-bottom-width: 20px;}.customPlayer .ui.small-mode > .controls .progress .load {height: 20px;bottom: -20px;}.customPlayer .ui.small-mode > .controls .progress .play {height: 20px;bottom: -20px;}.customPlayer .ui.small-mode > .controls .progress .play:after {display: none;content: "";position: absolute;right: -8px;top: 0px;height: 100%;width: 16px;background: #fff;border: none;margin: 0;border-radius: 0;}.customPlayer .ui.small-mode > .controls .volume {width: 24px;background: rgba(0,0,0,0);transition: background ease .5s;}.customPlayer .ui.small-mode > .controls .volume .vlevel{display: block;height: 0;border-top-width: 0; transition:border ease .3s,height ease .3s;}.customPlayer .ui.small-mode > .controls .volume .level{display: none;}.customPlayer .ui.small-mode > .controls .volume:focus {background: rgba(0,0,0,0.3);}.customPlayer .ui.small-mode > .controls .volume:focus .vlevel{border-top-width: 10px; height: 100px;}.customPlayer.fullscreen > .ui .tray .big {display: none;}.customPlayer > .ui.small-mode .tray .big {display: none;}';document.head.appendChild(a)})();var ctrl;window.CustomPlayer=(function(){function k(E,F){var D=new RegExp("(^|\\s)"+F+"(\\s|$)","g");if(D.test(E.className)){return}E.className=(E.className+" "+F).replace(/\s+/g," ").replace(/(^ | $)/g,"")}function n(E,F){var D=new RegExp("(^|\\s)"+F+"(\\s|$)","g");E.className=E.className.replace(D,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function c(E,F){var D=new RegExp("(^|\\s)"+F+"(\\s|$)","g");return D.test(E.className)}function y(F,E){if(F){for(var D=0;D<F.length;D++){if(E(F[D])===false){break}}}}function l(F){var E=[];for(var D in F){if(F.hasOwnProperty(D)){E.push(D)}}return E}function u(D){return typeof D==="object"&&D!==null&&D.constructor===Object}function C(D){return D?(u(D)?l(D).length==0:D.length==0):true}function s(E,D){y(l(D),function(F){if(u(E[F])&&u(D[F])&&!C(E[F])){s(E[F],D[F])}else{if(typeof E[F]!=="undefined"){E[F]=D[F]}}});return E}function w(E,D){y(l(D),function(F){if(u(E[F])&&u(D[F])&&!C(E[F])){w(E[F],D[F])}else{E[F]=D[F]}});return E}function B(F,E){for(var D=0;D<F.length;D++){if(!E(F[D])){return false}}return true}function i(K,I,H,G){if(I instanceof Array){for(var E=0;E<I.length;E++){i(K,I[E],H,G)}}else{var J=I.split(".")[0];var D=I.split(".")[1]||null;var F=function(L){if(H.call(G?G:K,L)===false){L.stopPropagation();L.preventDefault()}};if(!K.__events){K.__events={}}K.__events=K.__events||{};K.__events[J]=K.__events[J]||[];K.__events[J].push({tag:D,handler:F});K.addEventListener(J,F,false)}}function A(I,G){if(G instanceof Array){for(var F=0;F<G.length;F++){A(I,G[F])}}else{var H=G.split(".")[0];var D=G.split(".")[1]||null;var E=I.__events[H];for(var F=0;F<E.length;F++){if(E[F]&&(D===null||E[F].tag==D)){I.removeEventListener(H,E[F].handler,false);E[F]=null}}}}function j(D){var E=document.createElement("DIV");E.innerHTML=D;return E.firstChild}function x(){var D=navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description;return !!D}function v(F,D){var E={};y(document.cookie.split(";"),function(G){var H=G.split("=");if(H.length==2){E[H[0].trim()]=H[1].trim()}});return E[F]&&!isNaN(E[F])?E[F]:D}function p(D,E){document.cookie=D+"="+E+"; path=/"}function b(){if(window.XDomainRequest){return new XDomainRequest()}else{if(window.XMLHttpRequest){return new XMLHttpRequest()}else{return false}}}function f(E,H){var D=this;var G=b();G.onload=function(){if(!G.responseXML){G.responseXML=(new DOMParser).parseFromString(G.responseText,"text/xml")}if(H){setTimeout(function(){H(true,G)},0)}};G.onerror=function(){if(H){H(false,G)}};G.open("GET",E,true);try{G.send(null)}catch(F){}return G}function t(D,E){var F=b();F.open("POST",D,true);F.send(E)}function e(){var E,F={};var D=navigator.userAgent;if(E=D.match(/\bandroid\s(\d+)\.(\d+)(\.(\d+))?\b/i)){F.is_android=true;F.version=[E[1]|0,E[2]|0,E[4]|0]}else{if(/iPhone/.test(navigator.platform)||/iPhone/.test(D)){F.is_iphone=true}else{if(/iPad/.test(navigator.platform)||/iPad/.test(D)){F.is_ipad=true}else{if(/iPod/.test(navigator.platform)||/iPod/.test(D)){F.is_ipod=true}}}}F.is_edge=D.indexOf("Edge/")>0;F.is_mobile=F.is_android||F.is_iphone||F.is_ipad||F.is_ipod;return F}var q={enable:false,on:function(){this.enable=true},off:function(){this.enable=false},log:function(){if(this.enable){var F=new Date;var D=("0"+F.getHours()).substr(-2)+":"+("0"+F.getMinutes()).substr(-2)+":"+("0"+F.getSeconds()).substr(-2);var E="[DEBUG]["+D+"]"+[].join.call(arguments," ");console.info(E)}}};CustomObject={proxy:function(E,F){if(E instanceof Array){for(var D=0;D<E.length;D++){this.proxy(E[D],F)}}else{this.on(E,function(){var G=Array.prototype.splice.call(arguments,1);F.trigger.apply(F,[E].concat(G))})}},one:function(F,E,D){this.on(F,function(G){G.handler.remove();E.apply(this,arguments)},D)},on:function(H,G,F){var D=this;this._handlers=this._handlers||{};if(H instanceof Array){for(var E=0;E<H.length;E++){this.on(H[E],G,F)}}else{if(typeof this._handlers[H]==="undefined"){this._handlers[H]=[]}this._handlers[H].push({handler:G,scope:F||this,remove:function(){for(var I=0;I<D._handlers[H].length;I++){if(D._handlers[H][I]===this){D._handlers[H][I]=null}}}})}return this},off:function(E){if(E=="*"){this._handlers={}}else{this._handlers=this._handlers||{};E=E instanceof Array?E:[E];for(var D=0;D<E.length;D++){var F=E[D];if(typeof this._handlers[F]!=="undefined"){delete this._handlers[F]}}}},trigger:function(H){this._handlers=this._handlers||{};var F=Array.prototype.splice.call(arguments,1);var D=(this._handlers[H]||[]).concat(this._handlers["*"]||[]);for(var G=0;G<D.length;G++){if(h=D[G]){var E=h.handler.apply(h.scope,[{type:H,handler:h}].concat(F));if(E===false){break}}}return this},triggerAsync:function(F){var D=this;var E=Array.prototype.splice.call(arguments,1);setTimeout(function(){D.trigger.apply(D,[F].concat(E))})}};function z(D,F){this.root=D;this.is_show_poster=false;this.is_loading=false;this.is_playing=false;this.is_muted=false;this.is_start_load=false;this.duration=null;this.sources=[];this._handlers={};this._plugins={};this.conf={baseCSSClass:"customPlayer",muted:false,autoplay:false,sources:[],plugins:{},defaultVolume:1,allow_backends:l(this.__backends),cookieKeyVolume:null,backend_options:{hlsjsWithCredentials:!!F.hlsjsWithCredentials,flash_swf:F.flash_swf||"video.swf",useDefaultControls:false,video_element:F.video_element||null}};s(this.conf,F);k(this.root,this.conf.baseCSSClass);if(this.conf.plugins){this._initPlugins(this.conf.plugins)}if(this.conf.sources){this.setSources(this.conf.sources)}var E=this;setTimeout(function(){E._init()},0)}z.prototype=w(Object.create(CustomObject),{__backends:{},__plugins:{},_init:function(){var D=this;if(this.conf.autoplay&&!e().is_mobile){D.play()}if(this.conf.cookieKeyVolume){this.setVolume(v(this.conf.cookieKeyVolume,this.conf.defaultVolume))}else{this.setVolume(this.conf.defaultVolume)}if(this.conf.muted){this.mute()}},_destroyBackend:function(){this.is_start_load=false;if(this.backend){this.backend.destroy();this.root.removeChild(this.backend.getElement());this.backend.off("*");this.backend=null}},_initBackend:function(F){var D=this;this.trigger("waiting");if(!(this.backend instanceof F)){if(this.backend){this._destroyBackend()}this.backend=new F(this.conf.backend_options);this.backend.on("play",function(){D.is_playing=true;if(D.has_been_paused){D.trigger("resume")}});this.backend.on("pause",function(){D.is_playing=false;D.has_been_paused=true});this.backend.on("ended",function(){D.is_playing=false});this.backend.on("error",function(I,H,G){D.error(H,G)});this.backend.on("timeupdate",function(H,G){D.trigger("timeupdate",G,D.getDuration())});this.backend.on("ready",function(){this.setVolume(D.volume+0.1);this.setVolume(D.volume-0.1);this.setVolume(D.volume)});this.backend.proxy(["play","waiting","playing","seeking","seeked","progress","ended","volumechange","canplay","pause"],this);this.backend.init();var E=this.backend.getElement();E.style.width="100%";E.style.height="100%";E.style.position="absolute";E.style.left=0;E.style.top=0;this.root.appendChild(E);this.trigger("backendchange",this.backend)}},_initSources:function(H){var E=this.conf?this.conf.allow_backends:l(this.__backends);var D=this.__backends;for(var I=0;I<E.length;I++){var G=E[I];if(typeof D[G]==="undefined"){continue}for(var F=0;F<H.length;F++){if(D[G].prototype.isSupported()&&D[G].prototype.canPlayType(H[F].type)){this._initBackend(D[G]);this.source=H[F];this.trigger("sourcechange",this.source);return true}}}return false},_initPlugins:function(E){for(var D in E){if(E[D]&&(typeof E[D].enabled==="undefined"||E[D].enabled)){this._plugins[D]=new this.__plugins[D](this,E[D])}}},getWidth:function(){return this.root.offsetWidth},getHeight:function(){return this.root.offsetHeight},supportMedia:function(H){var E=this.conf?this.conf.allow_backends:l(this.__backends);var D=this.__backends;for(var G=0;G<E.length;G++){var F=E[G];if(typeof D[F]==="undefined"){continue}if(D[F].prototype.isSupported()&&D[F].prototype.canPlayType(H)){return true}}return false},destroy:function(){if(this.backend){this._destroyBackend()}this._handlers={};this.root.parentElement.removeChild(this.root);return this},decodeErrorCode:function(D){var E={100:"We are working to fix this as soon as possible. Thanks for patience.",101:"Your browser can not reproduce this video. Please update your browser for the best viewing experience.",102:"Oops, try again! There is no video.",200:"We are working to fix this as soon as possible. Thanks for patience.",201:"Video temporarily is unavailable, please try again later."};return E[D]||"Unknown error"},error:function(E,D){this.trigger("error",E,D||this.decodeErrorCode(E))},setSources:function(D){if(D&&D.length){this._destroyBackend();if(this.is_playing){this.pause()}this.source=null;this.sources=D;this.trigger("change_sources")}else{this.error(102)}return this},load:function(){var D=this;if(this.sources&&this.sources.length){if(this._initSources(this.sources)){if(this.backend.is_ready){this.backend.setSource(D.source.src,D.source.type)}else{this.backend.one("ready",function(E){this.setSource(D.source.src,D.source.type)})}this.is_start_load=true}else{this.error(101)}}else{this.error(102)}},play:function(){if(!this.is_playing){this.is_playing=true;if(this.is_start_load){if(this.backend){this.backend.play()}}else{this.one("canplay",function(D){this.backend.play()});this.load()}}return this},pause:function(){if(this.is_playing){if(this.backend){this.backend.pause()}this.is_playing=false}return this},getVolume:function(){if(this.backend){this.volume=this.backend.getVolume()}return this.volume},setVolume:function(D){this.volume=Math.min(1,Math.max(0,D));if(this.conf.cookieKeyVolume){p(this.conf.cookieKeyVolume,this.volume)}this.trigger("volumechange",this.volume);if(this.backend){this.backend.setVolume(this.volume)}},mute:function(){this._old_volume=this.getVolume();this.setVolume(0)},unmute:function(){this.setVolume(this._old_volume||1)},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},setProgress:function(D){var E=this.getDuration()/100*D;this.backend.setCurrentTime(E)},getProgress:function(){if(this.backend){return this.getCurrentTime()/this.getDuration()*100}else{return 0}},showDefaultUI:function(){if(this.backend){this.backend.showDefaultUI()}else{this.one("backendchange",function(E,D){D.showDefaultUI()})}}});window.TouchEvent=window.TouchEvent||function(){};function o(E,D){this.conf=w({progress:{show:true,readonly:false},timer:{show:true},poster:null,useMobileFallback:false},D);this.player=E;this.duration;this.is_show_start_screen=true;this.is_first_play=true;this.is_played=false;this.is_muted=false;this.dom=j('<div class="ui" tabindex="0" style="background:rgba(0,0,0,0)">	<div class="loader">		<svg viewBox="0 0 160 160" style="width:100%; height:100%">			<circle cx="80" cy="80" r="75" fill="rgba(0, 0, 0, 0.5)" stroke="rgba(255, 255, 255, 0.1)" stroke-width="2" />			<circle cx="80" cy="80" r="65" stroke="rgba(255, 255, 255, 0.5)" stroke-width="10" fill="transparent" />		</svg>	</div>	<div class="start-screen">		<div class="poster hide"></div>		<svg viewBox="0 0 160 160">			<circle cx="80" cy="80" r="80" fill="rgba(0, 0, 0, 0.3)" />			<path transform="translate(10, -14)" fill="rgba(255, 255, 255, 0.6)" d="M70,32.7c33.8,0,61.2,27.5,61.2,61.2c0,33.8-27.5,61.2-61.2,61.2c-33.8,0-61.2-27.5-61.2-61.2C8.7,60.2,36.2,32.7,70,32.7 M70,24C31.3,24,0,55.3,0,94c0,38.7,31.3,70,70,70c38.7,0,70-31.3,70-70C140,55.3,108.7,24,70,24L70,24z M59,73.4L94.7,94L59,114.6V73.4 M50.2,58.2v71.6l62-35.8L50.2,58.2L50.2,58.2z"/>		</svg>	</div>	<div class="controls">		<div class="time-label"></div>		<div class="progress">			<div class="load"></div>			<div class="play"></div>		</div>		<div class="play-pause">			<svg>				<path class="play" d="M8.016 5.016l10.969 6.984-10.969 6.984v-13.969z"></path>				<path class="pause" d="M14.016 5.016h3.984v13.969h-3.984v-13.969zM6 18.984v-13.969h3.984v13.969h-3.984z"></path>			</svg>		</div>		<div class="timer"></div>		<div class="tray">			<div class="volume" tabindex="0">				<svg>					<path class="unmute" d="M14.016 3.234c4.031 0.891 6.984 4.5 6.984 8.766s-2.953 7.875-6.984 8.766v-2.063c2.906-0.844 4.969-3.516 4.969-6.703s-2.063-5.859-4.969-6.703v-2.063zM16.5 12c0 1.781-0.984 3.281-2.484 4.031v-8.063c1.5 0.75 2.484 2.25 2.484 4.031zM3 9h3.984l5.016-5.016v16.031l-5.016-5.016h-3.984v-6z"></path>					<path class="mute" d="M12 3.984v4.219l-2.109-2.109zM4.266 3l16.734 16.734-1.266 1.266-2.063-2.063c-1.078 0.844-2.297 1.5-3.656 1.828v-2.063c0.844-0.234 1.594-0.656 2.25-1.172l-4.266-4.266v6.75l-5.016-5.016h-3.984v-6h4.734l-4.734-4.734zM18.984 12c0-3.188-2.063-5.859-4.969-6.703v-2.063c4.031 0.891 6.984 4.5 6.984 8.766 0 1.5-0.375 2.953-1.031 4.172l-1.5-1.547c0.328-0.797 0.516-1.688 0.516-2.625zM16.5 12c0 0.234 0 0.422-0.047 0.609l-2.438-2.438v-2.203c1.5 0.75 2.484 2.25 2.484 4.031z"></path>				</svg>				<div class="vlevel">					<div class="value"></div>				</div>				<div class="level">					<div class="value"></div>				</div>			</div>		</div>	</div></div>');this.loader=this.dom.getElementsByClassName("loader")[0];this.start_screen=this.dom.getElementsByClassName("start-screen")[0];this.start_screen.poster=this.start_screen.getElementsByClassName("poster")[0];this.controls=this.dom.getElementsByClassName("controls")[0];this.controls.time_label=this.controls.getElementsByClassName("time-label")[0];this.controls.timer=this.controls.getElementsByClassName("timer")[0];this.controls.play_pause_btn=this.controls.getElementsByClassName("play-pause")[0];this.controls.tray=this.controls.getElementsByClassName("tray")[0];this.controls.tray.volume=this.controls.tray.getElementsByClassName("volume")[0];this.controls.tray.mute=this.controls.tray.volume.getElementsByTagName("svg")[0];this.controls.tray.volume.level=this.controls.tray.volume.getElementsByClassName("level")[0];this.controls.tray.volume.level.value=this.controls.tray.volume.level.getElementsByClassName("value")[0];this.controls.tray.volume.vlevel=this.controls.tray.volume.getElementsByClassName("vlevel")[0];this.controls.tray.volume.vlevel.value=this.controls.tray.volume.vlevel.getElementsByClassName("value")[0];this.controls.progress=this.controls.getElementsByClassName("progress")[0];this.controls.progress.load=this.controls.progress.getElementsByClassName("load")[0];this.controls.progress.play=this.controls.progress.getElementsByClassName("play")[0];this.init()}o.prototype=w(Object.create(CustomObject),{getElement:function(){return this.dom},init:function(){this.initUI();this.initPlayerEvents();this.initUIEvents();this.initEasterEgg();this.initAdaptive();if(this.conf.poster){var E=this;var D=new Image;D.addEventListener("load",function(){E.start_screen.poster.style.backgroundImage="url("+E.conf.poster+")";n(E.start_screen.poster,"hide")});D.src=this.conf.poster}this.controls.tray.volume.level.value.style.width=this.player.volume*100+"%";this.controls.style.display="none";this.hideLoader();if(this.conf.progress.readonly){k(this.controls.progress,"readonly")}if(!this.conf.progress.show){this.controls.progress.style.display="none"}if(!this.conf.timer.show){this.controls.timer.style.display="none"}this.player.trigger("tray_ready",this.controls.tray)},initAdaptive:function(){var D=this;setInterval(function(){var F=D.dom.offsetWidth;if(F==0){return}var E=F>0&&F<=480;if(D.is_small_mode!=E){D.player.trigger("change_small_mode",E);if(E){k(D.dom,"small-mode")}else{n(D.dom,"small-mode")}}D.is_small_mode=E},1000)},initUI:function(){var H=this;this.on("play",function(){if(H.is_first_play){H.hideStartScreen();H.is_first_play=false;if(H.conf.useMobileFallback&&e().is_mobile){H.dom.style.display="none";H.player.showDefaultUI()}}});i(this.dom,"dblclick",function(K){if(K.target==H.dom){H.trigger("fullscreentoggle")}});i(this.dom,"selectstart",function(){return false});i(this.start_screen,"click",function(K){H.trigger("play")});i(this.dom,["mousedown","mouseup"],function(K){if(K.target==H.dom){if(K.type=="mousedown"){this._click_start=K.timeStamp}if(K.type=="mouseup"){if((K.timeStamp-this._click_start)<300){if(H.is_active){H.trigger(H.is_played?"pause":"play")}}}}});i(this.dom,"keydown",function(K){if(K.keyCode==32){H.trigger(H.is_played?"pause":"play");return false}});i(this.dom,"click",function(K){H.trigger("user_active")});var G=0;var D=function(M){if(M.timeStamp-G<500){var Q=50;var P=H.dom.getBoundingClientRect();var R=M.pageX;var N=M.pageY;var L=P.left-Q;var S=P.left+P.width+Q;var O=P.top-Q;var K=P.top+P.height+Q;var T=(R>L&&R<S)&&(N>O&&N<K);if(T){H.trigger("user_active")}}G=M.timeStamp};window.addEventListener("mousemove",D,true);window.addEventListener("touchmove",D,true);i(this.controls.play_pause_btn,"click",function(){H.trigger(H.is_played?"pause":"play")});if(!this.conf.progress.readonly){var I=this.controls.progress;var E=this.controls.time_label;var F=function(M){var K=M-I.getBoundingClientRect().left;var N=H.duration*(K/I.offsetWidth);var L=E.offsetWidth;E.style.left=Math.max(0,Math.min(I.offsetWidth-L,K-(L/2)))+"px";E.innerHTML=H.formatTime(N);clearTimeout(E._t);k(E,"show")};i(I,["mousedown","touchstart"],function(K){if(K instanceof TouchEvent||K.which==1){H.hold_progress=true;var L=I.getBoundingClientRect().left;i(document,["mousemove.progress","touchmove.progress"],function(N){var M=N instanceof TouchEvent?N.changedTouches[0].clientX:N.clientX;k(I,"no-animate");I.play.style.width=Math.max(0,Math.min(100,(M-L)/I.offsetWidth*100))+"%";F(M);return false});i(document,["mouseup.progress","touchend.progress"],function(O){var N=I.offsetWidth;if(N){var M=O instanceof TouchEvent?O.changedTouches[0].clientX:O.clientX;H.hold_progress=false;var P=Math.max(0,Math.min(1,(M-L)/N));n(I,"no-animate");H.trigger("positionchange",P)}A(document,["mousemove.progress","mouseup.progress","touchmove.progress","touchend.progress"]);clearTimeout(E._t);E._t=setTimeout(function(){n(E,"show")},2000)})}});i(I,"mouseout",function(K){n(E,"show")});i(I,"mousemove",function(K){F(K.clientX)})}if(/iPad/.test(navigator.platform)){this.controls.tray.volume.style.display="none"}else{(function(K){i(K,["mousedown","touchstart"],function(M){if(M instanceof TouchEvent||M.which==1){var L=M instanceof TouchEvent?M.changedTouches[0].clientX:M.clientX;var N=K.getBoundingClientRect().left;H.trigger("volumechange",(L-N)/K.offsetWidth);i(document,["mousemove.volume","touchmove.volume"],function(P){var O=P instanceof TouchEvent?P.changedTouches[0].clientX:P.clientX;k(K,"no-animate");H.trigger("volumechange",(O-N)/K.offsetWidth);return false});i(document,["mouseup.volume","touchend.volume"],function(O){n(K,"no-animate");A(document,["mousemove.volume","mouseup.volume","touchend.volume","touchmove.volume"])})}})})(this.controls.tray.volume.level);(function(K){i(K,["mousedown","touchstart"],function(M){var N=M instanceof TouchEvent?M.changedTouches[0].clientY:M.clientY;var L=K.getBoundingClientRect().bottom;H.trigger("volumechange",(L-N)/(K.offsetHeight-10));i(document,["mousemove.volume","touchmove.volume"],function(O){var P=O instanceof TouchEvent?O.changedTouches[0].clientY:O.clientY;k(K,"no-animate");H.trigger("volumechange",(L-P)/(K.offsetHeight-10));return false});i(document,["mouseup.volume","touchend.volume"],function(O){n(K,"no-animate");A(document,["mousemove.volume","mouseup.volume","touchend.volume","touchmove.volume"])})})})(this.controls.tray.volume.vlevel);var J=this.controls.tray.mute;i(J,"click",function(){if(H.is_small_mode){H.controls.tray.volume.focus()}else{H.trigger(H.is_muted?"unmute":"mute")}})}},initUIEvents:function(){var E=this;var D,F;this.on("user_active",function(){E.trigger("show_controls");E.is_active=true;k(E.controls,"show");n(E.controls,"hide");E.controls.style.display="";clearTimeout(D);clearTimeout(F);D=setTimeout(function(){E.is_active=false;k(E.controls,"hide");n(E.controls,"show");F=setTimeout(function(){E.controls.style.display="none";E.trigger("hide_controls")},500)},3000)})},initPlayerEvents:function(){var D=this;this.player.on(["waiting","seeking"],function(E){D.showLoader()});this.player.on(["playing","seeked"],function(E){D.hideLoader();D.hideError()});this.player.on("error",function(G,F,E){D.showError("("+F+") "+E)});this.player.on("play",function(){D.is_played=true;D.hideStartScreen();D.hideError();n(D.dom,"paused");k(D.dom,"playing");D.controls.play_pause_btn.title="Pause"});this.player.on("pause",function(){D.is_played=false;k(D.dom,"paused");n(D.dom,"playing");D.controls.play_pause_btn.title="Play"});this.player.on("ended",function(){D.showStartScreen();D.trigger("exitfullscreen");D.is_played=false;D.is_first_play=true});this.player.on("timeupdate",function(G,F,E){D.time=F;D.duration=E;if(D.duration){if(!D.hold_progress){D.controls.progress.play.style.width=(F/D.duration*100)+"%"}}if(F>0){D.controls.timer.innerHTML=D.formatTime(F)+" / "+D.formatTime(D.duration)}D.updateLoader()});this.player.on("progress",function(E,F){D.buffer=F;D.updateLoader()});this.player.on("volumechange",function(F,E){D.is_muted=E==0;if(D.is_muted){k(D.dom,"muted")}else{n(D.dom,"muted")}D.controls.tray.volume.level.value.style.width=(E*100)+"%";D.controls.tray.volume.vlevel.value.style.height=(E*100)+"%"})},updateLoader:function(){if(this.buffer){for(var E=0;E<this.buffer.length;E++){var F=this.buffer[E][0];var D=this.buffer[E][1];if(this.time>F&&this.time<D){this.controls.progress.load.style.width=(D/this.duration*100)+"%";break}}}},hideStartScreen:function(){if(!this.is_show_start_screen===true){return}var D=this;clearTimeout(this._sst);this.controls.style.display="";k(this.start_screen,"hide");this.is_show_start_screen=false;this._sst=setTimeout(function(){D.start_screen.style.display="none"},1000)},showStartScreen:function(){if(this.is_show_start_screen===false){return}var D=this;clearTimeout(this._sst);this.controls.style.display="none";this.start_screen.style.display="";this.is_show_start_screen=true;this._sst=setTimeout(function(){n(D.start_screen,"hide")},100)},hideLoader:function(){if(this.is_show_loader===false){return}var D=this;clearTimeout(this._lt);this.is_show_loader=false;k(this.loader,"hide");this._lt=setTimeout(function(){if(!D.is_show_loader){D.loader.style.display="none"}},500)},showLoader:function(){if(this.is_show_loader===true){return}var D=this;clearTimeout(this._lt);this.is_show_loader=true;this._lt=setTimeout(function(){if(D.is_show_loader){D.loader.style.display="";setTimeout(function(){n(D.loader,"hide")},100)}},500);var E=this.loader.getElementsByTagName("circle");(function(){E[0].setAttribute("r",((Math.sin((new Date)/100)+1)/4+0.5)*75);E[1].setAttribute("r",((Math.sin((new Date-100)/100)+1)/4+0.5)*65);if(D.is_show_loader||D.loader.style.display!="none"){setTimeout(arguments.callee,30)}})()},showError:function(D){if(!this._is_error_show){this.dom.appendChild(j('<div class="error fatal"><div>'+D+"</div></div>"));this._is_error_show=true}},hideError:function(){var D=this;if(this._is_error_show){this._is_error_show=false;y(this.dom.getElementsByClassName("error"),function(E){D.dom.removeChild(E)})}},formatTime:function(G){var F=this.duration>=3600;var H=Math.ceil(G||0);var D=(H/3600)|0;H-=D*3600;var E=(H/60)|0;H-=E*60;return(F?("0"+D).substr(-2)+":":"")+("0"+E).substr(-2)+":"+("0"+H).substr(-2)},initEasterEgg:function(){var E=[];var D=this;i(this.dom,"keydown",function(H){E.push(H.keyCode)>6?E.shift():null;if(E.join(":")==="65:78:73:83:83:65"){var F=[1071,1053,1040,44,32,1071,32,1058,1045,1041,1071,32,1051,1070,1041,1051,1070,33,33,33];for(var G=0;G<F.length;G++){(function(I,K){var J=j('<div style="position:absolute;color:white;opacity:0.6;font-weight:bold;text-shadow:0 0 5px #000">'+K+"<div>");(function(){J.style.left=(I)+"%";J.style.top=50+(Math.sin(I/15)*30)+"%";J.style.fontSize=((0.5+(Math.sin(I/10)+1)/4)*35)+"px";if(I<-10){D.dom.removeChild(J)}else{I-=0.5;setTimeout(arguments.callee,30)}})();D.dom.appendChild(J)})(100+G*4,String.fromCharCode(F[G]))}}})}});HTML5Backend=(function(){!function(F){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=F()}else{if("function"==typeof define&&define.amd){define([],F)}else{var E;"undefined"!=typeof window?E=window:"undefined"!=typeof global?E=global:"undefined"!=typeof self&&(E=self),E.Hls=F()}}}(function(){var H,F,E;return(function G(J,N,L){function K(S,Q){if(!N[S]){if(!J[S]){var P=typeof require=="function"&&require;if(!Q&&P){return P(S,!0)}if(I){return I(S,!0)}var R=new Error("Cannot find module '"+S+"'");throw R.code="MODULE_NOT_FOUND",R}var O=N[S]={exports:{}};J[S][0].call(O.exports,function(T){var U=J[S][1][T];return K(U?U:T)},O,O.exports,G,J,N,L)}return N[S].exports}var I=typeof require=="function"&&require;for(var M=0;M<L.length;M++){K(L[M])}return K})({1:[function(M,N,K){function O(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}N.exports=O;O.EventEmitter=O;O.prototype._events=undefined;O.prototype._maxListeners=undefined;O.defaultMaxListeners=10;O.prototype.setMaxListeners=function(Q){if(!L(Q)||Q<0||isNaN(Q)){throw TypeError("n must be a positive number")}this._maxListeners=Q;return this};O.prototype.emit=function(V){var W,U,Q,R,S,T;if(!this._events){this._events={}}if(V==="error"){if(!this._events.error||(I(this._events.error)&&!this._events.error.length)){W=arguments[1];if(W instanceof Error){throw W}throw TypeError('Uncaught, unspecified "error" event.')}}U=this._events[V];if(J(U)){return false}if(P(U)){switch(arguments.length){case 1:U.call(this);break;case 2:U.call(this,arguments[1]);break;case 3:U.call(this,arguments[1],arguments[2]);break;default:Q=arguments.length;R=new Array(Q-1);for(S=1;S<Q;S++){R[S-1]=arguments[S]}U.apply(this,R)}}else{if(I(U)){Q=arguments.length;R=new Array(Q-1);for(S=1;S<Q;S++){R[S-1]=arguments[S]}T=U.slice();Q=T.length;for(S=0;S<Q;S++){T[S].apply(this,R)}}}return true};O.prototype.addListener=function(R,S){var Q;if(!P(S)){throw TypeError("listener must be a function")}if(!this._events){this._events={}}if(this._events.newListener){this.emit("newListener",R,P(S.listener)?S.listener:S)}if(!this._events[R]){this._events[R]=S}else{if(I(this._events[R])){this._events[R].push(S)}else{this._events[R]=[this._events[R],S]}}if(I(this._events[R])&&!this._events[R].warned){var Q;if(!J(this._maxListeners)){Q=this._maxListeners}else{Q=O.defaultMaxListeners}if(Q&&Q>0&&this._events[R].length>Q){this._events[R].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[R].length);if(typeof console.trace==="function"){console.trace()}}}return this};O.prototype.on=O.prototype.addListener;O.prototype.once=function(Q,S){if(!P(S)){throw TypeError("listener must be a function")}var T=false;function R(){this.removeListener(Q,R);if(!T){T=true;S.apply(this,arguments)}}R.listener=S;this.on(Q,R);return this};O.prototype.removeListener=function(S,V){var U,Q,T,R;if(!P(V)){throw TypeError("listener must be a function")}if(!this._events||!this._events[S]){return this}U=this._events[S];T=U.length;Q=-1;if(U===V||(P(U.listener)&&U.listener===V)){delete this._events[S];if(this._events.removeListener){this.emit("removeListener",S,V)}}else{if(I(U)){for(R=T;R-->0;){if(U[R]===V||(U[R].listener&&U[R].listener===V)){Q=R;break}}if(Q<0){return this}if(U.length===1){U.length=0;delete this._events[S]}else{U.splice(Q,1)}if(this._events.removeListener){this.emit("removeListener",S,V)}}}return this};O.prototype.removeAllListeners=function(S){var Q,R;if(!this._events){return this}if(!this._events.removeListener){if(arguments.length===0){this._events={}}else{if(this._events[S]){delete this._events[S]}}return this}if(arguments.length===0){for(Q in this._events){if(Q==="removeListener"){continue}this.removeAllListeners(Q)}this.removeAllListeners("removeListener");this._events={};return this}R=this._events[S];if(P(R)){this.removeListener(S,R)}else{while(R.length){this.removeListener(S,R[R.length-1])}}delete this._events[S];return this};O.prototype.listeners=function(R){var Q;if(!this._events||!this._events[R]){Q=[]}else{if(P(this._events[R])){Q=[this._events[R]]}else{Q=this._events[R].slice()}}return Q};O.listenerCount=function(S,R){var Q;if(!S._events||!S._events[R]){Q=0}else{if(P(S._events[R])){Q=1}else{Q=S._events[R].length}}return Q};function P(Q){return typeof Q==="function"}function L(Q){return typeof Q==="number"}function I(Q){return typeof Q==="object"&&Q!==null}function J(Q){return Q===void 0}},{}],2:[function(L,M,J){var O=arguments[3];var K=arguments[4];var I=arguments[5];var N=JSON.stringify;M.exports=function(W){var aa=[];var X;var T=Object.keys(I);for(var S=0,R=T.length;S<R;S++){var Z=T[S];if(I[Z].exports===W){X=Z;break}}if(!X){X=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var U={};for(var S=0,R=T.length;S<R;S++){var Z=T[S];U[Z]=Z}K[X]=[Function(["require","module","exports"],"("+W+")(self)"),U]}var Y=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var Q={};Q[X]=X;K[Y]=[Function(["require"],"require("+N(X)+")(self)"),Q];var P="("+O+")({"+Object.keys(K).map(function(ab){return N(ab)+":["+K[ab][0]+","+N(K[ab][1])+"]"}).join(",")+"},{},["+N(Y)+"])";var V=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(V.createObjectURL(new Blob([P],{type:"text/javascript"})))}},{}],3:[function(J,I,L){Object.defineProperty(L,"__esModule",{value:true});var K=(function(){function R(V,T){for(var S=0;S<T.length;S++){var U=T[S];U.enumerable=U.enumerable||false;U.configurable=true;if("value" in U){U.writable=true}Object.defineProperty(V,U.key,U)}}return function(U,S,T){if(S){R(U.prototype,S)}if(T){R(U,T)}return U}})();function Q(R){return R&&R.__esModule?R:{"default":R}}function M(R,S){if(!(R instanceof S)){throw new TypeError("Cannot call a class as a function")}}var N=J("../events");var O=Q(N);var P=(function(){function T(W){M(this,T);this.hls=W;this.lastfetchlevel=0;this._autoLevelCapping=-1;this._nextAutoLevel=-1;this.onflp=this.onFragmentLoadProgress.bind(this);W.on(O["default"].FRAG_LOAD_PROGRESS,this.onflp)}K(T,[{key:"destroy",value:function S(){this.hls.off(O["default"].FRAG_LOAD_PROGRESS,this.onflp)}},{key:"onFragmentLoadProgress",value:function U(X,Y){var W=Y.stats;if(W.aborted===undefined){this.lastfetchduration=(performance.now()-W.trequest)/1000;this.lastfetchlevel=Y.frag.level;this.lastbw=W.loaded*8/this.lastfetchduration}}},{key:"autoLevelCapping",get:function R(){return this._autoLevelCapping},set:function V(W){this._autoLevelCapping=W}},{key:"nextAutoLevel",get:function R(){var ab=this.lastbw,W=this.hls,Y,X,Z;if(this._autoLevelCapping===-1){Z=W.levels.length-1}else{Z=this._autoLevelCapping}if(this._nextAutoLevel!==-1){var aa=Math.min(this._nextAutoLevel,Z);if(aa===this.lastfetchlevel){this._nextAutoLevel=-1}else{return aa}}for(X=0;X<=Z;X++){if(X<=this.lastfetchlevel){Y=0.8*ab}else{Y=0.7*ab}if(Y<W.levels[X].bitrate){return Math.max(0,X-1)}}return X-1},set:function V(W){this._nextAutoLevel=W}}]);return T})();L["default"]=P;I.exports=L["default"]},{"../events":17}],4:[function(J,I,M){Object.defineProperty(M,"__esModule",{value:true});var L=(function(){function T(X,V){for(var U=0;U<V.length;U++){var W=V[U];W.enumerable=W.enumerable||false;W.configurable=true;if("value" in W){W.writable=true}Object.defineProperty(X,W.key,W)}}return function(W,U,V){if(U){T(W.prototype,U)}if(V){T(W,V)}return W}})();function S(T){return T&&T.__esModule?T:{"default":T}}function N(T,U){if(!(T instanceof U)){throw new TypeError("Cannot call a class as a function")}}var O=J("../events");var P=S(O);var R=J("../utils/logger");var K=J("../errors");var Q=(function(){function Z(ad){N(this,Z);this.hls=ad;this.onml=this.onManifestLoaded.bind(this);this.onll=this.onLevelLoaded.bind(this);this.onerr=this.onError.bind(this);this.ontick=this.tick.bind(this);ad.on(P["default"].MANIFEST_LOADED,this.onml);ad.on(P["default"].LEVEL_LOADED,this.onll);ad.on(P["default"].ERROR,this.onerr);this._manualLevel=this._autoLevelCapping=-1}L(Z,[{key:"destroy",value:function ac(){var ad=this.hls;ad.off(P["default"].MANIFEST_LOADED,this.onml);ad.off(P["default"].LEVEL_LOADED,this.onll);ad.off(P["default"].ERROR,this.onerr);if(this.timer){clearInterval(this.timer)}this._manualLevel=-1}},{key:"onManifestLoaded",value:function aa(ae,af){var ah=[],al=[],ai,ag,ak={},ad=false,aj=false;af.levels.forEach(function(an){if(an.videoCodec){ad=true}if(an.audioCodec){aj=true}var am=ak[an.bitrate];if(am===undefined){ak[an.bitrate]=ah.length;an.url=[an.url];an.urlId=0;ah.push(an)}else{ah[am].url.push(an.url)}});if(ad&&aj){ah.forEach(function(am){if(am.videoCodec){al.push(am)}})}else{al=ah}ah=ah.filter(function(ap){var an=function an(aq){return MediaSource.isTypeSupported("video/mp4;codecs="+aq)};var ao=ap.audioCodec,am=ap.videoCodec;return(ao&&an(ao)||!ao)&&(am&&an(am)||!am)});ai=al[0].bitrate;al.sort(function(an,am){return an.bitrate-am.bitrate});this._levels=al;for(ag=0;ag<al.length;ag++){if(al[ag].bitrate===ai){this._firstLevel=ag;R.logger.log("manifest loaded,"+al.length+" level(s) found, first bitrate:"+ai);break}}this.hls.trigger(P["default"].MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:af.stats});return}},{key:"setLevelInternal",value:function U(ad){if(ad>=0&&ad<this._levels.length){if(this.timer){clearInterval(this.timer);this.timer=null}this._level=ad;R.logger.log("switching to level "+ad);this.hls.trigger(P["default"].LEVEL_SWITCH,{level:ad});var af=this._levels[ad];if(af.details===undefined||af.details.live===true){R.logger.log("(re)loading playlist for level "+ad);var ae=af.urlId;this.hls.trigger(P["default"].LEVEL_LOADING,{url:af.url[ae],level:ad,id:ae})}}else{this.hls.trigger(P["default"].ERROR,{type:K.ErrorTypes.OTHER_ERROR,details:K.ErrorDetails.LEVEL_SWITCH_ERROR,level:ad,fatal:false,reason:"invalid level idx"})}}},{key:"onError",value:function X(ag,ah){if(ah.fatal){return}var ae=ah.details,ad=this.hls,af,aj;switch(ae){case K.ErrorDetails.FRAG_LOAD_ERROR:case K.ErrorDetails.FRAG_LOAD_TIMEOUT:case K.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case K.ErrorDetails.KEY_LOAD_ERROR:case K.ErrorDetails.KEY_LOAD_TIMEOUT:af=ah.frag.level;break;case K.ErrorDetails.LEVEL_LOAD_ERROR:case K.ErrorDetails.LEVEL_LOAD_TIMEOUT:af=ah.level;break;default:break}if(af!==undefined){aj=this._levels[af];if(aj.urlId<aj.url.length-1){aj.urlId++;aj.details=undefined;R.logger.warn("level controller,"+ae+" for level "+af+": switching to redundant stream id "+aj.urlId)}else{var ai=this._manualLevel===-1&&af;if(ai){R.logger.warn("level controller,"+ae+": emergency switch-down for next fragment");ad.abrController.nextAutoLevel=0}else{if(aj&&aj.details&&aj.details.live){R.logger.warn("level controller,"+ae+" on live stream, discard")}else{R.logger.error("cannot recover "+ae+" error");this._level=undefined;if(this.timer){clearInterval(this.timer);this.timer=null}ah.fatal=true;ad.trigger(ag,ah)}}}}}},{key:"onLevelLoaded",value:function T(ad,ae){if(ae.details.live&&!this.timer){this.timer=setInterval(this.ontick,1000*ae.details.targetduration)}if(!ae.details.live&&this.timer){clearInterval(this.timer);this.timer=null}}},{key:"tick",value:function Y(){var ad=this._level;if(ad!==undefined){var af=this._levels[ad],ae=af.urlId;this.hls.trigger(P["default"].LEVEL_LOADING,{url:af.url[ae],level:ad,id:ae})}}},{key:"nextLoadLevel",value:function W(){if(this._manualLevel!==-1){return this._manualLevel}else{return this.hls.abrController.nextAutoLevel}}},{key:"levels",get:function V(){return this._levels}},{key:"level",get:function V(){return this._level},set:function ab(ad){if(this._level!==ad||this._levels[ad].details===undefined){this.setLevelInternal(ad)}}},{key:"manualLevel",get:function V(){return this._manualLevel},set:function ab(ad){this._manualLevel=ad;if(ad!==-1){this.level=ad}}},{key:"firstLevel",get:function V(){return this._firstLevel},set:function ab(ad){this._firstLevel=ad}},{key:"startLevel",get:function V(){if(this._startLevel===undefined){return this._firstLevel}else{return this._startLevel}},set:function ab(ad){this._startLevel=ad}}]);return Z})();M["default"]=Q;I.exports=M["default"]},{"../errors":16,"../events":17,"../utils/logger":26}],5:[function(Q,J,Z){Object.defineProperty(Z,"__esModule",{value:true});var V=(function(){function aa(ae,ac){for(var ab=0;ab<ac.length;ab++){var ad=ac[ab];ad.enumerable=ad.enumerable||false;ad.configurable=true;if("value" in ad){ad.writable=true}Object.defineProperty(ae,ad.key,ad)}}return function(ad,ab,ac){if(ab){aa(ad.prototype,ab)}if(ac){aa(ad,ac)}return ad}})();function I(aa){return aa&&aa.__esModule?aa:{"default":aa}}function L(aa,ab){if(!(aa instanceof ab)){throw new TypeError("Cannot call a class as a function")}}var N=Q("../demux/demuxer");var W=I(N);var R=Q("../events");var P=I(R);var U=Q("../utils/logger");var K=Q("../utils/binary-search");var M=I(K);var T=Q("../helper/level-helper");var O=I(T);var X=Q("../errors");var S={ERROR:-2,STARTING:-1,IDLE:0,KEY_LOADING:1,FRAG_LOADING:2,WAITING_LEVEL:3,PARSING:4,PARSED:5,APPENDING:6,BUFFER_FLUSHING:7};var Y=(function(){function ar(aO){L(this,ar);this.config=aO.config;this.audioCodecSwap=false;this.hls=aO;this.onsbue=this.onSBUpdateEnd.bind(this);this.onsbe=this.onSBUpdateError.bind(this);this.onmediaatt0=this.onMediaAttaching.bind(this);this.onmediadet0=this.onMediaDetaching.bind(this);this.onmp=this.onManifestParsed.bind(this);this.onll=this.onLevelLoaded.bind(this);this.onfl=this.onFragLoaded.bind(this);this.onkl=this.onKeyLoaded.bind(this);this.onis=this.onInitSegment.bind(this);this.onfpg=this.onFragParsing.bind(this);this.onfp=this.onFragParsed.bind(this);this.onerr=this.onError.bind(this);this.ontick=this.tick.bind(this);aO.on(P["default"].MEDIA_ATTACHING,this.onmediaatt0);aO.on(P["default"].MEDIA_DETACHING,this.onmediadet0);aO.on(P["default"].MANIFEST_PARSED,this.onmp)}V(ar,[{key:"destroy",value:function aB(){this.stop();var aO=this.hls;aO.off(P["default"].MEDIA_ATTACHING,this.onmediaatt0);aO.off(P["default"].MEDIA_DETACHING,this.onmediadet0);aO.off(P["default"].MANIFEST_PARSED,this.onmp);this.state=S.IDLE}},{key:"startLoad",value:function af(){if(this.levels&&this.media){this.startInternal();if(this.lastCurrentTime){U.logger.log("seeking @ "+this.lastCurrentTime);if(!this.lastPaused){U.logger.log("resuming video");this.media.play()}this.state=S.IDLE}else{this.lastCurrentTime=0;this.state=S.STARTING}this.nextLoadPosition=this.startPosition=this.lastCurrentTime;this.tick()}else{U.logger.warn("cannot start loading as either manifest not parsed or video not attached")}}},{key:"startInternal",value:function ae(){var aO=this.hls;this.stop();this.demuxer=new W["default"](aO);this.timer=setInterval(this.ontick,100);this.level=-1;aO.on(P["default"].FRAG_LOADED,this.onfl);aO.on(P["default"].FRAG_PARSING_INIT_SEGMENT,this.onis);aO.on(P["default"].FRAG_PARSING_DATA,this.onfpg);aO.on(P["default"].FRAG_PARSED,this.onfp);aO.on(P["default"].ERROR,this.onerr);aO.on(P["default"].LEVEL_LOADED,this.onll);aO.on(P["default"].KEY_LOADED,this.onkl)}},{key:"stop",value:function ao(){this.mp4segments=[];this.flushRange=[];this.bufferRange=[];var aS=this.fragCurrent;if(aS){if(aS.loader){aS.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.sourceBuffer){for(var aP in this.sourceBuffer){var aR=this.sourceBuffer[aP];try{this.mediaSource.removeSourceBuffer(aR);aR.removeEventListener("updateend",this.onsbue);aR.removeEventListener("error",this.onsbe)}catch(aQ){}}this.sourceBuffer=null}if(this.timer){clearInterval(this.timer);this.timer=null}if(this.demuxer){this.demuxer.destroy();this.demuxer=null}var aO=this.hls;aO.off(P["default"].FRAG_LOADED,this.onfl);aO.off(P["default"].FRAG_PARSED,this.onfp);aO.off(P["default"].FRAG_PARSING_DATA,this.onfpg);aO.off(P["default"].LEVEL_LOADED,this.onll);aO.off(P["default"].KEY_LOADED,this.onkl);aO.off(P["default"].FRAG_PARSING_INIT_SEGMENT,this.onis);aO.off(P["default"].ERROR,this.onerr)}},{key:"tick",value:function ac(){var a0,aQ,ba,bg=this.hls;switch(this.state){case S.ERROR:break;case S.STARTING:this.startLevel=bg.startLevel;if(this.startLevel===-1){this.startLevel=0;this.fragBitrateTest=true}this.level=bg.nextLoadLevel=this.startLevel;this.state=S.WAITING_LEVEL;this.loadedmetadata=false;break;case S.IDLE:if(!this.media){break}if(this.loadedmetadata){a0=this.media.currentTime}else{a0=this.nextLoadPosition}if(this.startFragmentRequested===false){aQ=this.startLevel}else{aQ=bg.nextLoadLevel}var a7=this.bufferInfo(a0,0.3),be=a7.len,aW=a7.end,aZ=this.fragPrevious,a6;if(this.levels[aQ].hasOwnProperty("bitrate")){a6=Math.max(8*this.config.maxBufferSize/this.levels[aQ].bitrate,this.config.maxBufferLength);a6=Math.min(a6,this.config.maxBufferLength)}else{a6=this.config.maxBufferLength}if(be<a6){bg.nextLoadLevel=aQ;this.level=aQ;ba=this.levels[aQ].details;if(typeof ba==="undefined"){this.state=S.WAITING_LEVEL;break}var bh=ba.fragments,bc=bh.length,aX=bh[0].start,aV=bh[bc-1].start+bh[bc-1].duration,bb=undefined;if(ba.live){if(aW<Math.max(aX,aV-this.config.liveMaxLatencyDurationCount*ba.targetduration)){this.seekAfterBuffered=aX+Math.max(0,ba.totalduration-this.config.liveSyncDurationCount*ba.targetduration);U.logger.log("buffer end: "+aW+" is located too far from the end of live sliding playlist, media position will be reseted to: "+this.seekAfterBuffered.toFixed(3));aW=this.seekAfterBuffered}if(this.startFragmentRequested&&!ba.PTSKnown){if(aZ){var aP=aZ.sn+1;if(aP>=ba.startSN&&aP<=ba.endSN){bb=bh[aP-ba.startSN];U.logger.log("live playlist, switching playlist, load frag with next SN: "+bb.sn)}}if(!bb){bb=bh[Math.min(bc-1,Math.round(bc/2))];U.logger.log("live playlist, switching playlist, unknown, load middle frag : "+bb.sn)}}}else{if(aW<aX){bb=bh[0]}}if(!bb){var a2;if(aW<aV){a2=M["default"].search(bh,function(bi){if(bi.start+bi.duration<=aW){return 1}else{if(bi.start>aW){return -1}}return 0})}else{a2=bh[bc-1]}if(a2){bb=a2;aX=a2.start;if(aZ&&bb.level===aZ.level&&bb.sn===aZ.sn){if(bb.sn<ba.endSN){bb=bh[bb.sn+1-ba.startSN];U.logger.log("SN just loaded, load next one: "+bb.sn)}else{if(!ba.live){var aU=this.mediaSource;if(aU&&aU.readyState==="open"){var aR=this.sourceBuffer;if(!(aR.audio&&aR.audio.updating||aR.video&&aR.video.updating)){U.logger.log("all media data available, signal endOfStream() to MediaSource");aU.endOfStream()}}}bb=null}}}}if(bb){if(bb.decryptdata.uri!=null&&bb.decryptdata.key==null){U.logger.log("Loading key for "+bb.sn+" of ["+ba.startSN+" ,"+ba.endSN+"],level "+aQ);this.state=S.KEY_LOADING;bg.trigger(P["default"].KEY_LOADING,{frag:bb})}else{U.logger.log("Loading "+bb.sn+" of ["+ba.startSN+" ,"+ba.endSN+"],level "+aQ+", currentTime:"+a0+",bufferEnd:"+aW.toFixed(3));bb.autoLevel=bg.autoLevelEnabled;if(this.levels.length>1){bb.expectedLen=Math.round(bb.duration*this.levels[aQ].bitrate/8);bb.trequest=performance.now()}if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(bb.loadCounter){bb.loadCounter++;var bf=this.config.fragLoadingLoopThreshold;if(bb.loadCounter>bf&&Math.abs(this.fragLoadIdx-bb.loadIdx)<bf){bg.trigger(P["default"].ERROR,{type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:bb});return}}else{bb.loadCounter=1}bb.loadIdx=this.fragLoadIdx;this.fragCurrent=bb;this.startFragmentRequested=true;bg.trigger(P["default"].FRAG_LOADING,{frag:bb});this.state=S.FRAG_LOADING}}}break;case S.WAITING_LEVEL:aQ=this.levels[this.level];if(aQ&&aQ.details){this.state=S.IDLE}break;case S.FRAG_LOADING:var a5=this.media,aT=this.fragCurrent;if(a5&&(!a5.paused||this.loadedmetadata===false)&&aT.autoLevel&&this.level&&this.levels.length>1){var a4=performance.now()-aT.trequest;if(a4>500*aT.duration){var aO=aT.loaded*1000/a4;if(aT.expectedLen<aT.loaded){aT.expectedLen=aT.loaded}a0=a5.currentTime;var a1=(aT.expectedLen-aT.loaded)/aO;var a9=this.bufferInfo(a0,0.3).end-a0;var a3=aT.duration*this.levels[bg.nextLoadLevel].bitrate/(8*aO);if(a9<2*aT.duration&&a1>a9&&a1>a3){U.logger.warn("loading too slow, abort fragment loading");U.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay :"+a1.toFixed(1)+"/"+a9.toFixed(1)+"/"+a3.toFixed(1));aT.loader.abort();bg.trigger(P["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:aT});this.state=S.IDLE}}}break;case S.PARSING:break;case S.PARSED:case S.APPENDING:if(this.sourceBuffer){if(this.media.error){U.logger.error("trying to append although a media error occured, switch to ERROR state");this.state=S.ERROR;return}else{if(this.sourceBuffer.audio&&this.sourceBuffer.audio.updating||this.sourceBuffer.video&&this.sourceBuffer.video.updating){}else{if(this.mp4segments.length){var aS=this.mp4segments.shift();try{this.sourceBuffer[aS.type].appendBuffer(aS.data);this.appendError=0}catch(aY){this.mp4segments.unshift(aS);if(this.appendError){this.appendError++}else{this.appendError=1}var bd={type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.BUFFER_APPEND_ERROR,frag:this.fragCurrent};if(this.appendError>this.config.appendErrorMaxRetry){U.logger.log("fail "+this.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");bd.fatal=true;bg.trigger(P["default"].ERROR,bd);this.state=S.ERROR;return}else{bd.fatal=false;bg.trigger(P["default"].ERROR,bd)}}this.state=S.APPENDING}}}}else{this.state=S.IDLE}break;case S.BUFFER_FLUSHING:while(this.flushRange.length){var a8=this.flushRange[0];if(this.flushBuffer(a8.start,a8.end)){this.flushRange.shift()}else{break}}if(this.flushRange.length===0){if(this.immediateSwitch){this.immediateLevelSwitchEnd()}this.state=S.IDLE;this.fragPrevious=null}break;default:break}this._checkFragmentChanged();this._checkBuffer()}},{key:"bufferInfo",value:function ah(aT,aR){var aS=this.media,aO=aS.buffered,aQ=[],aP;for(aP=0;aP<aO.length;aP++){aQ.push({start:aO.start(aP),end:aO.end(aP)})}return this.bufferedInfo(aQ,aT,aR)}},{key:"bufferedInfo",value:function al(aQ,aX,aV){var aU=[],aP,aZ,a0,aW,aS;aQ.sort(function(a2,a1){var a3=a2.start-a1.start;if(a3){return a3}else{return a1.end-a2.end}});for(aS=0;aS<aQ.length;aS++){var aY=aU.length;if(aY){var aT=aU[aY-1].end;if(aQ[aS].start-aT<aV){if(aQ[aS].end>aT){aU[aY-1].end=aQ[aS].end}}else{aU.push(aQ[aS])}}else{aU.push(aQ[aS])}}for(aS=0,aP=0,aZ=a0=aX;aS<aU.length;aS++){var aO=aU[aS].start,aR=aU[aS].end;if(aX+aV>=aO&&aX<aR){aZ=aO;a0=aR+aV;aP=a0-aX}else{if(aX+aV<aO){aW=aO}}}return{len:aP,start:aZ,end:a0,nextStart:aW}}},{key:"getBufferRange",value:function ad(aO){var aQ,aP;for(aQ=this.bufferRange.length-1;aQ>=0;aQ--){aP=this.bufferRange[aQ];if(aO>=aP.start&&aO<=aP.end){return aP}}return null}},{key:"followingBufferRange",value:function ap(aO){if(aO){return this.getBufferRange(aO.end+0.5)}return null}},{key:"isBuffered",value:function ak(aO){var aP=this.media,aR=aP.buffered;for(var aQ=0;aQ<aR.length;aQ++){if(aO>=aR.start(aQ)&&aO<=aR.end(aQ)){return true}}return false}},{key:"_checkFragmentChanged",value:function aH(){var aR,aP,aO=this.media;if(aO&&aO.seeking===false){aP=aO.currentTime;if(aP>aO.playbackRate*this.lastCurrentTime){this.lastCurrentTime=aP}if(this.isBuffered(aP)){aR=this.getBufferRange(aP)}else{if(this.isBuffered(aP+0.1)){aR=this.getBufferRange(aP+0.1)}}if(aR){var aQ=aR.frag;if(aQ!==this.fragPlaying){this.fragPlaying=aQ;this.hls.trigger(P["default"].FRAG_CHANGED,{frag:aQ})}}}}},{key:"flushBuffer",value:function aa(aS,aU){var aW,aP,aO,aV,aY,aR;if(this.flushBufferCounter++<2*this.bufferRange.length&&this.sourceBuffer){for(var aT in this.sourceBuffer){aW=this.sourceBuffer[aT];if(!aW.updating){for(aP=0;aP<aW.buffered.length;aP++){aO=aW.buffered.start(aP);aV=aW.buffered.end(aP);if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&aU===Number.POSITIVE_INFINITY){aY=aS;aR=aU}else{aY=Math.max(aO,aS);aR=Math.min(aV,aU)}if(aR-aY>0.5){U.logger.log("flush "+aT+" ["+aY+","+aR+"], of ["+aO+","+aV+"], pos:"+this.media.currentTime);aW.remove(aY,aR);return false}}}else{return false}}}var aX=[],aQ;for(aP=0;aP<this.bufferRange.length;aP++){aQ=this.bufferRange[aP];if(this.isBuffered((aQ.start+aQ.end)/2)){aX.push(aQ)}}this.bufferRange=aX;U.logger.log("buffer flushed");return true}},{key:"immediateLevelSwitch",value:function at(){U.logger.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;this.previouslyPaused=this.media.paused;this.media.pause()}var aO=this.fragCurrent;if(aO&&aO.loader){aO.loader.abort()}this.fragCurrent=null;this.flushBufferCounter=0;this.flushRange.push({start:0,end:Number.POSITIVE_INFINITY});this.state=S.BUFFER_FLUSHING;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.tick()}},{key:"immediateLevelSwitchEnd",value:function aF(){this.immediateSwitch=false;this.media.currentTime-=0.0001;if(!this.previouslyPaused){this.media.play()}}},{key:"nextLevelSwitch",value:function ax(){var aT,aO,aU;aO=this.getBufferRange(this.media.currentTime);if(aO){this.flushRange.push({start:0,end:aO.start-1})}if(!this.media.paused){var aQ=this.hls.nextLoadLevel,aS=this.levels[aQ],aR=this.fragLastKbps;if(aR&&this.fragCurrent){aT=this.fragCurrent.duration*aS.bitrate/(1000*aR)+1}else{aT=0}}else{aT=0}aU=this.getBufferRange(this.media.currentTime+aT);if(aU){aU=this.followingBufferRange(aU);if(aU){this.flushRange.push({start:aU.start,end:Number.POSITIVE_INFINITY});var aP=this.fragCurrent;if(aP&&aP.loader){aP.loader.abort()}this.fragCurrent=null}}if(this.flushRange.length){this.flushBufferCounter=0;this.state=S.BUFFER_FLUSHING;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.tick()}}},{key:"onMediaAttaching",value:function an(aP,aQ){var aR=this.media=aQ.media;var aO=this.mediaSource=new MediaSource();this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);aO.addEventListener("sourceopen",this.onmso);aO.addEventListener("sourceended",this.onmse);aO.addEventListener("sourceclose",this.onmsc);aR.src=URL.createObjectURL(aO)}},{key:"onMediaDetaching",value:function aq(){var aR=this.media;if(aR&&aR.ended){U.logger.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var aQ=this.levels;if(aQ){aQ.forEach(function(aS){if(aS.details){aS.details.fragments.forEach(function(aT){aT.loadCounter=undefined})}})}var aO=this.mediaSource;if(aO){if(aO.readyState==="open"){try{aO.endOfStream()}catch(aP){U.logger.warn("onMediaDetaching:"+aP.message+" while calling endOfStream")}}aO.removeEventListener("sourceopen",this.onmso);aO.removeEventListener("sourceended",this.onmse);aO.removeEventListener("sourceclose",this.onmsc);this.media.src="";this.mediaSource=null;if(aR){aR.removeEventListener("seeking",this.onvseeking);aR.removeEventListener("seeked",this.onvseeked);aR.removeEventListener("loadedmetadata",this.onvmetadata);aR.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvmetadata=null}this.media=null;this.loadedmetadata=false;this.stop()}this.onmso=this.onmse=this.onmsc=null;this.hls.trigger(P["default"].MEDIA_DETACHED)}},{key:"onMediaSeeking",value:function aj(){if(this.state===S.FRAG_LOADING){if(this.bufferInfo(this.media.currentTime,0.3).len===0){U.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");var aO=this.fragCurrent;if(aO){if(aO.loader){aO.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;this.state=S.IDLE}}if(this.media){this.lastCurrentTime=this.media.currentTime}if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.tick()}},{key:"onMediaSeeked",value:function aN(){this.tick()}},{key:"onMediaMetadata",value:function aG(){if(this.media.currentTime!==this.startPosition){this.media.currentTime=this.startPosition}this.loadedmetadata=true;this.tick()}},{key:"onMediaEnded",value:function aw(){U.logger.log("media ended");this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function aK(aR,aS){var aP=false,aQ=false,aO;aS.levels.forEach(function(aT){aO=aT.codecs;if(aO){if(aO.indexOf("mp4a.40.2")!==-1){aP=true}if(aO.indexOf("mp4a.40.5")!==-1){aQ=true}}});this.audiocodecswitch=aP&&aQ;if(this.audiocodecswitch){U.logger.log("both AAC/HE-AAC audio found in levels; declaring audio codec as HE-AAC")}this.levels=aS.levels;this.startLevelLoaded=false;this.startFragmentRequested=false;if(this.media&&this.config.autoStartLoad){this.startLoad()}}},{key:"onLevelLoaded",value:function az(aS,aT){var aQ=aT.details,aP=aT.level,aO=this.levels[aP],aU=aQ.totalduration;U.logger.log("level "+aP+" loaded ["+aQ.startSN+","+aQ.endSN+"],duration:"+aU);if(aQ.live){var aR=aO.details;if(aR){O["default"].mergeDetails(aR,aQ);if(aQ.PTSKnown){U.logger.log("live playlist sliding:"+aQ.fragments[0].start.toFixed(3))}else{U.logger.log("live playlist - outdated PTS, unknown sliding")}}else{aQ.PTSKnown=false;U.logger.log("live playlist - first load, unknown sliding")}}else{aQ.PTSKnown=false}aO.details=aQ;this.hls.trigger(P["default"].LEVEL_UPDATED,{details:aQ,level:aP});if(this.startLevelLoaded===false){if(aQ.live){this.startPosition=Math.max(0,aU-this.config.liveSyncDurationCount*aQ.targetduration)}this.nextLoadPosition=this.startPosition;this.startLevelLoaded=true}if(this.state===S.WAITING_LEVEL){this.state=S.IDLE}this.tick()}},{key:"onKeyLoaded",value:function au(){if(this.state===S.KEY_LOADING){this.state=S.IDLE;this.tick()}}},{key:"onFragLoaded",value:function aE(aQ,aV){var aW=this.fragCurrent;if(this.state===S.FRAG_LOADING&&aW&&aV.frag.level===aW.level&&aV.frag.sn===aW.sn){if(this.fragBitrateTest===true){this.state=S.IDLE;this.fragBitrateTest=false;aV.stats.tparsed=aV.stats.tbuffered=performance.now();this.hls.trigger(P["default"].FRAG_BUFFERED,{stats:aV.stats,frag:aW})}else{this.state=S.PARSING;this.stats=aV.stats;var aS=this.levels[this.level],aO=aS.details,aU=aO.totalduration,aR=aW.start,aP=aW.level,aT=aW.sn,aX=aS.audioCodec;if(aX&&this.audioCodecSwap){U.logger.log("swapping playlist audio codec");if(aX.indexOf("mp4a.40.5")!==-1){aX="mp4a.40.2"}else{aX="mp4a.40.5"}}U.logger.log("Demuxing "+aT+" of ["+aO.startSN+" ,"+aO.endSN+"],level "+aP);this.demuxer.push(aV.payload,aX,aS.videoCodec,aR,aW.cc,aP,aT,aU,aW.decryptdata)}}}},{key:"onInitSegment",value:function av(aQ,aR){if(this.state===S.PARSING){var aS=this.levels[this.level].audioCodec,aO=this.levels[this.level].videoCodec,aT;if(aS&&this.audioCodecSwap){U.logger.log("swapping playlist audio codec");if(aS.indexOf("mp4a.40.5")!==-1){aS="mp4a.40.2"}else{aS="mp4a.40.5"}}U.logger.log("playlist_level/init_segment codecs: video => "+aO+"/"+aR.videoCodec+"; audio => "+aS+"/"+aR.audioCodec);if(aS===undefined||aR.audioCodec===undefined){aS=aR.audioCodec}if(aO===undefined||aR.videoCodec===undefined){aO=aR.videoCodec}var aP=navigator.userAgent.toLowerCase();if(this.audiocodecswitch&&aR.audioChannelCount!==1&&aP.indexOf("android")===-1&&aP.indexOf("firefox")===-1){aS="mp4a.40.5"}if(!this.sourceBuffer){this.sourceBuffer={};U.logger.log("selected A/V codecs for sourceBuffers:"+aS+","+aO);if(aS){aT=this.sourceBuffer.audio=this.mediaSource.addSourceBuffer("video/mp4;codecs="+aS);aT.addEventListener("updateend",this.onsbue);aT.addEventListener("error",this.onsbe)}if(aO){aT=this.sourceBuffer.video=this.mediaSource.addSourceBuffer("video/mp4;codecs="+aO);aT.addEventListener("updateend",this.onsbue);aT.addEventListener("error",this.onsbe)}}if(aS){this.mp4segments.push({type:"audio",data:aR.audioMoov})}if(aO){this.mp4segments.push({type:"video",data:aR.videoMoov})}this.tick()}}},{key:"onFragParsing",value:function aC(aP,aQ){if(this.state===S.PARSING){this.tparse2=Date.now();var aS=this.levels[this.level],aR=this.fragCurrent;U.logger.log("parsed data, type/startPTS/endPTS/startDTS/endDTS/nb:"+aQ.type+"/"+aQ.startPTS.toFixed(3)+"/"+aQ.endPTS.toFixed(3)+"/"+aQ.startDTS.toFixed(3)+"/"+aQ.endDTS.toFixed(3)+"/"+aQ.nb);var aO=O["default"].updateFragPTS(aS.details,aR.sn,aQ.startPTS,aQ.endPTS);this.hls.trigger(P["default"].LEVEL_PTS_UPDATED,{details:aS.details,level:this.level,drift:aO});this.mp4segments.push({type:aQ.type,data:aQ.moof});this.mp4segments.push({type:aQ.type,data:aQ.mdat});this.nextLoadPosition=aQ.endPTS;this.bufferRange.push({type:aQ.type,start:aQ.startPTS,end:aQ.endPTS,frag:aR});this.tick()}else{U.logger.warn("not in PARSING state, discarding "+aP)}}},{key:"onFragParsed",value:function aM(){if(this.state===S.PARSING){this.state=S.PARSED;this.stats.tparsed=performance.now();this.tick()}}},{key:"onError",value:function am(aO,aP){switch(aP.details){case X.ErrorDetails.FRAG_LOAD_ERROR:case X.ErrorDetails.FRAG_LOAD_TIMEOUT:case X.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case X.ErrorDetails.LEVEL_LOAD_ERROR:case X.ErrorDetails.LEVEL_LOAD_TIMEOUT:case X.ErrorDetails.KEY_LOAD_ERROR:case X.ErrorDetails.KEY_LOAD_TIMEOUT:U.logger.warn("mediaController: "+aP.details+" while loading frag,switch to "+(aP.fatal?"ERROR":"IDLE")+" state ...");this.state=aP.fatal?S.ERROR:S.IDLE;break;default:break}}},{key:"onSBUpdateEnd",value:function ag(){if(this.state===S.APPENDING&&this.mp4segments.length===0){var aP=this.fragCurrent,aO=this.stats;if(aP){this.fragPrevious=aP;aO.tbuffered=performance.now();this.fragLastKbps=Math.round(8*aO.length/(aO.tbuffered-aO.tfirst));this.hls.trigger(P["default"].FRAG_BUFFERED,{stats:aO,frag:aP});U.logger.log("media buffered : "+this.timeRangesToString(this.media.buffered));this.state=S.IDLE}}this.tick()}},{key:"_checkBuffer",value:function aL(){var aT=this.media;if(aT){var aO=aT.readyState;if(aO){var aS=this.seekAfterBuffered;if(aS){if(aT.duration>=aS){aT.currentTime=aS;this.seekAfterBuffered=undefined}}else{if(aO<3){var aQ=aT.currentTime;var aP=this.bufferInfo(aQ,0);if(aP.len===0){var aR=aP.nextStart;if(aR&&aR-aQ<0.3){U.logger.log("adjust currentTime from "+aQ+" to "+aR);aT.currentTime=aR}}}}}}}},{key:"swapAudioCodec",value:function aD(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"onSBUpdateError",value:function ai(aO){U.logger.error("sourceBuffer error:"+aO);this.state=S.ERROR;this.hls.trigger(P["default"].ERROR,{type:X.ErrorTypes.MEDIA_ERROR,details:X.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:false,frag:this.fragCurrent})}},{key:"timeRangesToString",value:function ay(aR){var aQ="",aO=aR.length;for(var aP=0;aP<aO;aP++){aQ+="["+aR.start(aP)+","+aR.end(aP)+"]"}return aQ}},{key:"onMediaSourceOpen",value:function aA(){U.logger.log("media source opened");this.hls.trigger(P["default"].MEDIA_ATTACHED);this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvmetadata=this.onMediaMetadata.bind(this);this.onvended=this.onMediaEnded.bind(this);var aO=this.media;aO.addEventListener("seeking",this.onvseeking);aO.addEventListener("seeked",this.onvseeked);aO.addEventListener("loadedmetadata",this.onvmetadata);aO.addEventListener("ended",this.onvended);if(this.levels&&this.config.autoStartLoad){this.startLoad()}this.mediaSource.removeEventListener("sourceopen",this.onmso)}},{key:"onMediaSourceClose",value:function aJ(){U.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function ab(){U.logger.log("media source ended")}},{key:"currentLevel",get:function aI(){if(this.media){var aO=this.getBufferRange(this.media.currentTime);if(aO){return aO.frag.level}}return -1}},{key:"nextBufferRange",get:function aI(){if(this.media){return this.followingBufferRange(this.getBufferRange(this.media.currentTime))}else{return null}}},{key:"nextLevel",get:function aI(){var aO=this.nextBufferRange;if(aO){return aO.frag.level}else{return -1}}}]);return ar})();Z["default"]=Y;J.exports=Z["default"]},{"../demux/demuxer":12,"../errors":16,"../events":17,"../helper/level-helper":18,"../utils/binary-search":25,"../utils/logger":26}],6:[function(K,M,I){Object.defineProperty(I,"__esModule",{value:true});var L=(function(){function O(S,Q){for(var P=0;P<Q.length;P++){var R=Q[P];R.enumerable=R.enumerable||false;R.configurable=true;if("value" in R){R.writable=true}Object.defineProperty(S,R.key,R)}}return function(R,P,Q){if(P){O(R.prototype,P)}if(Q){O(R,Q)}return R}})();function N(O,P){if(!(O instanceof P)){throw new TypeError("Cannot call a class as a function")}}var J=(function(){function Q(Y){N(this,Q);this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]];this._precompute();var U,T,V,X,aa,W=this._tables[0][4],Z=this._tables[1],R=Y.length,S=1;if(R!==4&&R!==6&&R!==8){throw new Error("Invalid aes key size="+R)}X=Y.slice(0);aa=[];this._key=[X,aa];for(U=R;U<4*R+28;U++){V=X[U-1];if(U%R===0||R===8&&U%R===4){V=W[V>>>24]<<24^W[V>>16&255]<<16^W[V>>8&255]<<8^W[V&255];if(U%R===0){V=V<<8^V>>>24^S<<24;S=S<<1^(S>>7)*283}}X[U]=X[U-R]^V}for(T=0;U;T++,U--){V=X[T&3?U:U-4];if(U<=4||T<4){aa[T]=V}else{aa[T]=Z[0][W[V>>>24]]^Z[1][W[V>>16&255]]^Z[2][W[V>>8&255]]^Z[3][W[V&255]]}}}L(Q,[{key:"_precompute",value:function O(){var Y=this._tables[0],af=this._tables[1],X=Y[4],ac=af[4],W,aa,V,Z=[],T=[],S,ae,ab,ad,U,R;for(W=0;W<256;W++){T[(Z[W]=W<<1^(W>>7)*283)^W]=W}for(aa=V=0;!X[aa];aa^=S||1,V=T[V]||1){ad=V^V<<1^V<<2^V<<3^V<<4;ad=ad>>8^ad&255^99;X[aa]=ad;ac[ad]=aa;ab=Z[ae=Z[S=Z[aa]]];R=ab*16843009^ae*65537^S*257^aa*16843008;U=Z[ad]*257^ad*16843008;for(W=0;W<4;W++){Y[W][aa]=U=U<<24^U>>>8;af[W][ad]=R=R<<24^R>>>8}}for(W=0;W<5;W++){Y[W]=Y[W].slice(0);af[W]=af[W].slice(0)}}},{key:"decrypt",value:function P(ak,aj,ah,af,Z,R){var an=this._key[1],ai=ak^an[0],ag=af^an[1],ae=ah^an[2],ad=aj^an[3],al,S,U,am=an.length/4-2,Y,V=4,ac=this._tables[1],ab=ac[0],aa=ac[1],X=ac[2],W=ac[3],T=ac[4];for(Y=0;Y<am;Y++){al=ab[ai>>>24]^aa[ag>>16&255]^X[ae>>8&255]^W[ad&255]^an[V];S=ab[ag>>>24]^aa[ae>>16&255]^X[ad>>8&255]^W[ai&255]^an[V+1];U=ab[ae>>>24]^aa[ad>>16&255]^X[ai>>8&255]^W[ag&255]^an[V+2];ad=ab[ad>>>24]^aa[ai>>16&255]^X[ag>>8&255]^W[ae&255]^an[V+3];V+=4;ai=al;ag=S;ae=U}for(Y=0;Y<4;Y++){Z[(3&-Y)+R]=T[ai>>>24]<<24^T[ag>>16&255]<<16^T[ae>>8&255]<<8^T[ad&255]^an[V++];al=ai;ai=ag;ag=ae;ae=ad;ad=al}}}]);return Q})();I["default"]=J;M.exports=I["default"]},{}],7:[function(L,J,N){Object.defineProperty(N,"__esModule",{value:true});var M=(function(){function R(V,T){for(var S=0;S<T.length;S++){var U=T[S];U.enumerable=U.enumerable||false;U.configurable=true;if("value" in U){U.writable=true}Object.defineProperty(V,U.key,U)}}return function(U,S,T){if(S){R(U.prototype,S)}if(T){R(U,T)}return U}})();function Q(R){return R&&R.__esModule?R:{"default":R}}function P(R,S){if(!(R instanceof S)){throw new TypeError("Cannot call a class as a function")}}var I=L("./aes");var K=Q(I);var O=(function(){function R(X,W){P(this,R);this.key=X;this.iv=W}M(R,[{key:"ntoh",value:function U(W){return W<<24|(W&65280)<<8|(W&16711680)>>8|W>>>24}},{key:"doDecrypt",value:function S(ah,aj,Y){var ai=new Int32Array(ah.buffer,ah.byteOffset,ah.byteLength>>2),ad=new K["default"](Array.prototype.slice.call(aj)),ak=new Uint8Array(ah.byteLength),al=new Int32Array(ak.buffer),ag,af,ae,ac,ab,aa,Z,X,W;ag=~~Y[0];af=~~Y[1];ae=~~Y[2];ac=~~Y[3];for(W=0;W<ai.length;W+=4){ab=~~this.ntoh(ai[W]);aa=~~this.ntoh(ai[W+1]);Z=~~this.ntoh(ai[W+2]);X=~~this.ntoh(ai[W+3]);ad.decrypt(ab,aa,Z,X,al,W);al[W]=this.ntoh(al[W]^ag);al[W+1]=this.ntoh(al[W+1]^af);al[W+2]=this.ntoh(al[W+2]^ae);al[W+3]=this.ntoh(al[W+3]^ac);ag=ab;af=aa;ae=Z;ac=X}return ak}},{key:"localDecript",value:function V(aa,Z,Y,X){var W=this.doDecrypt(aa,Z,Y);X.set(W,aa.byteOffset)}},{key:"decrypt",value:function T(ab){var aa=4*8000,ac=new Int32Array(ab),W=new Uint8Array(ab.byteLength),Z=0;var Y=this.key;var X=this.iv;this.localDecript(ac.subarray(Z,Z+aa),Y,X,W);for(Z=aa;Z<ac.length;Z+=aa){X=new Uint32Array([this.ntoh(ac[Z-4]),this.ntoh(ac[Z-3]),this.ntoh(ac[Z-2]),this.ntoh(ac[Z-1])]);this.localDecript(ac.subarray(Z,Z+aa),Y,X,W)}return W}}]);return R})();N["default"]=O;J.exports=N["default"]},{"./aes":6}],8:[function(J,I,N){Object.defineProperty(N,"__esModule",{value:true});var M=(function(){function T(X,V){for(var U=0;U<V.length;U++){var W=V[U];W.enumerable=W.enumerable||false;W.configurable=true;if("value" in W){W.writable=true}Object.defineProperty(X,W.key,W)}}return function(W,U,V){if(U){T(W.prototype,U)}if(V){T(W,V)}return W}})();function S(T){return T&&T.__esModule?T:{"default":T}}function P(T,U){if(!(T instanceof U)){throw new TypeError("Cannot call a class as a function")}}var Q=J("./aes128-decrypter");var K=S(Q);var L=J("../errors");var R=J("../utils/logger");var O=(function(){function Y(aa){P(this,Y);this.hls=aa;try{var Z=window?window.crypto:crypto;this.subtle=Z.subtle||Z.webkitSubtle;this.disableWebCrypto=!this.subtle}catch(ab){this.disableWebCrypto=true}}M(Y,[{key:"destroy",value:function W(){}},{key:"decrypt",value:function U(ab,aa,Z,ac){if(this.disableWebCrypto&&this.hls.config.enableSoftwareAES){this.decryptBySoftware(ab,aa,Z,ac)}else{this.decryptByWebCrypto(ab,aa,Z,ac)}}},{key:"decryptByWebCrypto",value:function X(ab,aa,Z,ad){var ac=this;R.logger.log("decrypting by WebCrypto API");this.subtle.importKey("raw",aa,{name:"AES-CBC",length:128},false,["decrypt"]).then(function(ae){ac.subtle.decrypt({name:"AES-CBC",iv:Z.buffer},ae,ab).then(ad)["catch"](function(af){ac.onWebCryptoError(af,ab,aa,Z,ad)})})["catch"](function(ae){ac.onWebCryptoError(ae,ab,aa,Z,ad)})}},{key:"decryptBySoftware",value:function V(ad,ag,aa,af){R.logger.log("decrypting by JavaScript Implementation");var Z=new DataView(ag.buffer);var ac=new Uint32Array([Z.getUint32(0),Z.getUint32(4),Z.getUint32(8),Z.getUint32(12)]);Z=new DataView(aa.buffer);var ab=new Uint32Array([Z.getUint32(0),Z.getUint32(4),Z.getUint32(8),Z.getUint32(12)]);var ae=new K["default"](ac,ab);af(ae.decrypt(ad).buffer)}},{key:"onWebCryptoError",value:function T(ab,ac,aa,Z,ad){if(this.hls.config.enableSoftwareAES){R.logger.log("disabling to use WebCrypto API");this.disableWebCrypto=true;this.decryptBySoftware(ac,aa,Z,ad)}else{R.logger.error("decrypting error : "+ab.message);this.hls.trigger(Event.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:true,reason:ab.message})}}}]);return Y})();N["default"]=O;I.exports=N["default"]},{"../errors":16,"../utils/logger":26,"./aes128-decrypter":7}],9:[function(J,I,M){Object.defineProperty(M,"__esModule",{value:true});var L=(function(){function T(X,V){for(var U=0;U<V.length;U++){var W=V[U];W.enumerable=W.enumerable||false;W.configurable=true;if("value" in W){W.writable=true}Object.defineProperty(X,W.key,W)}}return function(W,U,V){if(U){T(W.prototype,U)}if(V){T(W,V)}return W}})();function S(T){return T&&T.__esModule?T:{"default":T}}function N(T,U){if(!(T instanceof U)){throw new TypeError("Cannot call a class as a function")}}var Q=J("../utils/logger");var R=J("../demux/id3");var O=S(R);var K=J("../errors");var P=(function(){function X(Y,Z){N(this,X);this.observer=Y;this.remuxerClass=Z;this.remuxer=new this.remuxerClass(Y);this._aacTrack={type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}L(X,[{key:"push",value:function U(ap,ac,al,ah,ai,aa,an,Y){var Z=new O["default"](ap),ab,am,ak=this._aacTrack,aq=Z.timeStamp,ao,ae,af,ag,aj,ad;for(ab=Z.length,am=ap.length;ab<am-1;ab++){if(ap[ab]===255&&(ap[ab+1]&240)===240){break}}if(!ak.audiosamplerate){ao=this._ADTStoAudioConfig(ap,ab,ac);ak.config=ao.config;ak.audiosamplerate=ao.samplerate;ak.channelCount=ao.channelCount;ak.codec=ao.codec;ak.timescale=this.remuxer.timescale;ak.duration=this.remuxer.timescale*Y;Q.logger.log("parsed codec:"+ak.codec+",rate:"+ao.samplerate+",nb channel:"+ao.channelCount)}ae=0;while(ab+5<am){af=(ap[ab+3]&3)<<11;af|=ap[ab+4]<<3;af|=(ap[ab+5]&224)>>>5;ag=!!(ap[ab+1]&1)?7:9;af-=ag;aj=Math.round(90*aq+ae*1024*90000/ak.audiosamplerate);if(af>0&&ab+ag+af<=am){ad={unit:ap.subarray(ab+ag,ab+ag+af),pts:aj,dts:aj};ak.samples.push(ad);ak.len+=af;ab+=af+ag;ae++;for(;ab<am-1;ab++){if(ap[ab]===255&&(ap[ab+1]&240)===240){break}}}else{break}}this.remuxer.remux(this._aacTrack,{samples:[]},{samples:[{pts:aq,dts:aq,unit:Z.payload}]},ah)}},{key:"_ADTStoAudioConfig",value:function W(ab,aa,ah){var ae,ad,ac,Z,Y,ag=navigator.userAgent.toLowerCase(),af=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];ae=((ab[aa+2]&192)>>>6)+1;ad=(ab[aa+2]&60)>>>2;if(ad>af.length-1){this.observer.trigger(Event.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+ad});return}Z=(ab[aa+2]&1)<<2;Z|=(ab[aa+3]&192)>>>6;Q.logger.log("manifest codec:"+ah+",ADTS data:type:"+ae+",sampleingIndex:"+ad+"["+af[ad]+"Hz],channelConfig:"+Z);if(ag.indexOf("firefox")!==-1){if(ad>=6){ae=5;Y=new Array(4);ac=ad-3}else{ae=2;Y=new Array(2);ac=ad}}else{if(ag.indexOf("android")!==-1){ae=2;Y=new Array(2);ac=ad}else{ae=5;Y=new Array(4);if(ah&&ah.indexOf("mp4a.40.5")!==-1||!ah&&ad>=6){ac=ad-3}else{if(ah&&ah.indexOf("mp4a.40.2")!==-1&&(ad>=6||Z===1)){ae=2;Y=new Array(2)}ac=ad}}}Y[0]=ae<<3;Y[0]|=(ad&14)>>1;Y[1]|=(ad&1)<<7;Y[1]|=Z<<3;if(ae===5){Y[1]|=(ac&14)>>1;Y[2]=(ac&1)<<7;Y[2]|=2<<2;Y[3]=0}return{config:Y,samplerate:af[ad],channelCount:Z,codec:"mp4a.40."+ae}}},{key:"destroy",value:function V(){}}],[{key:"probe",value:function T(ab){var aa=new O["default"](ab),Z,Y;if(aa.hasTimeStamp){for(Z=aa.length,Y=ab.length;Z<Y-1;Z++){if(ab[Z]===255&&(ab[Z+1]&240)===240){return true}}}return false}}]);return X})();M["default"]=P;I.exports=M["default"]},{"../demux/id3":14,"../errors":16,"../utils/logger":26}],10:[function(J,I,N){Object.defineProperty(N,"__esModule",{value:true});var L=(function(){function W(aa,Y){for(var X=0;X<Y.length;X++){var Z=Y[X];Z.enumerable=Z.enumerable||false;Z.configurable=true;if("value" in Z){Z.writable=true}Object.defineProperty(aa,Z.key,Z)}}return function(Z,X,Y){if(X){W(Z.prototype,X)}if(Y){W(Z,Y)}return Z}})();function V(W){return W&&W.__esModule?W:{"default":W}}function O(W,X){if(!(W instanceof X)){throw new TypeError("Cannot call a class as a function")}}var P=J("../events");var Q=V(P);var K=J("../errors");var T=J("../demux/aacdemuxer");var S=V(T);var U=J("../demux/tsdemuxer");var R=V(U);var M=(function(){function Y(aa,Z){O(this,Y);this.hls=aa;this.remuxer=Z}L(Y,[{key:"destroy",value:function X(){var Z=this.demuxer;if(Z){Z.destroy()}}},{key:"push",value:function W(af,ah,ae,ag,ac,Z,ab,ad){var aa=this.demuxer;if(!aa){if(R["default"].probe(af)){aa=this.demuxer=new R["default"](this.hls,this.remuxer)}else{if(S["default"].probe(af)){aa=this.demuxer=new S["default"](this.hls,this.remuxer)}else{this.hls.trigger(Q["default"].ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"no demux matching with content found"});return}}}aa.push(af,ah,ae,ag,ac,Z,ab,ad)}}]);return Y})();N["default"]=M;I.exports=N["default"]},{"../demux/aacdemuxer":9,"../demux/tsdemuxer":15,"../errors":16,"../events":17}],11:[function(L,I,N){Object.defineProperty(N,"__esModule",{value:true});function U(V){return V&&V.__esModule?V:{"default":V}}var M=L("../demux/demuxer-inline");var K=U(M);var P=L("../events");var S=U(P);var R=L("events");var O=U(R);var T=L("../remux/mp4-remuxer");var Q=U(T);var J=function J(W){var V=new O["default"]();V.trigger=function X(ab){for(var Z=arguments.length,ac=Array(Z>1?Z-1:0),aa=1;aa<Z;aa++){ac[aa-1]=arguments[aa]}V.emit.apply(V,[ab,ab].concat(ac))};V.off=function Y(ab){for(var Z=arguments.length,ac=Array(Z>1?Z-1:0),aa=1;aa<Z;aa++){ac[aa-1]=arguments[aa]}V.removeListener.apply(V,[ab].concat(ac))};W.addEventListener("message",function(Z){switch(Z.data.cmd){case"init":W.demuxer=new K["default"](V,Q["default"]);break;case"demux":var aa=Z.data;W.demuxer.push(new Uint8Array(aa.data),aa.audioCodec,aa.videoCodec,aa.timeOffset,aa.cc,aa.level,aa.sn,aa.duration);break;default:break}});V.on(S["default"].FRAG_PARSING_INIT_SEGMENT,function(ab,ac){var Z={event:ab};var aa=[];if(ac.audioCodec){Z.audioCodec=ac.audioCodec;Z.audioMoov=ac.audioMoov.buffer;Z.audioChannelCount=ac.audioChannelCount;aa.push(Z.audioMoov)}if(ac.videoCodec){Z.videoCodec=ac.videoCodec;Z.videoMoov=ac.videoMoov.buffer;Z.videoWidth=ac.videoWidth;Z.videoHeight=ac.videoHeight;aa.push(Z.videoMoov)}W.postMessage(Z,aa)});V.on(S["default"].FRAG_PARSING_DATA,function(aa,ab){var Z={event:aa,type:ab.type,startPTS:ab.startPTS,endPTS:ab.endPTS,startDTS:ab.startDTS,endDTS:ab.endDTS,moof:ab.moof.buffer,mdat:ab.mdat.buffer,nb:ab.nb};W.postMessage(Z,[Z.moof,Z.mdat])});V.on(S["default"].FRAG_PARSED,function(Z){W.postMessage({event:Z})});V.on(S["default"].ERROR,function(Z,aa){W.postMessage({event:Z,data:aa})});V.on(S["default"].FRAG_PARSING_METADATA,function(aa,ab){var Z={event:aa,samples:ab.samples};W.postMessage(Z)})};N["default"]=J;I.exports=N["default"]},{"../demux/demuxer-inline":10,"../events":17,"../remux/mp4-remuxer":24,events:1}],12:[function(O,K,Z){Object.defineProperty(Z,"__esModule",{value:true});var V=(function(){function aa(ae,ac){for(var ab=0;ab<ac.length;ab++){var ad=ac[ab];ad.enumerable=ad.enumerable||false;ad.configurable=true;if("value" in ad){ad.writable=true}Object.defineProperty(ae,ad.key,ad)}}return function(ad,ab,ac){if(ab){aa(ad.prototype,ab)}if(ac){aa(ad,ac)}return ad}})();function I(aa){return aa&&aa.__esModule?aa:{"default":aa}}function M(aa,ab){if(!(aa instanceof ab)){throw new TypeError("Cannot call a class as a function")}}var Q=O("../events");var N=I(Q);var S=O("../demux/demuxer-inline");var W=I(S);var U=O("../demux/demuxer-worker");var P=I(U);var R=O("../utils/logger");var J=O("../remux/mp4-remuxer");var L=I(J);var X=O("../crypt/decrypter");var T=I(X);var Y=(function(){function ab(ag){M(this,ab);this.hls=ag;if(ag.config.enableWorker&&typeof Worker!=="undefined"){R.logger.log("demuxing in webworker");try{var af=O("webworkify");this.w=af(P["default"]);this.onwmsg=this.onWorkerMessage.bind(this);this.w.addEventListener("message",this.onwmsg);this.w.postMessage({cmd:"init"})}catch(ah){R.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline");this.demuxer=new W["default"](ag,L["default"])}}else{this.demuxer=new W["default"](ag,L["default"])}this.demuxInitialized=true}V(ab,[{key:"destroy",value:function ad(){if(this.w){this.w.removeEventListener("message",this.onwmsg);this.w.terminate();this.w=null}else{this.demuxer.destroy();this.demuxer=null}if(this.decrypter){this.decrypter.destroy();this.decrypter=null}}},{key:"pushDecrypted",value:function ae(ah,aj,ag,af,am,al,ak,ai){if(this.w){this.w.postMessage({cmd:"demux",data:ah,audioCodec:aj,videoCodec:ag,timeOffset:af,cc:am,level:al,sn:ak,duration:ai},[ah])}else{this.demuxer.push(new Uint8Array(ah),aj,ag,af,am,al,ak,ai)}}},{key:"push",value:function aa(ak,ao,aj,am,ah,af,ag,ai,an){if(ak.byteLength>0&&an!=null&&an.key!=null&&an.method==="AES-128"){if(this.decrypter==null){this.decrypter=new T["default"](this.hls)}var al=this;this.decrypter.decrypt(ak,an.key,an.iv,function(ap){al.pushDecrypted(ap,ao,aj,am,ah,af,ag,ai)})}else{this.pushDecrypted(ak,ao,aj,am,ah,af,ag,ai)}}},{key:"onWorkerMessage",value:function ac(af){switch(af.data.event){case N["default"].FRAG_PARSING_INIT_SEGMENT:var ag={};if(af.data.audioMoov){ag.audioMoov=new Uint8Array(af.data.audioMoov);ag.audioCodec=af.data.audioCodec;ag.audioChannelCount=af.data.audioChannelCount}if(af.data.videoMoov){ag.videoMoov=new Uint8Array(af.data.videoMoov);ag.videoCodec=af.data.videoCodec;ag.videoWidth=af.data.videoWidth;ag.videoHeight=af.data.videoHeight}this.hls.trigger(N["default"].FRAG_PARSING_INIT_SEGMENT,ag);break;case N["default"].FRAG_PARSING_DATA:this.hls.trigger(N["default"].FRAG_PARSING_DATA,{moof:new Uint8Array(af.data.moof),mdat:new Uint8Array(af.data.mdat),startPTS:af.data.startPTS,endPTS:af.data.endPTS,startDTS:af.data.startDTS,endDTS:af.data.endDTS,type:af.data.type,nb:af.data.nb});break;case N["default"].FRAG_PARSING_METADATA:this.hls.trigger(N["default"].FRAG_PARSING_METADATA,{samples:af.data.samples});break;default:this.hls.trigger(af.data.event,af.data.data);break}}}]);return ab})();Z["default"]=Y;K.exports=Z["default"]},{"../crypt/decrypter":8,"../demux/demuxer-inline":10,"../demux/demuxer-worker":11,"../events":17,"../remux/mp4-remuxer":24,"../utils/logger":26,webworkify:2}],13:[function(K,M,J){Object.defineProperty(J,"__esModule",{value:true});var L=(function(){function P(T,R){for(var Q=0;Q<R.length;Q++){var S=R[Q];S.enumerable=S.enumerable||false;S.configurable=true;if("value" in S){S.writable=true}Object.defineProperty(T,S.key,S)}}return function(S,Q,R){if(Q){P(S.prototype,Q)}if(R){P(S,R)}return S}})();function O(P,Q){if(!(P instanceof Q)){throw new TypeError("Cannot call a class as a function")}}var I=K("../utils/logger");var N=(function(){function ab(ad){O(this,ab);this.data=ad;this.bytesAvailable=this.data.byteLength;this.word=0;this.bitsAvailable=0}L(ab,[{key:"loadWord",value:function S(){var ae=this.data.byteLength-this.bytesAvailable,ad=new Uint8Array(4),af=Math.min(4,this.bytesAvailable);if(af===0){throw new Error("no bytes available")}ad.set(this.data.subarray(ae,ae+af));this.word=new DataView(ad.buffer).getUint32(0);this.bitsAvailable=af*8;this.bytesAvailable-=af}},{key:"skipBits",value:function ac(ad){var ae;if(this.bitsAvailable>ad){this.word<<=ad;this.bitsAvailable-=ad}else{ad-=this.bitsAvailable;ae=ad>>3;ad-=ae>>3;this.bytesAvailable-=ae;this.loadWord();this.word<<=ad;this.bitsAvailable-=ad}}},{key:"readBits",value:function X(ad){var af=Math.min(this.bitsAvailable,ad),ae=this.word>>>32-af;if(ad>32){I.logger.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=af;if(this.bitsAvailable>0){this.word<<=af}else{if(this.bytesAvailable>0){this.loadWord()}}af=ad-af;if(af>0){return ae<<af|this.readBits(af)}else{return ae}}},{key:"skipLZ",value:function V(){var ad;for(ad=0;ad<this.bitsAvailable;++ad){if(0!==(this.word&2147483648>>>ad)){this.word<<=ad;this.bitsAvailable-=ad;return ad}}this.loadWord();return ad+this.skipLZ()}},{key:"skipUEG",value:function R(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function Z(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function Y(){var ad=this.skipLZ();return this.readBits(ad+1)-1}},{key:"readEG",value:function U(){var ad=this.readUEG();if(1&ad){return 1+ad>>>1}else{return -1*(ad>>>1)}}},{key:"readBoolean",value:function P(){return 1===this.readBits(1)}},{key:"readUByte",value:function T(){return this.readBits(8)}},{key:"skipScalingList",value:function Q(ag){var ae=8,af=8,ad,ah;for(ad=0;ad<ag;ad++){if(af!==0){ah=this.readEG();af=(ae+ah+256)%256}ae=af===0?ae:af}}},{key:"readSPS",value:function aa(){var an=0,ao=0,aj=0,ap=0,af=1,at,ad,am,ah,ae,ai,av,ak,aq;this.readUByte();at=this.readUByte();ad=this.readBits(5);this.skipBits(3);am=this.readUByte();this.skipUEG();if(at===100||at===110||at===122||at===144){var ag=this.readUEG();if(ag===3){this.skipBits(1)}this.skipUEG();this.skipUEG();this.skipBits(1);if(this.readBoolean()){ak=ag!==3?8:12;for(aq=0;aq<ak;aq++){if(this.readBoolean()){if(aq<6){this.skipScalingList(16)}else{this.skipScalingList(64)}}}}}this.skipUEG();var au=this.readUEG();if(au===0){this.readUEG()}else{if(au===1){this.skipBits(1);this.skipEG();this.skipEG();ah=this.readUEG();for(aq=0;aq<ah;aq++){this.skipEG()}}}this.skipUEG();this.skipBits(1);ae=this.readUEG();ai=this.readUEG();av=this.readBits(1);if(av===0){this.skipBits(1)}this.skipBits(1);if(this.readBoolean()){an=this.readUEG();ao=this.readUEG();aj=this.readUEG();ap=this.readUEG()}if(this.readBoolean()){if(this.readBoolean()){var ar=undefined;var al=this.readUByte();switch(al){case 2:ar=[12,11];break;case 3:ar=[10,11];break;case 4:ar=[16,11];break;case 5:ar=[40,33];break;case 6:ar=[24,11];break;case 7:ar=[20,11];break;case 8:ar=[32,11];break;case 9:ar=[80,33];break;case 10:ar=[18,11];break;case 11:ar=[15,11];break;case 12:ar=[64,33];break;case 13:ar=[160,99];break;case 14:ar=[4,3];break;case 15:ar=[3,2];break;case 16:ar=[2,1];break;case 255:ar=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()];break}if(ar){af=ar[0]/ar[1]}}}return{width:((ae+1)*16-an*2-ao*2)*af,height:(2-av)*(ai+1)*16-(av?2:4)*(aj+ap)}}},{key:"readSliceType",value:function W(){this.readUByte();this.readUEG();return this.readUEG()}}]);return ab})();J["default"]=N;M.exports=J["default"]},{"../utils/logger":26}],14:[function(L,N,K){Object.defineProperty(K,"__esModule",{value:true});var M=(function(){function P(T,R){for(var Q=0;Q<R.length;Q++){var S=R[Q];S.enumerable=S.enumerable||false;S.configurable=true;if("value" in S){S.writable=true}Object.defineProperty(T,S.key,S)}}return function(S,Q,R){if(Q){P(S.prototype,Q)}if(R){P(S,R)}return S}})();function O(P,Q){if(!(P instanceof Q)){throw new TypeError("Cannot call a class as a function")}}var J=L("../utils/logger");var I=(function(){function P(W){O(this,P);this._hasTimeStamp=false;var V=0,ac,ab,aa,Z,T,U,X,Y;do{X=this.readUTF(W,V,3);V+=3;if(X==="ID3"){V+=3;ac=W[V++]&127;ab=W[V++]&127;aa=W[V++]&127;Z=W[V++]&127;T=(ac<<21)+(ab<<14)+(aa<<7)+Z;U=V+T;this._parseID3Frames(W,V,U);V=U}else{if(X==="3DI"){V+=7;J.logger.log("3DI footer found, end: "+V)}else{V-=3;Y=V;if(Y){if(!this.hasTimeStamp){J.logger.warn("ID3 tag found, but no timestamp")}this._length=Y;this._payload=W.subarray(0,Y)}return}}}while(true)}M(P,[{key:"readUTF",value:function S(W,Y,U){var T="",X=Y,V=Y+U;do{T+=String.fromCharCode(W[X++])}while(X<V);return T}},{key:"_parseID3Frames",value:function R(Z,Y,T){var V,ab,W,X,aa;while(Y+8<=T){V=this.readUTF(Z,Y,4);Y+=4;ab=Z[Y++]<<24+Z[Y++]<<16+Z[Y++]<<8+Z[Y++];X=Z[Y++]<<8+Z[Y++];W=Y;switch(V){case"PRIV":if(this.readUTF(Z,Y,44)==="com.apple.streaming.transportStreamTimestamp"){Y+=44;Y+=4;var U=Z[Y++]&1;this._hasTimeStamp=true;aa=((Z[Y++]<<23)+(Z[Y++]<<15)+(Z[Y++]<<7)+Z[Y++])/45;if(U){aa+=47721858.84}aa=Math.round(aa);J.logger.trace("ID3 timestamp found: "+aa);this._timeStamp=aa}break;default:break}}}},{key:"hasTimeStamp",get:function Q(){return this._hasTimeStamp}},{key:"timeStamp",get:function Q(){return this._timeStamp}},{key:"length",get:function Q(){return this._length}},{key:"payload",get:function Q(){return this._payload}}]);return P})();K["default"]=I;N.exports=K["default"]},{"../utils/logger":26}],15:[function(K,I,O){Object.defineProperty(O,"__esModule",{value:true});var M=(function(){function V(Z,X){for(var W=0;W<X.length;W++){var Y=X[W];Y.enumerable=Y.enumerable||false;Y.configurable=true;if("value" in Y){Y.writable=true}Object.defineProperty(Z,Y.key,Y)}}return function(Y,W,X){if(W){V(Y.prototype,W)}if(X){V(Y,X)}return Y}})();function U(V){return V&&V.__esModule?V:{"default":V}}function P(V,W){if(!(V instanceof W)){throw new TypeError("Cannot call a class as a function")}}var Q=K("../events");var R=U(Q);var S=K("./exp-golomb");var J=U(S);var T=K("../utils/logger");var L=K("../errors");var N=(function(){function ab(ak,al){P(this,ab);this.observer=ak;this.remuxerClass=al;this.lastCC=0;this.PES_TIMESCALE=90000;this.remuxer=new this.remuxerClass(ak)}M(ab,[{key:"switchLevel",value:function af(){this.pmtParsed=false;this._pmtId=-1;this._avcTrack={type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0};this._aacTrack={type:"audio",id:-1,sequenceNumber:0,samples:[],len:0};this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0};this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function ag(){this.switchLevel();this.remuxer.insertDiscontinuity()}},{key:"push",value:function ad(aE,am,ay,aq,at,al,aB,ak){var ap,aC,av,an,aA=aE.length,aw,ar,aF,ao;this.audioCodec=am;this.videoCodec=ay;this.timeOffset=aq;this._duration=ak;this.contiguous=false;if(at!==this.lastCC){T.logger.log("discontinuity detected");this.insertDiscontinuity();this.lastCC=at}else{if(al!==this.lastLevel){T.logger.log("level switch detected");this.switchLevel();this.lastLevel=al}else{if(aB===this.lastSN+1){this.contiguous=true}}}this.lastSN=aB;if(!this.contiguous){this.aacOverFlow=null}var ax=this.pmtParsed,aD=this._avcTrack.id,az=this._aacTrack.id,au=this._id3Track.id;for(an=0;an<aA;an+=188){if(aE[an]===71){aw=!!(aE[an+1]&64);ar=((aE[an+1]&31)<<8)+aE[an+2];aF=(aE[an+3]&48)>>4;if(aF>1){ao=an+5+aE[an+4];if(ao===an+188){continue}}else{ao=an+4}if(ax){if(ar===aD){if(aw){if(ap){this._parseAVCPES(this._parsePES(ap))}ap={data:[],size:0}}if(ap){ap.data.push(aE.subarray(ao,an+188));ap.size+=an+188-ao}}else{if(ar===az){if(aw){if(aC){this._parseAACPES(this._parsePES(aC))}aC={data:[],size:0}}if(aC){aC.data.push(aE.subarray(ao,an+188));aC.size+=an+188-ao}}else{if(ar===au){if(aw){if(av){this._parseID3PES(this._parsePES(av))}av={data:[],size:0}}if(av){av.data.push(aE.subarray(ao,an+188));av.size+=an+188-ao}}}}}else{if(aw){ao+=aE[ao]+1}if(ar===0){this._parsePAT(aE,ao)}else{if(ar===this._pmtId){this._parsePMT(aE,ao);ax=this.pmtParsed=true;aD=this._avcTrack.id;az=this._aacTrack.id;au=this._id3Track.id}}}}else{this.observer.trigger(R["default"].ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(ap){this._parseAVCPES(this._parsePES(ap))}if(aC){this._parseAACPES(this._parsePES(aC))}if(av){this._parseID3PES(this._parsePES(av))}this.remux()}},{key:"remux",value:function ac(){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this.timeOffset,this.contiguous)}},{key:"destroy",value:function ah(){this.switchLevel();this._initPTS=this._initDTS=undefined;this._duration=0}},{key:"_parsePAT",value:function aa(ak,al){this._pmtId=(ak[al+10]&31)<<8|ak[al+11]}},{key:"_parsePMT",value:function Y(ao,ap){var ak,an,am,al;ak=(ao[ap+1]&15)<<8|ao[ap+2];an=ap+3+ak-4;am=(ao[ap+10]&15)<<8|ao[ap+11];ap+=12+am;while(ap<an){al=(ao[ap+1]&31)<<8|ao[ap+2];switch(ao[ap]){case 15:this._aacTrack.id=al;break;case 21:this._id3Track.id=al;break;case 27:this._avcTrack.id=al;break;default:T.logger.log("unkown stream type:"+ao[ap]);break}ap+=((ao[ap+3]&15)<<8|ao[ap+4])+5}}},{key:"_parsePES",value:function aj(ar){var an=0,at,ak,am,al,av,ao,ap,au,aq;at=ar.data[0];am=(at[0]<<16)+(at[1]<<8)+at[2];if(am===1){al=(at[4]<<8)+at[5];ak=at[7];if(ak&192){ap=(at[9]&14)*536870912+(at[10]&255)*4194304+(at[11]&254)*16384+(at[12]&255)*128+(at[13]&254)/2;if(ap>4294967295){ap-=8589934592}if(ak&64){au=(at[14]&14)*536870912+(at[15]&255)*4194304+(at[16]&254)*16384+(at[17]&255)*128+(at[18]&254)/2;if(au>4294967295){au-=8589934592}}else{au=ap}}av=at[8];aq=av+9;ar.data[0]=ar.data[0].subarray(aq);ar.size-=aq;ao=new Uint8Array(ar.size);while(ar.data.length){at=ar.data.shift();ao.set(at,an);an+=at.byteLength}return{data:ao,pts:ap,dts:au,len:al}}else{return null}}},{key:"_parseAVCPES",value:function ai(an){var ar=this;var am=this._avcTrack,ax=am.samples,at=this._parseAVCNALu(an.data),az=[],ak=false,ay=false,al=0,aq,aw;if(at.length===0&&ax.length>0){var av=ax[ax.length-1];var au=av.units.units[av.units.units.length-1];var ap=new Uint8Array(au.data.byteLength+an.data.byteLength);ap.set(au.data,0);ap.set(an.data,au.data.byteLength);au.data=ap;av.units.length+=an.data.byteLength;am.len+=an.data.byteLength}an.data=null;var ao="";at.forEach(function(aF){switch(aF.type){case 1:aw=true;if(ak){ao+="NDR "}break;case 5:aw=true;if(ak){ao+="IDR "}ay=true;break;case 6:aw=true;if(ak){ao+="SEI "}break;case 7:aw=true;if(ak){ao+="SPS "}if(!am.sps){var aG=new J["default"](aF.data);var aC=aG.readSPS();am.width=aC.width;am.height=aC.height;am.sps=[aF.data];am.timescale=ar.remuxer.timescale;am.duration=ar.remuxer.timescale*ar._duration;var aA=aF.data.subarray(1,4);var aB="avc1.";for(var aD=0;aD<3;aD++){var aE=aA[aD].toString(16);if(aE.length<2){aE="0"+aE}aB+=aE}am.codec=aB}break;case 8:aw=true;if(ak){ao+="PPS "}if(!am.pps){am.pps=[aF.data]}break;case 9:aw=true;if(ak){ao+="AUD "}break;default:aw=false;ao+="unknown NAL "+aF.type+" ";break}if(aw){az.push(aF);al+=aF.data.byteLength}});if(ak||ao.length){T.logger.log(ao)}if(az.length){if(ay===true||am.sps){aq={units:{units:az,length:al},pts:an.pts,dts:an.dts,key:ay};ax.push(aq);am.len+=al;am.nbNalu+=az.length}}}},{key:"_parseAVCNALu",value:function Z(ar){var ao=0,ap=ar.byteLength,ax,al,ak=0;var at=[],ay,aw,aq,am;while(ao<ap){ax=ar[ao++];switch(ak){case 0:if(ax===0){ak=1}break;case 1:if(ax===0){ak=2}else{ak=0}break;case 2:case 3:if(ax===0){ak=3}else{if(ax===1){aw=ar[ao]&31;if(aq){ay={data:ar.subarray(aq,ao-ak-1),type:am};at.push(ay)}else{al=ao-ak-1;if(al){if(this._avcTrack.samples.length){var av=this._avcTrack.samples[this._avcTrack.samples.length-1];var au=av.units.units[av.units.units.length-1];var an=new Uint8Array(au.data.byteLength+al);an.set(au.data,0);an.set(ar.subarray(0,al),au.data.byteLength);au.data=an;av.units.length+=al;this._avcTrack.len+=al}}}aq=ao;am=aw;if(aw===1||aw===5){ao=ap}ak=0}else{ak=0}}break;default:break}}if(aq){ay={data:ar.subarray(aq,ap),type:am};at.push(ay)}return at}},{key:"_parseAACPES",value:function ae(an){var al=this._aacTrack,ao,ar=an.data,am,aw,ax,ay,ak,ap,au;if(this.aacOverFlow){var aq=new Uint8Array(this.aacOverFlow.byteLength+ar.byteLength);aq.set(this.aacOverFlow,0);aq.set(ar,this.aacOverFlow.byteLength);ar=aq}for(ax=0,au=ar.length;ax<au-1;ax++){if(ar[ax]===255&&(ar[ax+1]&240)===240){break}}if(ax){var at,av;if(ax<au-1){at="AAC PES did not start with ADTS header,offset:"+ax;av=false}else{at="no ADTS header found in AAC PES";av=true}this.observer.trigger(R["default"].ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:av,reason:at});if(av){return}}if(!al.audiosamplerate){am=this._ADTStoAudioConfig(ar,ax,this.audioCodec);al.config=am.config;al.audiosamplerate=am.samplerate;al.channelCount=am.channelCount;al.codec=am.codec;al.timescale=this.remuxer.timescale;al.duration=this.remuxer.timescale*this._duration;T.logger.log("parsed codec:"+al.codec+",rate:"+am.samplerate+",nb channel:"+am.channelCount)}ap=0;while(ax+5<au){aw=(ar[ax+3]&3)<<11;aw|=ar[ax+4]<<3;aw|=(ar[ax+5]&224)>>>5;ay=!!(ar[ax+1]&1)?7:9;aw-=ay;ak=Math.round(an.pts+ap*1024*this.PES_TIMESCALE/al.audiosamplerate);if(aw>0&&ax+ay+aw<=au){ao={unit:ar.subarray(ax+ay,ax+ay+aw),pts:ak,dts:ak};this._aacTrack.samples.push(ao);this._aacTrack.len+=aw;ax+=aw+ay;ap++;for(;ax<au-1;ax++){if(ar[ax]===255&&(ar[ax+1]&240)===240){break}}}else{break}}if(ax<au){this.aacOverFlow=ar.subarray(ax,au)}else{this.aacOverFlow=null}}},{key:"_ADTStoAudioConfig",value:function V(an,am,au){var aq,ap,ao,al,ak,at=navigator.userAgent.toLowerCase(),ar=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];aq=((an[am+2]&192)>>>6)+1;ap=(an[am+2]&60)>>>2;if(ap>ar.length-1){this.observer.trigger(R["default"].ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+ap});return}al=(an[am+2]&1)<<2;al|=(an[am+3]&192)>>>6;T.logger.log("manifest codec:"+au+",ADTS data:type:"+aq+",sampleingIndex:"+ap+"["+ar[ap]+"Hz],channelConfig:"+al);if(at.indexOf("firefox")!==-1){if(ap>=6){aq=5;ak=new Array(4);ao=ap-3}else{aq=2;ak=new Array(2);ao=ap}}else{if(at.indexOf("android")!==-1){aq=2;ak=new Array(2);ao=ap}else{aq=5;ak=new Array(4);if(au&&(au.indexOf("mp4a.40.29")!==-1||au.indexOf("mp4a.40.5")!==-1)||!au&&ap>=6){ao=ap-3}else{if(au&&au.indexOf("mp4a.40.2")!==-1&&(ap>=6||al===1)||!au&&al===1){aq=2;ak=new Array(2)}ao=ap}}}ak[0]=aq<<3;ak[0]|=(ap&14)>>1;ak[1]|=(ap&1)<<7;ak[1]|=al<<3;if(aq===5){ak[1]|=(ao&14)>>1;ak[2]=(ao&1)<<7;ak[2]|=2<<2;ak[3]=0}return{config:ak,samplerate:ar[ap],channelCount:al,codec:"mp4a.40."+aq}}},{key:"_parseID3PES",value:function W(ak){this._id3Track.samples.push(ak)}}],[{key:"probe",value:function X(ak){if(ak.length>=3*188&&ak[0]===71&&ak[188]===71&&ak[2*188]===71){return true}else{return false}}}]);return ab})();O["default"]=N;I.exports=O["default"]},{"../errors":16,"../events":17,"../utils/logger":26,"./exp-golomb":13}],16:[function(K,M,J){Object.defineProperty(J,"__esModule",{value:true});var L={NETWORK_ERROR:"hlsNetworkError",MEDIA_ERROR:"hlsMediaError",OTHER_ERROR:"hlsOtherError"};J.ErrorTypes=L;var I={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError"};J.ErrorDetails=I},{}],17:[function(J,K,I){Object.defineProperty(I,"__esModule",{value:true});I["default"]={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsPTSUpdated",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_METADATA:"hlsFraParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFPSDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded"};K.exports=I["default"]},{}],18:[function(K,M,J){Object.defineProperty(J,"__esModule",{value:true});var L=(function(){function P(T,R){for(var Q=0;Q<R.length;Q++){var S=R[Q];S.enumerable=S.enumerable||false;S.configurable=true;if("value" in S){S.writable=true}Object.defineProperty(T,S.key,S)}}return function(S,Q,R){if(Q){P(S.prototype,Q)}if(R){P(S,R)}return S}})();function N(P,Q){if(!(P instanceof Q)){throw new TypeError("Cannot call a class as a function")}}var I=K("../utils/logger");var O=(function(){function S(){N(this,S)}L(S,null,[{key:"mergeDetails",value:function P(T,X){var U=Math.max(T.startSN,X.startSN)-X.startSN,W=Math.min(T.endSN,X.endSN)-X.startSN,ae=X.startSN-T.startSN,ad=T.fragments,Z=X.fragments,ac=0,V;if(W<U){X.PTSKnown=false;return}for(var Y=U;Y<=W;Y++){var af=ad[ae+Y],ab=Z[Y];ac=af.cc-ab.cc;if(!isNaN(af.startPTS)){ab.start=ab.startPTS=af.startPTS;ab.endPTS=af.endPTS;ab.duration=af.duration;V=ab}}if(ac){I.logger.log("discontinuity sliding from playlist, take drift into account");for(Y=0;Y<Z.length;Y++){Z[Y].cc+=ac}}if(V){S.updateFragPTS(X,V.sn,V.startPTS,V.endPTS)}else{var aa=ad[ae].start;for(Y=0;Y<Z.length;Y++){Z[Y].start+=aa}}X.PTSKnown=T.PTSKnown;return}},{key:"updateFragPTS",value:function R(T,U,V,aa){var Y,X,ab,W;if(U<T.startSN||U>T.endSN){return 0}Y=U-T.startSN;X=T.fragments;ab=X[Y];if(!isNaN(ab.startPTS)){V=Math.max(V,ab.startPTS);aa=Math.min(aa,ab.endPTS)}var Z=V-ab.start;ab.start=ab.startPTS=V;ab.endPTS=aa;ab.duration=aa-V;for(W=Y;W>0;W--){S.updatePTS(X,W,W-1)}for(W=Y;W<X.length-1;W++){S.updatePTS(X,W,W+1)}T.PTSKnown=true;return Z}},{key:"updatePTS",value:function Q(U,W,Y){var T=U[W],V=U[Y],X=V.startPTS;if(!isNaN(X)){if(Y>W){T.duration=X-T.start;if(T.duration<0){I.logger.error("negative duration computed for "+T+", there should be some duration drift between playlist and fragment!")}}else{V.duration=T.start-X;if(V.duration<0){I.logger.error("negative duration computed for "+V+", there should be some duration drift between playlist and fragment!")}}}else{if(Y>W){V.start=T.start+T.duration}else{V.start=T.start-V.duration}}}}]);return S})();J["default"]=O;M.exports=J["default"]},{"../utils/logger":26}],19:[function(T,K,ah){Object.defineProperty(ah,"__esModule",{value:true});var ac=(function(){function aj(an,al){for(var ak=0;ak<al.length;ak++){var am=al[ak];am.enumerable=am.enumerable||false;am.configurable=true;if("value" in am){am.writable=true}Object.defineProperty(an,am.key,am)}}return function(am,ak,al){if(ak){aj(am.prototype,ak)}if(al){aj(am,al)}return am}})();function J(aj){return aj&&aj.__esModule?aj:{"default":aj}}function O(aj,ak){if(!(aj instanceof ak)){throw new TypeError("Cannot call a class as a function")}}var U=T("./events");var S=J(U);var ad=T("./errors");var ai=T("./loader/playlist-loader");var W=J(ai);var P=T("./loader/fragment-loader");var N=J(P);var V=T("./controller/abr-controller");var I=J(V);var aa=T("./controller/mse-media-controller");var Z=J(aa);var L=T("./controller/level-controller");var af=J(L);var Y=T("./utils/logger");var ag=T("./utils/xhr-loader");var ab=J(ag);var R=T("events");var Q=J(R);var X=T("./loader/key-loader");var ae=J(X);var M=(function(){ac(ak,null,[{key:"isSupported",value:function al(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function am(){return S["default"]}},{key:"ErrorTypes",get:function am(){return ad.ErrorTypes}},{key:"ErrorDetails",get:function am(){return ad.ErrorDetails}}]);function ak(){var ay=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];O(this,ak);var av={autoStartLoad:true,debug:false,maxBufferLength:30,maxBufferSize:60*1000*1000,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,maxMaxBufferLength:600,enableWorker:true,enableSoftwareAES:true,fragLoadingTimeOut:20000,fragLoadingMaxRetry:1,fragLoadingRetryDelay:1000,fragLoadingLoopThreshold:3,manifestLoadingTimeOut:10000,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1000,appendErrorMaxRetry:200,loader:ab["default"],fLoader:undefined,pLoader:undefined,abrController:I["default"],mediaController:Z["default"]};for(var aA in av){if(aA in ay){continue}ay[aA]=av[aA]}if(ay.liveMaxLatencyDurationCount!==undefined&&ay.liveMaxLatencyDurationCount<=ay.liveSyncDurationCount){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"')}(0,Y.enableLogs)(ay.debug);this.config=ay;var aw=this.observer=new Q["default"]();aw.trigger=function ax(aD){for(var aB=arguments.length,aE=Array(aB>1?aB-1:0),aC=1;aC<aB;aC++){aE[aC-1]=arguments[aC]}aw.emit.apply(aw,[aD,aD].concat(aE))};aw.off=function az(aD){for(var aB=arguments.length,aE=Array(aB>1?aB-1:0),aC=1;aC<aB;aC++){aE[aC-1]=arguments[aC]}aw.removeListener.apply(aw,[aD].concat(aE))};this.on=aw.on.bind(aw);this.off=aw.off.bind(aw);this.trigger=aw.trigger.bind(aw);this.playlistLoader=new W["default"](this);this.fragmentLoader=new N["default"](this);this.levelController=new af["default"](this);this.abrController=new ay.abrController(this);this.mediaController=new ay.mediaController(this);this.keyLoader=new ae["default"](this)}ac(ak,[{key:"destroy",value:function au(){Y.logger.log("destroy");this.trigger(S["default"].DESTROYING);this.detachMedia();this.playlistLoader.destroy();this.fragmentLoader.destroy();this.levelController.destroy();this.mediaController.destroy();this.keyLoader.destroy();this.url=null;this.observer.removeAllListeners()}},{key:"attachMedia",value:function ap(av){Y.logger.log("attachMedia");this.media=av;this.trigger(S["default"].MEDIA_ATTACHING,{media:av})}},{key:"detachMedia",value:function aq(){Y.logger.log("detachMedia");this.trigger(S["default"].MEDIA_DETACHING);this.media=null}},{key:"loadSource",value:function an(av){Y.logger.log("loadSource:"+av);this.url=av;this.trigger(S["default"].MANIFEST_LOADING,{url:av})}},{key:"startLoad",value:function ar(){Y.logger.log("startLoad");this.mediaController.startLoad()}},{key:"swapAudioCodec",value:function aj(){Y.logger.log("swapAudioCodec");this.mediaController.swapAudioCodec()}},{key:"recoverMediaError",value:function ao(){Y.logger.log("recoverMediaError");var av=this.media;this.detachMedia();this.attachMedia(av)}},{key:"levels",get:function am(){return this.levelController.levels}},{key:"currentLevel",get:function am(){return this.mediaController.currentLevel},set:function at(av){Y.logger.log("set currentLevel:"+av);this.loadLevel=av;this.mediaController.immediateLevelSwitch()}},{key:"nextLevel",get:function am(){return this.mediaController.nextLevel},set:function at(av){Y.logger.log("set nextLevel:"+av);this.levelController.manualLevel=av;this.mediaController.nextLevelSwitch()}},{key:"loadLevel",get:function am(){return this.levelController.level},set:function at(av){Y.logger.log("set loadLevel:"+av);this.levelController.manualLevel=av}},{key:"nextLoadLevel",get:function am(){return this.levelController.nextLoadLevel()},set:function at(av){this.levelController.level=av}},{key:"firstLevel",get:function am(){return this.levelController.firstLevel},set:function at(av){Y.logger.log("set firstLevel:"+av);this.levelController.firstLevel=av}},{key:"startLevel",get:function am(){return this.levelController.startLevel},set:function at(av){Y.logger.log("set startLevel:"+av);this.levelController.startLevel=av}},{key:"autoLevelCapping",get:function am(){return this.abrController.autoLevelCapping},set:function at(av){Y.logger.log("set autoLevelCapping:"+av);this.abrController.autoLevelCapping=av}},{key:"autoLevelEnabled",get:function am(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function am(){return this.levelController.manualLevel}}]);return ak})();ah["default"]=M;K.exports=ah["default"]},{"./controller/abr-controller":3,"./controller/level-controller":4,"./controller/mse-media-controller":5,"./errors":16,"./events":17,"./loader/fragment-loader":20,"./loader/key-loader":21,"./loader/playlist-loader":22,"./utils/logger":26,"./utils/xhr-loader":28,events:1}],20:[function(J,I,N){Object.defineProperty(N,"__esModule",{value:true});var L=(function(){function S(W,U){for(var T=0;T<U.length;T++){var V=U[T];V.enumerable=V.enumerable||false;V.configurable=true;if("value" in V){V.writable=true}Object.defineProperty(W,V.key,V)}}return function(V,T,U){if(T){S(V.prototype,T)}if(U){S(V,U)}return V}})();function R(S){return S&&S.__esModule?S:{"default":S}}function O(S,T){if(!(S instanceof T)){throw new TypeError("Cannot call a class as a function")}}var P=J("../events");var Q=R(P);var K=J("../errors");var M=(function(){function Y(Z){O(this,Y);this.hls=Z;this.onfl=this.onFragLoading.bind(this);Z.on(Q["default"].FRAG_LOADING,this.onfl)}L(Y,[{key:"destroy",value:function V(){if(this.loader){this.loader.destroy();this.loader=null}this.hls.off(Q["default"].FRAG_LOADING,this.onfl)}},{key:"onFragLoading",value:function X(aa,ab){var ac=ab.frag;this.frag=ac;this.frag.loaded=0;var Z=this.hls.config;ac.loader=this.loader=typeof Z.fLoader!=="undefined"?new Z.fLoader(Z):new Z.loader(Z);this.loader.load(ac.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),Z.fragLoadingTimeOut,Z.fragLoadingMaxRetry,Z.fragLoadingRetryDelay,this.loadprogress.bind(this),ac)}},{key:"loadsuccess",value:function T(aa,Z){var ab=aa.currentTarget.response;Z.length=ab.byteLength;this.frag.loader=undefined;this.hls.trigger(Q["default"].FRAG_LOADED,{payload:ab,frag:this.frag,stats:Z})}},{key:"loaderror",value:function W(Z){this.loader.abort();this.hls.trigger(Q["default"].ERROR,{type:K.ErrorTypes.NETWORK_ERROR,details:K.ErrorDetails.FRAG_LOAD_ERROR,fatal:false,frag:this.frag,response:Z})}},{key:"loadtimeout",value:function S(){this.loader.abort();this.hls.trigger(Q["default"].ERROR,{type:K.ErrorTypes.NETWORK_ERROR,details:K.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:false,frag:this.frag})}},{key:"loadprogress",value:function U(aa,Z){this.frag.loaded=Z.loaded;this.hls.trigger(Q["default"].FRAG_LOAD_PROGRESS,{frag:this.frag,stats:Z})}}]);return Y})();N["default"]=M;I.exports=N["default"]},{"../errors":16,"../events":17}],21:[function(J,I,M){Object.defineProperty(M,"__esModule",{value:true});var L=(function(){function S(W,U){for(var T=0;T<U.length;T++){var V=U[T];V.enumerable=V.enumerable||false;V.configurable=true;if("value" in V){V.writable=true}Object.defineProperty(W,V.key,V)}}return function(V,T,U){if(T){S(V.prototype,T)}if(U){S(V,U)}return V}})();function R(S){return S&&S.__esModule?S:{"default":S}}function N(S,T){if(!(S instanceof T)){throw new TypeError("Cannot call a class as a function")}}var O=J("../events");var P=R(O);var K=J("../errors");var Q=(function(){function Y(Z){N(this,Y);this.hls=Z;this.decryptkey=null;this.decrypturl=null;this.ondkl=this.onDecryptKeyLoading.bind(this);Z.on(P["default"].KEY_LOADING,this.ondkl)}L(Y,[{key:"destroy",value:function W(){if(this.loader){this.loader.destroy();this.loader=null}this.hls.off(P["default"].KEY_LOADING,this.ondkl)}},{key:"onDecryptKeyLoading",value:function T(ab,ad){var ae=this.frag=ad.frag,ac=ae.decryptdata,aa=ac.uri;if(aa!==this.decrypturl||this.decryptkey===null){var Z=this.hls.config;ae.loader=this.loader=new Z.loader(Z);this.decrypturl=aa;this.decryptkey=null;ae.loader.load(aa,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),Z.fragLoadingTimeOut,Z.fragLoadingMaxRetry,Z.fragLoadingRetryDelay,this.loadprogress.bind(this),ae)}else{if(this.decryptkey){ac.key=this.decryptkey;this.hls.trigger(P["default"].KEY_LOADED,{frag:ae})}}}},{key:"loadsuccess",value:function U(Z){var aa=this.frag;this.decryptkey=aa.decryptdata.key=new Uint8Array(Z.currentTarget.response);aa.loader=undefined;this.hls.trigger(P["default"].KEY_LOADED,{frag:aa})}},{key:"loaderror",value:function X(Z){this.loader.abort();this.hls.trigger(P["default"].ERROR,{type:K.ErrorTypes.NETWORK_ERROR,details:K.ErrorDetails.KEY_LOAD_ERROR,fatal:false,frag:this.frag,response:Z})}},{key:"loadtimeout",value:function S(){this.loader.abort();this.hls.trigger(P["default"].ERROR,{type:K.ErrorTypes.NETWORK_ERROR,details:K.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:false,frag:this.frag})}},{key:"loadprogress",value:function V(){}}]);return Y})();M["default"]=Q;I.exports=M["default"]},{"../errors":16,"../events":17}],22:[function(J,I,M){Object.defineProperty(M,"__esModule",{value:true});var L=(function(){function U(Y,W){for(var V=0;V<W.length;V++){var X=W[V];X.enumerable=X.enumerable||false;X.configurable=true;if("value" in X){X.writable=true}Object.defineProperty(Y,X.key,X)}}return function(X,V,W){if(V){U(X.prototype,V)}if(W){U(X,W)}return X}})();function S(U){return U&&U.__esModule?U:{"default":U}}function N(U,V){if(!(U instanceof V)){throw new TypeError("Cannot call a class as a function")}}var O=J("../events");var P=S(O);var K=J("../errors");var T=J("../utils/url");var Q=S(T);var R=(function(){function ae(ai){N(this,ae);this.hls=ai;this.onml=this.onManifestLoading.bind(this);this.onll=this.onLevelLoading.bind(this);ai.on(P["default"].MANIFEST_LOADING,this.onml);ai.on(P["default"].LEVEL_LOADING,this.onll)}L(ae,[{key:"destroy",value:function ad(){if(this.loader){this.loader.destroy();this.loader=null}this.url=this.id=null;this.hls.off(P["default"].MANIFEST_LOADING,this.onml);this.hls.off(P["default"].LEVEL_LOADING,this.onll)}},{key:"onManifestLoading",value:function Z(ai,aj){this.load(aj.url,null)}},{key:"onLevelLoading",value:function V(ai,aj){this.load(aj.url,aj.level,aj.id)}},{key:"load",value:function af(aj,al,ak){var ai=this.hls.config;this.url=aj;this.id=al;this.id2=ak;this.loader=typeof ai.pLoader!=="undefined"?new ai.pLoader(ai):new ai.loader(ai);this.loader.load(aj,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),ai.manifestLoadingTimeOut,ai.manifestLoadingMaxRetry,ai.manifestLoadingRetryDelay)}},{key:"resolve",value:function ag(ai,aj){return Q["default"].buildAbsoluteURL(aj,ai)}},{key:"parseMasterPlaylist",value:function ab(ak,ap){var an=[],ao={},ai,aj,am;var al=/#EXT-X-STREAM-INF:([^\n\r]*(BAND)WIDTH=(\d+))?([^\n\r]*(CODECS)=\"([^\"\n\r]*)\",?)?([^\n\r]*(RES)OLUTION=(\d+)x(\d+))?([^\n\r]*(NAME)=\"(.*)\")?[^\n\r]*[\r\n]+([^\r\n]+)/g;while((ai=al.exec(ak))!=null){ai.shift();ai=ai.filter(function(aq){return aq!==undefined});ao.url=this.resolve(ai.pop(),ap);while(ai.length>0){switch(ai.shift()){case"RES":ao.width=parseInt(ai.shift());ao.height=parseInt(ai.shift());break;case"BAND":ao.bitrate=parseInt(ai.shift());break;case"NAME":ao.name=ai.shift();break;case"CODECS":aj=ai.shift().split(",");while(aj.length>0){am=aj.shift();if(am.indexOf("avc1")!==-1){ao.videoCodec=this.avc1toavcoti(am)}else{ao.audioCodec=am}}break;default:break}}an.push(ao);ao={}}return an}},{key:"avc1toavcoti",value:function W(ak){var aj,ai=ak.split(".");if(ai.length>2){aj=ai.shift()+".";aj+=parseInt(ai.shift()).toString(16);aj+=("00"+parseInt(ai.shift()).toString(16)).substr(-4)}else{aj=ak}return aj}},{key:"parseKeyParamsByRegex",value:function ah(aj,ak){var ai=ak.exec(aj);if(ai){ai.shift();ai=ai.filter(function(al){return al!==undefined});if(ai.length===2){return ai[1]}}return null}},{key:"cloneObj",value:function Y(ai){return JSON.parse(JSON.stringify(ai))}},{key:"parseLevelPlaylist",value:function aa(ai,az,au){var av=0,aE=0,ak={url:az,fragments:[],live:true,startSN:0},ar,aF,at=0,al,aq,ao;var ap={method:null,key:null,iv:null,uri:null};aF=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.*))|(?:#EXT(INF):([\d\.]+)[^\r\n]*([\r\n]+[^#|\r\n]+)?)|(?:#EXT-X-(BYTERANGE):([\d]+[@[\d]*)]*[\r\n]+([^#|\r\n]+)?|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))/g;while((ar=aF.exec(ai))!==null){ar.shift();ar=ar.filter(function(aG){return aG!==undefined});switch(ar[0]){case"MEDIA-SEQUENCE":av=ak.startSN=parseInt(ar[1]);break;case"TARGETDURATION":ak.targetduration=parseFloat(ar[1]);break;case"ENDLIST":ak.live=false;break;case"DIS":at++;break;case"BYTERANGE":var aD=ar[1].split("@");if(aD.length===1){ao=aq}else{ao=parseInt(aD[1])}aq=parseInt(aD[0])+ao;al=ak.fragments.length?ak.fragments[ak.fragments.length-1]:null;if(al&&!al.url){al.byteRangeStartOffset=ao;al.byteRangeEndOffset=aq;al.url=this.resolve(ar[2],az)}break;case"INF":var aj=parseFloat(ar[1]);if(!isNaN(aj)){var ax,aA=av++;if(ap.method&&ap.uri&&!ap.iv){ax=this.cloneObj(ap);var an=new Uint8Array(16);for(var ay=12;ay<16;ay++){an[ay]=aA>>8*(15-ay)&255}ax.iv=an}else{ax=ap}ak.fragments.push({url:ar[2]?this.resolve(ar[2],az):null,duration:aj,start:aE,sn:aA,level:au,cc:at,byteRangeStartOffset:ao,byteRangeEndOffset:aq,decryptdata:ax});aE+=aj;ao=null}break;case"KEY":var aC=ar[1];var am=this.parseKeyParamsByRegex(aC,/(METHOD)=([^,]*)/),aw=this.parseKeyParamsByRegex(aC,/(URI)=["]([^,]*)["]/),aB=this.parseKeyParamsByRegex(aC,/(IV)=([^,]*)/);if(am){ap={method:null,key:null,iv:null,uri:null};if(aw&&am==="AES-128"){ap.method=am;ap.uri=this.resolve(aw,az);ap.key=null;if(aB){ap.iv=aB;if(ap.iv.substring(0,2)==="0x"){ap.iv=ap.iv.substring(2)}ap.iv=ap.iv.match(/.{8}/g);ap.iv[0]=parseInt(ap.iv[0],16);ap.iv[1]=parseInt(ap.iv[1],16);ap.iv[2]=parseInt(ap.iv[2],16);ap.iv[3]=parseInt(ap.iv[3],16);ap.iv=new Uint32Array(ap.iv)}}}break;default:break}}ak.totalduration=aE;ak.endSN=av-1;return ak}},{key:"loadsuccess",value:function X(aj,am){var an=aj.currentTarget.responseText,ak=aj.currentTarget.responseURL,al=this.id,ap=this.id2,ai=this.hls,aq;if(ak===undefined){ak=this.url}am.tload=performance.now();am.mtime=new Date(aj.currentTarget.getResponseHeader("Last-Modified"));if(an.indexOf("#EXTM3U")===0){if(an.indexOf("#EXTINF:")>0){if(this.id===null){ai.trigger(P["default"].MANIFEST_LOADED,{levels:[{url:ak}],url:ak,stats:am})}else{var ao=this.parseLevelPlaylist(an,ak,al);am.tparsed=performance.now();ai.trigger(P["default"].LEVEL_LOADED,{details:ao,level:al,id:ap,stats:am})}}else{aq=this.parseMasterPlaylist(an,ak);if(aq.length){ai.trigger(P["default"].MANIFEST_LOADED,{levels:aq,url:ak,stats:am})}else{ai.trigger(P["default"].ERROR,{type:K.ErrorTypes.NETWORK_ERROR,details:K.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:ak,reason:"no level found in manifest"})}}}else{ai.trigger(P["default"].ERROR,{type:K.ErrorTypes.NETWORK_ERROR,details:K.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:ak,reason:"no EXTM3U delimiter"})}}},{key:"loaderror",value:function ac(aj){var ai,ak;if(this.id===null){ai=K.ErrorDetails.MANIFEST_LOAD_ERROR;ak=true}else{ai=K.ErrorDetails.LEVEL_LOAD_ERROR;ak=false}this.loader.abort();this.hls.trigger(P["default"].ERROR,{type:K.ErrorTypes.NETWORK_ERROR,details:ai,fatal:ak,url:this.url,loader:this.loader,response:aj.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function U(){var ai,aj;if(this.id===null){ai=K.ErrorDetails.MANIFEST_LOAD_TIMEOUT;aj=true}else{ai=K.ErrorDetails.LEVEL_LOAD_TIMEOUT;aj=false}this.loader.abort();this.hls.trigger(P["default"].ERROR,{type:K.ErrorTypes.NETWORK_ERROR,details:ai,fatal:aj,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]);return ae})();M["default"]=R;I.exports=M["default"]},{"../errors":16,"../events":17,"../utils/url":27}],23:[function(J,L,I){Object.defineProperty(I,"__esModule",{value:true});var K=(function(){function O(S,Q){for(var P=0;P<Q.length;P++){var R=Q[P];R.enumerable=R.enumerable||false;R.configurable=true;if("value" in R){R.writable=true}Object.defineProperty(S,R.key,R)}}return function(R,P,Q){if(P){O(R.prototype,P)}if(Q){O(R,Q)}return R}})();function N(O,P){if(!(O instanceof P)){throw new TypeError("Cannot call a class as a function")}}var M=(function(){function ae(){N(this,ae)}K(ae,null,[{key:"init",value:function ag(){ae.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var an;for(an in ae.types){if(ae.types.hasOwnProperty(an)){ae.types[an]=[an.charCodeAt(0),an.charCodeAt(1),an.charCodeAt(2),an.charCodeAt(3)]}}ae.MAJOR_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]);ae.AVC1_BRAND=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]);ae.MINOR_VERSION=new Uint8Array([0,0,0,1]);ae.VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);ae.AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ae.HDLR_TYPES={video:ae.VIDEO_HDLR,audio:ae.AUDIO_HDLR};ae.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);ae.STCO=new Uint8Array([0,0,0,0,0,0,0,0]);ae.STSC=ae.STCO;ae.STTS=ae.STCO;ae.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);ae.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);ae.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);ae.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);ae.FTYP=ae.box(ae.types.ftyp,ae.MAJOR_BRAND,ae.MINOR_VERSION,ae.MAJOR_BRAND,ae.AVC1_BRAND);ae.DINF=ae.box(ae.types.dinf,ae.box(ae.types.dref,ae.DREF))}},{key:"box",value:function ab(ar){var at=Array.prototype.slice.call(arguments,1),aq=0,ap=at.length,an,ao;while(ap--){aq+=at[ap].byteLength}an=new Uint8Array(aq+8);ao=new DataView(an.buffer);ao.setUint32(0,an.byteLength);an.set(ar,4);for(ap=0,aq=8;ap<at.length;ap++){an.set(at[ap],aq);aq+=at[ap].byteLength}return an}},{key:"hdlr",value:function Q(an){return ae.box(ae.types.hdlr,ae.HDLR_TYPES[an])}},{key:"mdat",value:function P(an){return ae.box(ae.types.mdat,an)}},{key:"mdhd",value:function ak(an,ao){return ae.box(ae.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,an>>24&255,an>>16&255,an>>8&255,an&255,ao>>24,ao>>16&255,ao>>8&255,ao&255,85,196,0,0]))}},{key:"mdia",value:function T(an){return ae.box(ae.types.mdia,ae.mdhd(an.timescale,an.duration),ae.hdlr(an.type),ae.minf(an))}},{key:"mfhd",value:function am(an){return ae.box(ae.types.mfhd,new Uint8Array([0,0,0,0,an>>24,an>>16&255,an>>8&255,an&255]))}},{key:"minf",value:function ad(an){if(an.type==="audio"){return ae.box(ae.types.minf,ae.box(ae.types.smhd,ae.SMHD),ae.DINF,ae.stbl(an))}else{return ae.box(ae.types.minf,ae.box(ae.types.vmhd,ae.VMHD),ae.DINF,ae.stbl(an))}}},{key:"moof",value:function W(ap,ao,an){return ae.box(ae.types.moof,ae.mfhd(ap),ae.traf(an,ao))}},{key:"moov",value:function al(an){var ap=an.length,ao=[];while(ap--){ao[ap]=ae.trak(an[ap])}return ae.box.apply(null,[ae.types.moov,ae.mvhd(an[0].timescale,an[0].duration)].concat(ao).concat(ae.mvex(an)))}},{key:"mvex",value:function Y(an){var ap=an.length,ao=[];while(ap--){ao[ap]=ae.trex(an[ap])}return ae.box.apply(null,[ae.types.mvex].concat(ao))}},{key:"mvhd",value:function ah(ao,ap){var an=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,ao>>24&255,ao>>16&255,ao>>8&255,ao&255,ap>>24&255,ap>>16&255,ap>>8&255,ap&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ae.box(ae.types.mvhd,an)}},{key:"sdtp",value:function ac(ap){var aq=ap.samples||[],ao=new Uint8Array(4+aq.length),an,ar;for(ar=0;ar<aq.length;ar++){an=aq[ar].flags;ao[ar+4]=an.dependsOn<<4|an.isDependedOn<<2|an.hasRedundancy}return ae.box(ae.types.sdtp,ao)}},{key:"stbl",value:function Z(an){return ae.box(ae.types.stbl,ae.stsd(an),ae.box(ae.types.stts,ae.STTS),ae.box(ae.types.stsc,ae.STSC),ae.box(ae.types.stsz,ae.STSZ),ae.box(ae.types.stco,ae.STCO))}},{key:"avc1",value:function aa(aq){var ao=[],ap=[],ar,au,an;for(ar=0;ar<aq.sps.length;ar++){au=aq.sps[ar];an=au.byteLength;ao.push(an>>>8&255);ao.push(an&255);ao=ao.concat(Array.prototype.slice.call(au))}for(ar=0;ar<aq.pps.length;ar++){au=aq.pps[ar];an=au.byteLength;ap.push(an>>>8&255);ap.push(an&255);ap=ap.concat(Array.prototype.slice.call(au))}var at=ae.box(ae.types.avcC,new Uint8Array([1,ao[3],ao[4],ao[5],252|3,224|aq.sps.length].concat(ao).concat([aq.pps.length]).concat(ap)));return ae.box(ae.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,aq.width>>8&255,aq.width&255,aq.height>>8&255,aq.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),at,ae.box(ae.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function V(an){return new Uint8Array([0,0,0,0,3,23+an.config.length,0,1,0,4,15+an.config.length,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([an.config.length]).concat(an.config).concat([6,1,2]))}},{key:"mp4a",value:function aj(an){return ae.box(ae.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,an.channelCount,0,16,0,0,0,0,an.audiosamplerate>>8&255,an.audiosamplerate&255,0,0]),ae.box(ae.types.esds,ae.esds(an)))}},{key:"stsd",value:function X(an){if(an.type==="audio"){return ae.box(ae.types.stsd,ae.STSD,ae.mp4a(an))}else{return ae.box(ae.types.stsd,ae.STSD,ae.avc1(an))}}},{key:"tkhd",value:function af(an){return ae.box(ae.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,an.id>>24&255,an.id>>16&255,an.id>>8&255,an.id&255,0,0,0,0,an.duration>>24,an.duration>>16&255,an.duration>>8&255,an.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,an.width>>8&255,an.width&255,0,0,an.height>>8&255,an.height&255,0,0]))}},{key:"traf",value:function S(an,ap){var ao=ae.sdtp(an);return ae.box(ae.types.traf,ae.box(ae.types.tfhd,new Uint8Array([0,0,0,0,an.id>>24,an.id>>16&255,an.id>>8&255,an.id&255])),ae.box(ae.types.tfdt,new Uint8Array([0,0,0,0,ap>>24,ap>>16&255,ap>>8&255,ap&255])),ae.trun(an,ao.length+16+16+8+16+8+8),ao)}},{key:"trak",value:function O(an){an.duration=an.duration||4294967295;return ae.box(ae.types.trak,ae.tkhd(an),ae.mdia(an))}},{key:"trex",value:function R(an){return ae.box(ae.types.trex,new Uint8Array([0,0,0,0,an.id>>24,an.id>>16&255,an.id>>8&255,an.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function ai(an,ar){var ao,aq,ap,at;ao=an.samples||[];at=new Uint8Array(12+16*ao.length);ar+=8+at.byteLength;at.set([0,0,15,1,ao.length>>>24&255,ao.length>>>16&255,ao.length>>>8&255,ao.length&255,ar>>>24&255,ar>>>16&255,ar>>>8&255,ar&255],0);for(ap=0;ap<ao.length;ap++){aq=ao[ap];at.set([aq.duration>>>24&255,aq.duration>>>16&255,aq.duration>>>8&255,aq.duration&255,aq.size>>>24&255,aq.size>>>16&255,aq.size>>>8&255,aq.size&255,aq.flags.isLeading<<2|aq.flags.dependsOn,aq.flags.isDependedOn<<6|aq.flags.hasRedundancy<<4|aq.flags.paddingValue<<1|aq.flags.isNonSync,aq.flags.degradPrio&240<<8,aq.flags.degradPrio&15,aq.cts>>>24&255,aq.cts>>>16&255,aq.cts>>>8&255,aq.cts&255],12+16*ap)}return ae.box(ae.types.trun,at)}},{key:"initSegment",value:function U(ap){if(!ae.types){ae.init()}var ao=ae.moov(ap),an;an=new Uint8Array(ae.FTYP.byteLength+ao.byteLength);an.set(ae.FTYP);an.set(ao,ae.FTYP.byteLength);return an}}]);return ae})();I["default"]=M;L.exports=I["default"]},{}],24:[function(K,J,N){Object.defineProperty(N,"__esModule",{value:true});var M=(function(){function V(Z,X){for(var W=0;W<X.length;W++){var Y=X[W];Y.enumerable=Y.enumerable||false;Y.configurable=true;if("value" in Y){Y.writable=true}Object.defineProperty(Z,Y.key,Y)}}return function(Y,W,X){if(W){V(Y.prototype,W)}if(X){V(Y,X)}return Y}})();function U(V){return V&&V.__esModule?V:{"default":V}}function O(V,W){if(!(V instanceof W)){throw new TypeError("Cannot call a class as a function")}}var P=K("../events");var R=U(P);var T=K("../utils/logger");var I=K("../remux/mp4-generator");var S=U(I);var L=K("../errors");var Q=(function(){function aa(ag){O(this,aa);this.observer=ag;this.ISGenerated=false;this.PES2MP4SCALEFACTOR=4;this.PES_TIMESCALE=90000;this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}M(aa,[{key:"destroy",value:function af(){}},{key:"insertDiscontinuity",value:function ae(){this._initPTS=this._initDTS=this.nextAacPts=this.nextAvcDts=undefined}},{key:"switchLevel",value:function ad(){this.ISGenerated=false}},{key:"remux",value:function ab(ai,aj,ah,ag,ak){if(!this.ISGenerated){this.generateIS(ai,aj,ag)}if(aj.samples.length){this.remuxVideo(aj,ag,ak)}if(ai.samples.length){this.remuxAudio(ai,ag,ak)}if(ah.samples.length){this.remuxID3(ah,ag)}this.observer.trigger(R["default"].FRAG_PARSED)}},{key:"generateIS",value:function Z(ai,am,ao){var al=this.observer,ah=ai.samples,ag=am.samples,an=ah.length,aj=ag.length,ak=this.PES_TIMESCALE;if(an===0&&aj===0){al.trigger(R["default"].ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}else{if(aj===0){if(ai.config){al.trigger(R["default"].FRAG_PARSING_INIT_SEGMENT,{audioMoov:S["default"].initSegment([ai]),audioCodec:ai.codec,audioChannelCount:ai.channelCount});this.ISGenerated=true}if(this._initPTS===undefined){this._initPTS=ah[0].pts-ak*ao;this._initDTS=ah[0].dts-ak*ao}}else{if(an===0){if(am.sps&&am.pps){al.trigger(R["default"].FRAG_PARSING_INIT_SEGMENT,{videoMoov:S["default"].initSegment([am]),videoCodec:am.codec,videoWidth:am.width,videoHeight:am.height});this.ISGenerated=true;if(this._initPTS===undefined){this._initPTS=ag[0].pts-ak*ao;this._initDTS=ag[0].dts-ak*ao}}}else{if(ai.config&&am.sps&&am.pps){al.trigger(R["default"].FRAG_PARSING_INIT_SEGMENT,{audioMoov:S["default"].initSegment([ai]),audioCodec:ai.codec,audioChannelCount:ai.channelCount,videoMoov:S["default"].initSegment([am]),videoCodec:am.codec,videoWidth:am.width,videoHeight:am.height});this.ISGenerated=true;if(this._initPTS===undefined){this._initPTS=Math.min(ag[0].pts,ah[0].pts)-ak*ao;this._initDTS=Math.min(ag[0].dts,ah[0].dts)-ak*ao}}}}}}},{key:"remuxVideo",value:function X(ax,av,aC){var aq,ay=8,ah=this.PES_TIMESCALE,ag=this.PES2MP4SCALEFACTOR,aA,aj,an,au,ai,ak,ap,az,aw,aD,am,al,at,ar=[];ai=new Uint8Array(ax.len+4*ax.nbNalu+8);aq=new DataView(ai.buffer);aq.setUint32(0,ai.byteLength);ai.set(S["default"].types.mdat,4);while(ax.samples.length){aA=ax.samples.shift();an=0;while(aA.units.units.length){au=aA.units.units.shift();aq.setUint32(ay,au.data.byteLength);ay+=4;ai.set(au.data,ay);ay+=au.data.byteLength;an+=4+au.data.byteLength}aD=aA.pts-this._initDTS;am=aA.dts-this._initDTS;if(aw!==undefined){al=this._PTSNormalize(aD,aw);at=this._PTSNormalize(am,aw);aj.duration=(at-aw)/ag;if(aj.duration<0){aj.duration=0}}else{var ao=this.nextAvcDts,aB;al=this._PTSNormalize(aD,ao);at=this._PTSNormalize(am,ao);aB=Math.round((at-ao)/90);if(aC||Math.abs(aB)<600){if(aB){if(aB>1){T.logger.log("AVC:"+aB+" ms hole between fragments detected,filling it")}else{if(aB<-1){T.logger.log("AVC:"+-aB+" ms overlapping between fragments detected")}}at=ao;al=Math.max(al-aB,at);T.logger.log("Video/PTS/DTS adjusted:"+al+"/"+at)}}ap=Math.max(0,al);az=Math.max(0,at)}aj={size:an,duration:0,cts:(al-at)/ag,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}};if(aA.key===true){aj.flags.dependsOn=2;aj.flags.isNonSync=0}else{aj.flags.dependsOn=1;aj.flags.isNonSync=1}ar.push(aj);aw=at}if(ar.length>=2){aj.duration=ar[ar.length-2].duration}this.nextAvcDts=at+aj.duration*ag;ax.len=0;ax.nbNalu=0;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){ar[0].flags.dependsOn=2;ar[0].flags.isNonSync=0}ax.samples=ar;ak=S["default"].moof(ax.sequenceNumber++,az/ag,ax);ax.samples=[];this.observer.trigger(R["default"].FRAG_PARSING_DATA,{moof:ak,mdat:ai,startPTS:ap/ah,endPTS:(al+ag*aj.duration)/ah,startDTS:az/ah,endDTS:(at+ag*aj.duration)/ah,type:"video",nb:ar.length})}},{key:"remuxAudio",value:function ac(ax,av,aB){var aq,ay=8,ah=this.PES_TIMESCALE,ag=this.PES2MP4SCALEFACTOR,ao,ak,au,ai,al,ap,az,aw,aC,an,am,at,ar=[];ai=new Uint8Array(ax.len+8);aq=new DataView(ai.buffer);aq.setUint32(0,ai.byteLength);ai.set(S["default"].types.mdat,4);while(ax.samples.length){ao=ax.samples.shift();au=ao.unit;ai.set(au,ay);ay+=au.byteLength;aC=ao.pts-this._initDTS;an=ao.dts-this._initDTS;if(aw!==undefined){am=this._PTSNormalize(aC,aw);at=this._PTSNormalize(an,aw);ak.duration=(at-aw)/ag;if(ak.duration<0){T.logger.log("invalid AAC sample duration at PTS:"+ao.pts+":"+ak.duration);ak.duration=0}}else{var aj=this.nextAacPts,aA;am=this._PTSNormalize(aC,aj);at=this._PTSNormalize(an,aj);aA=Math.round(1000*(am-aj)/ah);if(aB||Math.abs(aA)<600){if(aA){if(aA>1){T.logger.log(aA+" ms hole between AAC samples detected,filling it")}else{if(aA<-1){T.logger.log(-aA+" ms overlapping between AAC samples detected")}}am=at=aj}}ap=Math.max(0,am);az=Math.max(0,at)}ak={size:au.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};ar.push(ak);aw=at}if(ar.length>=2){ak.duration=ar[ar.length-2].duration}this.nextAacPts=am+ag*ak.duration;ax.len=0;ax.samples=ar;al=S["default"].moof(ax.sequenceNumber++,az/ag,ax);ax.samples=[];this.observer.trigger(R["default"].FRAG_PARSING_DATA,{moof:al,mdat:ai,startPTS:ap/ah,endPTS:this.nextAacPts/ah,startDTS:az/ah,endDTS:(at+ag*ak.duration)/ah,type:"audio",nb:ar.length})}},{key:"remuxID3",value:function W(ah,ag){var ak=ah.samples.length,aj;if(ak){for(var ai=0;ai<ak;ai++){aj=ah.samples[ai];aj.pts=(aj.pts-this._initPTS)/this.PES_TIMESCALE;aj.dts=(aj.dts-this._initDTS)/this.PES_TIMESCALE}this.observer.trigger(R["default"].FRAG_PARSING_METADATA,{samples:ah.samples})}ah.samples=[];ag=ag}},{key:"_PTSNormalize",value:function Y(ah,ag){var ai;if(ag===undefined){return ah}if(ag<ah){ai=-8589934592}else{ai=8589934592}while(Math.abs(ah-ag)>4294967296){ah+=ai}return ah}},{key:"timescale",get:function V(){return this.MP4_TIMESCALE}}]);return aa})();N["default"]=Q;J.exports=N["default"]},{"../errors":16,"../events":17,"../remux/mp4-generator":23,"../utils/logger":26}],25:[function(K,M,J){var I={search:function L(T,P){var R=0;var S=T.length-1;var O=null;var Q=null;while(R<=S){O=(R+S)/2|0;Q=T[O];var N=P(Q);if(N>0){R=O+1}else{if(N<0){S=O-1}else{return Q}}}return null}};M.exports=I},{}],26:[function(K,J,L){Object.defineProperty(L,"__esModule",{value:true});function R(){}var M={trace:R,debug:R,log:R,warn:R,info:R,error:R};var I=M;function S(T,U){U="["+T+"] > "+U;return U}function P(T){var U=window.console[T];if(U){return function(){for(var V=arguments.length,W=Array(V),X=0;X<V;X++){W[X]=arguments[X]}if(W[0]){W[0]=S(T,W[0])}U.apply(window.console,W)}}return R}function O(V){for(var T=arguments.length,W=Array(T>1?T-1:0),U=1;U<T;U++){W[U-1]=arguments[U]}W.forEach(function(X){I[X]=V[X]?V[X].bind(V):P(X)})}var N=function N(T){if(T===true||typeof T==="object"){O(T,"debug","log","info","warn","error");try{I.log()}catch(U){I=M}}else{I=M}};L.enableLogs=N;var Q=I;L.logger=Q},{}],27:[function(K,L,I){var N={buildAbsoluteURL:function M(Q,R){R=R.trim();if(/^[a-z]+:/i.test(R)){return R}var O=null;var S=null;var Y=/^([^#]*)(.*)$/.exec(R);if(Y){S=Y[2];R=Y[1]}var aa=/^([^\?]*)(.*)$/.exec(R);if(aa){O=aa[2];R=aa[1]}var V=/^([^#]*)(.*)$/.exec(Q);if(V){Q=V[1]}var ab=/^([^\?]*)(.*)$/.exec(Q);if(ab){Q=ab[1]}var X=/^((([a-z]+):)?\/\/[a-z0-9\.-]+(:[0-9]+)?\/)(.*)$/i.exec(Q);var T=X[3];var U=X[1];var Z=X[5];var P=null;if(/^\/\//.test(R)){P=T+"://"+N.buildAbsolutePath("",R.substring(2))}else{if(/^\//.test(R)){P=U+N.buildAbsolutePath("",R.substring(1))}else{var W=N.buildAbsolutePath(Z,R);P=U+W}}if(O){P+=O}if(S){P+=S}return P},buildAbsolutePath:function J(V,P){var Q=P;var U,R="",O=V.replace(/[^\/]*$/,Q.replace(/(\/|^)(?:\.?\/+)+/g,"$1"));for(var T,S=0;T=O.indexOf("/../",S),T>-1;S=T+U){U=/^\/(?:\.\.\/)*/.exec(O.slice(T))[0].length;R=(R+O.substring(S,T)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(U-1)/3+"}$"),"/")}return R+O.substr(S)}};L.exports=N},{}],28:[function(L,N,K){Object.defineProperty(K,"__esModule",{value:true});var M=(function(){function P(T,R){for(var Q=0;Q<R.length;Q++){var S=R[Q];S.enumerable=S.enumerable||false;S.configurable=true;if("value" in S){S.writable=true}Object.defineProperty(T,S.key,S)}}return function(S,Q,R){if(Q){P(S.prototype,Q)}if(R){P(S,R)}return S}})();function O(P,Q){if(!(P instanceof Q)){throw new TypeError("Cannot call a class as a function")}}var J=L("../utils/logger");var I=(function(){function Q(Y){O(this,Q);if(Y&&Y.xhrSetup){this.xhrSetup=Y.xhrSetup}}M(Q,[{key:"destroy",value:function W(){this.abort();this.loader=null}},{key:"abort",value:function S(){if(this.loader&&this.loader.readyState!==4){this.stats.aborted=true;this.loader.abort()}if(this.timeoutHandle){window.clearTimeout(this.timeoutHandle)}}},{key:"load",value:function X(Y,Z,ab,aa,ac,ad,ae,ag){var af=arguments.length<=8||arguments[8]===undefined?null:arguments[8];var ah=arguments.length<=9||arguments[9]===undefined?null:arguments[9];this.url=Y;if(ah&&!isNaN(ah.byteRangeStartOffset)&&!isNaN(ah.byteRangeEndOffset)){this.byteRange=ah.byteRangeStartOffset+"-"+ah.byteRangeEndOffset}this.responseType=Z;this.onSuccess=ab;this.onProgress=af;this.onTimeout=ac;this.onError=aa;this.stats={trequest:performance.now(),retry:0};this.timeout=ad;this.maxRetry=ae;this.retryDelay=ag;this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),ad);this.loadInternal()}},{key:"loadInternal",value:function T(){var Y=this.loader=new XMLHttpRequest();Y.onload=this.loadsuccess.bind(this);Y.onerror=this.loaderror.bind(this);Y.onprogress=this.loadprogress.bind(this);Y.open("GET",this.url,true);if(this.byteRange){Y.setRequestHeader("Range","bytes="+this.byteRange)}Y.responseType=this.responseType;this.stats.tfirst=null;this.stats.loaded=0;if(this.xhrSetup){this.xhrSetup(Y,this.url)}Y.send()}},{key:"loadsuccess",value:function R(Y){window.clearTimeout(this.timeoutHandle);this.stats.tload=performance.now();this.onSuccess(Y,this.stats)}},{key:"loaderror",value:function U(Y){if(this.stats.retry<this.maxRetry){J.logger.warn(Y.type+" while loading "+this.url+", retrying in "+this.retryDelay+"...");this.destroy();window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,64000);this.stats.retry++}else{window.clearTimeout(this.timeoutHandle);J.logger.error(Y.type+" while loading "+this.url);this.onError(Y)}}},{key:"loadtimeout",value:function P(Y){J.logger.warn("timeout while loading "+this.url);this.onTimeout(Y,this.stats)}},{key:"loadprogress",value:function V(Z){var Y=this.stats;if(Y.tfirst===null){Y.tfirst=performance.now()}Y.loaded=Z.loaded;if(this.onProgress){this.onProgress(Z,Y)}}}]);return Q})();K["default"]=I;N.exports=K["default"]},{"../utils/logger":26}]},{},[19])(19)});function D(E){this.width="100%";this.height="100%";this.video_element=null;this.hlsjsWithCredentials=false;w(this,E);this.video=this.video_element||document.createElement("VIDEO");this.hls=null;this.mode="native";this.handle_events=true;if(E.poster){this.video.poster=E.poster}}D.prototype=w(Object.create(CustomObject),{is_ready:false,isSupported:function(){return typeof document.createElement("VIDEO").play=="function"},isHLS:function(E){return["application/x-mpegURL","application/vnd.apple.mpegurl"].indexOf(E)>-1},canPlayTypeNative:function(E){var F=e();if(this.isHLS(E)){if(e().is_edge){return false}if(F.is_android&&F.version[0]>=4){return true}}return["maybe","probably"].indexOf(document.createElement("VIDEO").canPlayType(E))>-1},canPlayType:function(E){if(this.canPlayTypeNative(E)){return true}if(this.isHLS(E)&&Hls.isSupported()){return true}return false},setSource:function(G,F){var E=this;this.mode=null;if(this.canPlayTypeNative(F)){this.mode="native";this.video.src=G;this.video.load()}else{if(this.isHLS(F)){this.mode="hls";this.hls=new Hls({fragLoadingTimeOut:100000,maxBufferLength:30,xhrSetup:function(I,H){I.withCredentials=E.hlsjsWithCredentials}});this.hls.loadSource(G);this.hls.attachMedia(this.video);this.hls.on(Hls.Events.ERROR,function(I,H){console.log(H);if(H.fatal&&H.details!="fragLoopLoadingError"){E.trigger("error",201)}})}}},getElement:function(){return this.video},destroy:function(){this.video.pause();if(this.hls){this.hls.destroy()}this.video.oncontextmenu=null},setWidth:function(E){this.video.style.width=E},setHeight:function(E){this.video.style.height=E},init:function(){var E=this;this.setWidth(this.width);this.setHeight(this.height);this.initEvents();this.on("ready",function(){E.is_ready=true});this.trigger("ready")},handleEvent:function(E){if(!this.handle_events){return}var F="on"+E.type.charAt(0).toUpperCase()+E.type.slice(1);if(typeof this[F]==="function"){this[F](E)}},onError:function(E){console.log("ERROR",E.target.error);this.trigger("error",201)},onLoadedmetadata:function(){this.trigger("canplay")},onDurationchange:function(){this.trigger("durationchange",this.video.duration)},onVolumechange:function(){this.trigger("volumechange",this.video.muted?0:this.video.volume)},onTimeupdate:function(){var E=null;for(var F=0;F<this.video.buffered.length;F++){if(this.video.currentTime>this.video.buffered.start(F)&&this.video.currentTime<this.video.buffered.end(F)){E=this.video.duration-this.video.buffered.end(F)<0.5||Math.abs(this.video.currentTime-this.video.buffered.end(F))>0.5;break}}if(E!==null){if(E){if(this.is_waiting){this.trigger("playing");this.is_waiting=false}}else{this.is_waiting=true;this.trigger("waiting")}}this.trigger("timeupdate",this.video.currentTime);if(this.video.duration&&this.video.duration-this.video.currentTime<0.5){this.trigger("ended");this.video.pause();this.video.currentTime=0}},onProgress:function(){var F=[];for(var E=0;E<this.video.buffered.length;E++){F.push([this.video.buffered.start(E),this.video.buffered.end(E)])}this.trigger("progress",F)},onEnded:function(){this.trigger("ended")},onWaiting:function(){this.trigger("waiting")},onPlaying:function(){this.trigger("playing")},onPlay:function(){this.trigger("play")},onPause:function(){this.trigger("pause")},onCanplay:function(){this.trigger("canplay")},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},initEvents:function(){var E=this;this.video.addEventListener("error",this);this.video.addEventListener("play",this);this.video.addEventListener("loadedmetadata",this);this.video.addEventListener("ended",this);this.video.addEventListener("waiting",this);this.video.addEventListener("playing",this);this.video.addEventListener("play",this);this.video.addEventListener("pause",this);this.video.addEventListener("canplay",this);this.video.addEventListener("seeking",this);this.video.addEventListener("seeked",this);this.video.addEventListener("timeupdate",this);this.video.addEventListener("progress",this);this.video.oncontextmenu=function(){event.preventDefault()}},play:function(){try{this.video.play()}catch(E){}},pause:function(){this.video.pause()},getCurrentTime:function(){return this.video.currentTime},getDuration:function(){return this.video.duration},setCurrentTime:function(E){if(this.video.readyState!=HTMLMediaElement.HAVE_NOTHING){this.video.currentTime=Math.max(0,Math.min(this.video.duration-0.9,E))}},setVolume:function(E){E=Math.max(0,Math.min(1,E||0));this.video.volume=E;this.video.muted=!E},getVolume:function(){return this.video.volume},showDefaultUI:function(){this.video.controls=true},hideDefaultUI:function(){this.video.controls=false}});return D})();z.prototype.__backends.HTML5=HTML5Backend;function r(D){this.flash_swf=null;s(this,D);this.swf=document.createElement("OBJECT")}r.prototype=w(Object.create(CustomObject),{is_ready:false,_flashFn:function(E){var D="window";var F="__"+Math.random().toString(16).split(".")[1];window[F]=function(){E.apply(window,arguments)};return D+"."+F},_setSWFProperty:function(E,F){if(!this.swf.vjs_setProperty){var D=this;setTimeout(function(){D._setSWFProperty(E,F)},0);return}this.swf.vjs_setProperty(E,F)},init:function(){var D=this;this.on("ready",function(){D.is_ready=true});this.swf.setAttribute("type","application/x-shockwave-flash");this.swf.setAttribute("width","100%");this.swf.setAttribute("height","100%");this.swf.setAttribute("data",this.flash_swf);k(this.swf,"screen");var G={wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all",quality:"high",flashvars:"readyFunction="+this._flashFn(function(){D.initEvents()})};for(var E in G){var F=document.createElement("PARAM");F.setAttribute("name",E);F.setAttribute("value",G[E]);this.swf.appendChild(F)}},isSupported:function(){return x()},canPlayType:function(D){return["video/mp4","video/flv","video/x-flv","video/m4v","application/x-mpegURL"].indexOf(D)>-1},getElement:function(){return this.swf},destroy:function(){clearInterval(this._play_interval)},initEvents:function(){var D=this;this._setSWFProperty("eventProxyFunction",this._flashFn(function(F,E){switch(E){case"playing":D.trigger("playing");break;case"seeked":D.trigger("seeked");break;case"waiting":D.trigger("waiting");break;case"ended":D.trigger("ended");break;case"canplay":case"loadedmetadata":D.trigger("canplay");break;case"play":D.trigger("play");break;case"volumechange":D.trigger("volumechange",D.getVolume());break;case"durationchange":D.trigger("durationchange",D.getDuration());break}}));this._setSWFProperty("errorEventProxyFunction",this._flashFn(function(F,E){switch(E){case"srcnotfound":D.trigger("error",201);break;default:D.trigger("error",200)}}));this.on("play",function(){D.__timeupdate=setInterval(function(){D.trigger("progress",[[0,D.swf.vjs_getProperty("buffered")]]);D.trigger("timeupdate",D.getCurrentTime())},500)});this.on(["pause","ended"],function(){clearInterval(D.__timeupdate)});this.trigger("ready")},setSource:function(D){this.swf.vjs_src(D)},play:function(){this.swf.vjs_play()},pause:function(){this.swf.vjs_pause();this.trigger("pause")},getCurrentTime:function(){if(this.swf.vjs_getProperty){return this.swf.vjs_getProperty("currentTime")}return 0},getDuration:function(){if(this.swf.vjs_getProperty){return this.swf.vjs_getProperty("duration")}return 0},setCurrentTime:function(D){this._setSWFProperty("currentTime",D)},setVolume:function(D){this._setSWFProperty("volume",D)},getVolume:function(D){return this.swf.vjs_getProperty("volume")},showDefaultUI:function(){},hideDefaultUI:function(){}});z.prototype.__backends.Flash=r;function d(F,E){var D=this;this.player=F;this.is_fullscreen=false;if(this.checkSupportFullscreen()){this.init()}}d.prototype={init:function(){var D=this;i(document,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"],function(E){D.player.trigger("fullscreenchange",D.checkFullscreen())});this.player.on("tray_ready",function(F,E){E.appendChild(D.getUI())})},getUI:function(){var D=this;var F=j('<div class="fullscreen">	<svg>		<path class="on" d="M14.016 5.016h4.969v4.969h-1.969v-3h-3v-1.969zM17.016 17.016v-3h1.969v4.969h-4.969v-1.969h3zM5.016 9.984v-4.969h4.969v1.969h-3v3h-1.969zM6.984 14.016v3h3v1.969h-4.969v-4.969h1.969z"></path>		<path class="off" d="M15.984 8.016h3v1.969h-4.969v-4.969h1.969v3zM14.016 18.984v-4.969h4.969v1.969h-3v3h-1.969zM8.016 8.016v-3h1.969v4.969h-4.969v-1.969h3zM5.016 15.984v-1.969h4.969v4.969h-1.969v-3h-3z"></path>	</svg></div>');var E=F.getElementsByClassName("on")[0];var G=F.getElementsByClassName("off")[0];i(F,"click",function(){if(D.is_fullscreen){D.exitFullscreen()}else{D.requestFullscreen()}});this.player.on("fullscreenchange",function(I,H){D.is_fullscreen=H;if(D.is_fullscreen){k(D.player.root,"fullscreen");F.title="Exit from Fullscreen";E.style.display="none";G.style.display=""}else{n(D.player.root,"fullscreen");F.title="Fullscreen";E.style.display="";G.style.display="none"}});this.player.trigger("fullscreenchange");return F},checkFullscreen:function(){return(document.fullscreenElement&&document.fullscreenElement!==null)||document.mozFullScreen||document.webkitIsFullScreen},checkSupportFullscreen:function(){if(e().is_android){return false}return document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen||document.createElement("video").webkitEnterFullscreen},requestFullscreen:function(){var E=this;var F=document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen;if(F){F.call(this.player.root);this.is_fullscreen=true}else{var D=this.player.backend.getElement();if(D.webkitEnterFullscreen){this.is_fullscreen=true;i(D,"webkitendfullscreen",function(G){A(D,G.type);E.is_fullscreen=false});D.webkitEnterFullscreen()}}},exitFullscreen:function(){var D=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;if(D){D.call(document);this.is_fullscreen=false}}};z.prototype.__plugins.FullScreen=d;VASTPlugin=(function(){var F={};(function G(I,M,K){function J(R,P){if(!M[R]){if(!I[R]){var O=typeof require=="function"&&require;if(!P&&O){return O(R,!0)}if(H){return H(R,!0)}var Q=new Error("Cannot find module '"+R+"'");throw Q.code="MODULE_NOT_FOUND",Q}var N=M[R]={exports:{}};I[R][0].call(N.exports,function(S){var T=I[R][1][S];return J(T?T:S)},N,N.exports,G,I,M,K)}return M[R].exports}var H=typeof require=="function"&&require;for(var L=0;L<K.length;L++){J(K[L])}return J})({1:[function(M,H,Y){var P=H.exports={};var Q;var S;function N(){throw new Error("setTimeout has not been defined")}function W(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){Q=setTimeout}else{Q=N}}catch(Z){Q=N}try{if(typeof clearTimeout==="function"){S=clearTimeout}else{S=W}}catch(Z){S=W}}());function L(Z){if(Q===setTimeout){return setTimeout(Z,0)}if((Q===N||!Q)&&setTimeout){Q=setTimeout;return setTimeout(Z,0)}try{return Q(Z,0)}catch(aa){try{return Q.call(null,Z,0)}catch(aa){return Q.call(this,Z,0)}}}function K(Z){if(S===clearTimeout){return clearTimeout(Z)}if((S===W||!S)&&clearTimeout){S=clearTimeout;return clearTimeout(Z)}try{return S(Z)}catch(aa){try{return S.call(null,Z)}catch(aa){return S.call(this,Z)}}}var T=[];var X=false;var O;var U=-1;function R(){if(!X||!O){return}X=false;if(O.length){T=O.concat(T)}else{U=-1}if(T.length){V()}}function V(){if(X){return}var aa=L(R);X=true;var Z=T.length;while(Z){O=T;T=[];while(++U<Z){if(O){O[U].run()}}U=-1;Z=T.length}O=null;X=false;K(aa)}P.nextTick=function(Z){var aa=new Array(arguments.length-1);if(arguments.length>1){for(var ab=1;ab<arguments.length;ab++){aa[ab-1]=arguments[ab]}}T.push(new I(Z,aa));if(T.length===1&&!X){L(V)}};function I(Z,aa){this.fun=Z;this.array=aa}I.prototype.run=function(){this.fun.apply(null,this.array)};P.title="browser";P.browser=true;P.env={};P.argv=[];P.version="";P.versions={};function J(){}P.on=J;P.addListener=J;P.once=J;P.off=J;P.removeListener=J;P.removeAllListeners=J;P.emit=J;P.prependListener=J;P.prependOnceListener=J;P.listeners=function(Z){return[]};P.binding=function(Z){throw new Error("process.binding is not supported")};P.cwd=function(){return"/"};P.chdir=function(Z){throw new Error("process.chdir is not supported")};P.umask=function(){return 0}},{}],2:[function(I,J,H){(function(P){Function.prototype.$asyncbind=function O(U,T){var X=this;if(T===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function S(ab){var ac=[];if(!ab){try{ab=P.nextTick}catch(aa){ab=function(ae){setTimeout(ae,0)}}}function Y(){for(var ag=0;ag<ac.length;ag+=2){var af=ac[ag+1],ah=ac[ag];for(var ae=0;ae<af.length;ae++){af[ae].call(null,ah)}}ac=[]}function ad(ae){return ae&&(ae instanceof Object)&&typeof ae.then==="function"}function Z(ag){function aj(aq){var ap;if(ak||an<0||(ap=am[an]).length===0){return}ac.push(ao,ap);am=[[],[]];if(ac.length===2){aq?Y():ab(Y)}}function ae(ap){if(an>=0){return}if(ad(ap)){return ap.then(ae,ai)}an=0;ao=ap;aj(true)}function ai(ap){if(an>=0){return}if(ad(ap)){return ap.then(ae,ai)}an=1;ao=ap;aj(true)}function ah(aq,ap){am[0].push(aq);am[1].push(ap);aj()}function af(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[an]+"}="+ao.toString()}function al(){try{ag.call(null,ae,ai)}catch(ap){ai(ap)}}this.then=ah;this.toString=af;var am=[[],[]],ak=true,an=-1,ao;al();ak=false;aj()}Z.resolve=function(ae){return ad(ae)?ae:{then:function(ag,af){return ag(ae)}}};return Z}()}return new (Function.prototype.$asyncbind.EagerThenable)(V)}if(T){if(Function.prototype.$asyncbind.wrapAsyncStack){T=Function.prototype.$asyncbind.wrapAsyncStack(T)}return W}function W(Y,Z){try{return Y&&(Y instanceof Object)&&typeof Y.then==="function"?Y.then(W,T):X.call(U,Y,Z||T)}catch(aa){return(Z||T)(aa)}}function V(Y,Z){return X.call(U,Y,Z)}V.then=V;return V};window.$error=window.$error||function(S){throw S};var Q=I("./lib.js");var K=I("./Exceptions.js");var L=I("./VPAIDPlayer.js");var R=I("./VideoPlayer.js");var M=I("./StaticPlayer.js");J.exports=N;function N(S){this.place=null;this.creative=null;this.player=null;this.video_player=S.video_player||null;this.vpaid_flash_bridge=S.vpaid_flash_bridge||null;this.flash_video_player=S.flash_video_player||null;this.can_use={};this.can_use.flash=Q.flash_support();this.can_use.flash_vpaid=this.can_use.flash&&!(!this.vpaid_flash_bridge);this.can_use.flash_video=this.can_use.flash&&!(!this.flash_video_player);this.timeout={mount:10000,start:10000};if(S.timeout){if(typeof S.timeout.mount!=="undefined"){this.timeout.mount=S.timeout.mount}if(typeof S.timeout.start!=="undefined"){this.timeout.start=S.timeout.start}}this.is_mounted=false}N.prototype={eventHandler:function(){},mount:function(T,S){return(function(ab,ad){var af=(function(ag){return(function(ah){clearTimeout(ae);return ag&&(ag.call(this,ah))}).$asyncbind(this,ad)}).$asyncbind(this);var U,W,Z,X,ae;if(this.is_mounted){return ad(new Error("Creative already mounted"))}this.place=S;this.creative=T;U=[L,R];W={allow_flash:this.can_use.flash_vpaid,video_player:this.video_player,vpaid_flash_bridge:this.vpaid_flash_bridge,flash_video_player:this.flash_video_player};for(Z=0;Z<U.length;Z++){X=U[Z];try{this.player=new X(this.creative,W);break}catch(ac){this.player=null}}if(!this.player){return ad(new K.VPAIDError(403))}this.wrapEventListener(document);this.wrapEventListener(document.body);if(this.video_player){this.wrapEventListener(this.video_player)}if(this.timeout.mount){ae=setTimeout((function(){Q.debug.log("Timeout for mount creative");return ad(new K.VPAIDError(901))}).bind(this),this.timeout.mount)}function aa(){this.is_mounted=true;return ab()}var V=(function(ag){return af(ad)(ag)}).$asyncbind(this,af(ad));try{return this.player.mount(this.place).then((function(ag){return af(aa).call(this)}).$asyncbind(this,V),V)}catch(Y){V(Y)}}).$asyncbind(this,true)},start:function(){return(function(W,S){var T=(function(Z){return(function(aa){clearTimeout(V);return Z&&(Z.call(this,aa))}).$asyncbind(this,S)}).$asyncbind(this);var V;if(!this.is_mounted){return S(new Error("Creative must be mount first"))}this.has_events={};Q.debug.log("Play "+this.creative.type+" creative");this.player.eventHandler=(function(aa,Z){if(aa=="AdVideoStart"){this.processVPAIDEvent("AdLinearChange",true)}if(aa=="AdVideoComplete"){this.processVPAIDEvent("AdLinearChange",false)}this.processVPAIDEvent(aa,Z)}).bind(this);if(this.timeout.start){V=setTimeout((function(){if(!this.has_events.AdStarted){Q.debug.log("Timeout for start creative");return S(new K.VPAIDError(901))}}).bind(this),this.timeout.start)}function U(){Q.debug.log("Done "+this.creative.type+" creative");return this.unmount().then((function(Z){return W()}).$asyncbind(this,S),S)}var Y=(function(Z){return this.player.unmount().then((function(aa){return T(S)(Z)}).$asyncbind(this,S),S)}).$asyncbind(this,T(S));try{return this.player.start().then((function(Z){return T(U).call(this)}).$asyncbind(this,Y),Y)}catch(X){Y(X)}}).$asyncbind(this,true)},unmount:function(){return(function(T,S){Q.debug.log("start UNMOUNT CREATIVE");if(!this.is_mounted){return S(new Error("Creative not mounted now"))}return this.player.unmount().then((function(U){this.player=null;this.place=null;this.creative=null;this.files=null;this.eventHandler=N.prototype.eventHandler;this.is_mounted=false;document.removeAllEventListeners();document.body.removeAllEventListeners();if(this.video_player){this.video_player.removeAllEventListeners()}Q.debug.log("done UNMOUNT CREATIVE");return T()}).$asyncbind(this,S),S)}).$asyncbind(this,true)},stop:function(){return(function(U,S){function T(){return U()}if(this.is_mounted){return this.player.stop().then((function(V){return T.call(this)}).$asyncbind(this,S),S)}return T.call(this)}).$asyncbind(this,true)},processVPAIDEvent:function(W,T){var Y=["AdImpression","AdStarted","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdSkipped"];var X={AdError:"error",AdImpression:"impression",AdStarted:"creativeView",AdVideoStart:"start",AdVideoFirstQuartile:"firstQuartile",AdVideoMidpoint:"midpoint",AdVideoThirdQuartile:"thirdQuartile",AdVideoComplete:"complete",AdSkipped:"skip",AdClickThru:"clickthru",AdUserAcceptInvitation:"acceptInvitation",AdUserMinimize:"collapse",AdUserClose:"close",AdPaused:"pause",AdPlaying:"resume"};if(Y.indexOf(W)>=0&&this.has_events[W]){return}this.has_events[W]=true;Q.debug.log("VPAID event: "+W);if(W=="AdClickThru"&&this.creative.click_thru){var V=T;if(V){Q.open_window(this.creative.click_thru)}}var Z=this.creative.events[X[W]];if(Z){for(var U=0;U<Z.length;U++){var S=Z[U];Q.fire_pixel(S)}}this.eventHandler("vpaid",W,T)},wrapEventListener:function(U){var S=U.addEventListener;var T=[];U.addEventListener=function(W,X,V){T.push({type:W,listener:X});S.call(this,W,X,V)};U.removeAllEventListeners=function(){T.map(function(V){U.removeEventListener(V.type,V.listener)});U.addEventListener=S}}}}).call(this,I("_process"))},{"./Exceptions.js":3,"./StaticPlayer.js":4,"./VPAIDPlayer.js":7,"./VideoPlayer.js":9,"./lib.js":10,_process:1}],3:[function(I,J,H){(function(N){Function.prototype.$asyncbind=function M(Q,P){var T=this;if(P===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function O(X){var Y=[];if(!X){try{X=N.nextTick}catch(W){X=function(aa){setTimeout(aa,0)}}}function U(){for(var ac=0;ac<Y.length;ac+=2){var ab=Y[ac+1],ad=Y[ac];for(var aa=0;aa<ab.length;aa++){ab[aa].call(null,ad)}}Y=[]}function Z(aa){return aa&&(aa instanceof Object)&&typeof aa.then==="function"}function V(ac){function af(am){var al;if(ag||aj<0||(al=ai[aj]).length===0){return}Y.push(ak,al);ai=[[],[]];if(Y.length===2){am?U():X(U)}}function aa(al){if(aj>=0){return}if(Z(al)){return al.then(aa,ae)}aj=0;ak=al;af(true)}function ae(al){if(aj>=0){return}if(Z(al)){return al.then(aa,ae)}aj=1;ak=al;af(true)}function ad(am,al){ai[0].push(am);ai[1].push(al);af()}function ab(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[aj]+"}="+ak.toString()}function ah(){try{ac.call(null,aa,ae)}catch(al){ae(al)}}this.then=ad;this.toString=ab;var ai=[[],[]],ag=true,aj=-1,ak;ah();ag=false;af()}V.resolve=function(aa){return Z(aa)?aa:{then:function(ac,ab){return ac(aa)}}};return V}()}return new (Function.prototype.$asyncbind.EagerThenable)(R)}if(P){if(Function.prototype.$asyncbind.wrapAsyncStack){P=Function.prototype.$asyncbind.wrapAsyncStack(P)}return S}function S(U,V){try{return U&&(U instanceof Object)&&typeof U.then==="function"?U.then(S,P):T.call(Q,U,V||P)}catch(W){return(V||P)(W)}}function R(U,V){return T.call(Q,U,V)}R.then=R;return R};window.$error=window.$error||function(O){throw O};function K(){}J.exports.NonLinearVPAID=K;function L(P,O){var Q={100:"100 XML parsing error",402:"Timeout of MediaFile URI",403:"Could not find MediaFile that is supported by this video player, based on the attributes of the MediaFile element",901:"General VPAID error"};this.code=P;this.message=O?O:Q[P]?Q[P]:"Unknown VPAID error"}J.exports.VPAIDError=L}).call(this,I("_process"))},{_process:1}],4:[function(I,J,H){(function(M){Function.prototype.$asyncbind=function L(Q,P){var T=this;if(P===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function O(X){var Y=[];if(!X){try{X=M.nextTick}catch(W){X=function(aa){setTimeout(aa,0)}}}function U(){for(var ac=0;ac<Y.length;ac+=2){var ab=Y[ac+1],ad=Y[ac];for(var aa=0;aa<ab.length;aa++){ab[aa].call(null,ad)}}Y=[]}function Z(aa){return aa&&(aa instanceof Object)&&typeof aa.then==="function"}function V(ac){function af(am){var al;if(ag||aj<0||(al=ai[aj]).length===0){return}Y.push(ak,al);ai=[[],[]];if(Y.length===2){am?U():X(U)}}function aa(al){if(aj>=0){return}if(Z(al)){return al.then(aa,ae)}aj=0;ak=al;af(true)}function ae(al){if(aj>=0){return}if(Z(al)){return al.then(aa,ae)}aj=1;ak=al;af(true)}function ad(am,al){ai[0].push(am);ai[1].push(al);af()}function ab(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[aj]+"}="+ak.toString()}function ah(){try{ac.call(null,aa,ae)}catch(al){ae(al)}}this.then=ad;this.toString=ab;var ai=[[],[]],ag=true,aj=-1,ak;ah();ag=false;af()}V.resolve=function(aa){return Z(aa)?aa:{then:function(ac,ab){return ac(aa)}}};return V}()}return new (Function.prototype.$asyncbind.EagerThenable)(R)}if(P){if(Function.prototype.$asyncbind.wrapAsyncStack){P=Function.prototype.$asyncbind.wrapAsyncStack(P)}return S}function S(U,V){try{return U&&(U instanceof Object)&&typeof U.then==="function"?U.then(S,P):T.call(Q,U,V||P)}catch(W){return(V||P)(W)}}function R(U,V){return T.call(Q,U,V)}R.then=R;return R};window.$error=window.$error||function(O){throw O};var N=I("./lib.js");J.exports=K;function K(P,O){this.file=P;this.methods=O.methods||[];this.click_thru=O.click_thru||null;this.backend=N.sortByMap(this.methods,["native","flash"])[0];this.place=null;this.width=P.width;this.height=P.height}K.getSupportMethods=function(Q,R){if(Q.is_vpaid){return[]}var P=!(!R.allow_flash);var O=[];if(["image/png","image/jpg","image/jpeg"].indexOf(Q.type)>=0){O.push("native")}return O};K.prototype={eventHandler:function(P,O){},mount:function(O){return(function(Q,P){this.place=O;return Q()}).$asyncbind(this,true)},unmount:function(){return(function(P,O){return P()}).$asyncbind(this,true)},play:function(){return(function(Q,R){var U=N.html('<div style="position: absolute"></div>');var W=N.html('<div style="position: absolute">x</div>');var X=N.html("<div></div>");U.appendChild(W);U.appendChild(X);var P=this.place.offsetWidth;var T=this.place.offsetHeight;var S=10;var O=Math.min(this.width,P-S*2);var V=this.height;U.style.width=O+"px";U.style.height=V+"px";U.style.left=(P-O)/2+"px";U.style.bottom=S+"px";X.appendChild(this.create_banner(this.file));this.place.appendChild(U);return Q()}).$asyncbind(this,true)},create_banner:function(O){var P=O.type;var Q=O.url;if(P=="html"){elm=document.createElement("DIV");elm.innerHTML=Q}else{if(P=="iframe"){elm=document.createElement("IFRAME");elm.src=Q;elm.style.border="none";elm.scrolling="no"}else{if(P=="application/x-shockwave-flash"){elm=document.createElement("OBJECT");elm.setAttribute("type","application/x-shockwave-flash");elm.setAttribute("data",Q)}else{elm=document.createElement("IMG");elm.src=Q}}}return elm}}}).call(this,I("_process"))},{"./lib.js":10,_process:1}],5:[function(I,J,H){(function(M){Function.prototype.$asyncbind=function T(Y,X){var ab=this;if(X===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function W(af){var ag=[];if(!af){try{af=M.nextTick}catch(ae){af=function(ai){setTimeout(ai,0)}}}function ac(){for(var ak=0;ak<ag.length;ak+=2){var aj=ag[ak+1],al=ag[ak];for(var ai=0;ai<aj.length;ai++){aj[ai].call(null,al)}}ag=[]}function ah(ai){return ai&&(ai instanceof Object)&&typeof ai.then==="function"}function ad(ak){function an(av){var au;if(ao||ar<0||(au=aq[ar]).length===0){return}ag.push(at,au);aq=[[],[]];if(ag.length===2){av?ac():af(ac)}}function ai(au){if(ar>=0){return}if(ah(au)){return au.then(ai,am)}ar=0;at=au;an(true)}function am(au){if(ar>=0){return}if(ah(au)){return au.then(ai,am)}ar=1;at=au;an(true)}function al(av,au){aq[0].push(av);aq[1].push(au);an()}function aj(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[ar]+"}="+at.toString()}function ap(){try{ak.call(null,ai,am)}catch(au){am(au)}}this.then=al;this.toString=aj;var aq=[[],[]],ao=true,ar=-1,at;ap();ao=false;an()}ad.resolve=function(ai){return ah(ai)?ai:{then:function(ak,aj){return ak(ai)}}};return ad}()}return new (Function.prototype.$asyncbind.EagerThenable)(Z)}if(X){if(Function.prototype.$asyncbind.wrapAsyncStack){X=Function.prototype.$asyncbind.wrapAsyncStack(X)}return aa}function aa(ac,ad){try{return ac&&(ac instanceof Object)&&typeof ac.then==="function"?ac.then(aa,X):ab.call(Y,ac,ad||X)}catch(ae){return(ad||X)(ae)}}function Z(ac,ad){return ab.call(Y,ac,ad)}Z.then=Z;return Z};window.$error=window.$error||function(W){throw W};var Q=I("./lib.js");var L=I("./Exceptions.js");function R(X,W){return(function(ac,Y){var ab,ae,af;function aa(){ab.id=X.getAttribute("id")||null;ab.sequence=parseInt(X.getAttribute("sequence"))||null;return ac(ab)}if(ae=X.getElementsByTagName("Wrapper")[0]){return P(ae,W).then((function(ad){ab=ad;return aa.call(this)}).$asyncbind(this,Y),Y)}else{function Z(){return aa.call(this)}if(af=X.getElementsByTagName("InLine")[0]){return O(af,W).then((function(ad){ab=ad;return Z.call(this)}).$asyncbind(this,Y),Y)}else{return Y(new Error("Bad vast xml scheme. Allow only wrapper and inline"))}return Z.call(this)}}).$asyncbind(this,true)}function P(X,W){return(function(ae,Y){var ag,af,aa,ac,Z,ab;Z=X.getElementsByTagName("VASTAdTagURI")[0].textContent.trim();return V(Z,W).then((function(ad){ag=ad;if(!ag||!ag.ads[0]){return Y(new Error("Bad wrapped vast tag "+Z))}ab=ag.ads[0];if(af=X.getElementsByTagName("Error")[0]){K({error:af.textContent.trim()},ab.creatives)}if(aa=X.getElementsByTagName("Impression")[0]){K({impression:aa.textContent.trim()},ab.creatives)}if(ac=X.getElementsByTagName("Creatives")[0]){Q.map(ac.getElementsByTagName("Creative"),function(aj,ah){var ai=S(aj.getElementsByTagName("TrackingEvents")[0]);K(ai,[ab.creatives[ah]])})}return ae(ab)}).$asyncbind(this,Y),Y)}).$asyncbind(this,true)}function O(X,W){return(function(ac,Y){var ad,ae,ab,Z;ad={title:null,system:null,creatives:[]};if(title_xml=X.getElementsByTagName("AdTitle")[0]){ad.title=title_xml.textContent.trim()}if(system_xml=X.getElementsByTagName("AdSystem")[0]){ad.system=system_xml.textContent.trim()}ae=X.getElementsByTagName("Creative");ab=0;return(function aa(ag,af){function ah(){ab++;return aa(ag,af)}if(ab<ae.length){return U(ae[ab],W).then((function(ai){Z=ai;ad.creatives.push(Z);return void ah.call(this)}).$asyncbind(this,af),af)}else{return void ag()}}).$asyncbind(this).then((function(af){if(error_xml=X.getElementsByTagName("Error")[0]){K({error:error_xml.textContent.trim()},ad.creatives)}if(impression_xml=X.getElementsByTagName("Impression")[0]){K({impression:impression_xml.textContent.trim()},ad.creatives)}ad.creatives.sort(function(ah,ag){return ah.sequence-ag.sequence});return ac(ad)}).$asyncbind(this,Y),Y)}).$asyncbind(this,true)}function U(W){return(function(ac,Y){var Z={type:null,click_thru:null,ad_params:null,files:[],events:{}};Z.id=W.getAttribute("id")||null;Z.sequence=parseInt(W.getAttribute("sequence"))||null;if(creative_xml=W.getElementsByTagName("Linear")[0]){Z.type="linear";Z.skipoffset=(creative_xml.getAttribute("skipoffset")||"").trim()||null;if(ad_parameters_xml=creative_xml.getElementsByTagName("AdParameters")[0]){Z.ad_params=ad_parameters_xml.textContent.trim()}Q.map(creative_xml.getElementsByTagName("MediaFile"),function(ad){var ae={};ae.url=ad.textContent.trim();ae.type=(ad.getAttribute("type")||"").trim()||null;ae.width=parseInt(ad.getAttribute("width"))||null;ae.height=parseInt(ad.getAttribute("height"))||null;ae.is_vpaid=(ad.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";Z.files.push(ae)});if(click_through_xml=creative_xml.getElementsByTagName("ClickThrough")[0]){Z.click_thru=click_through_xml.textContent.trim()}if(click_tracking_xml=creative_xml.getElementsByTagName("ClickTracking")[0]){K({clickthru:click_tracking_xml.textContent.trim()},Z)}}else{if(creative_xml=W.getElementsByTagName("NonLinear")[0]){Z.type="nonlinear";var ab=parseInt(creative_xml.getAttribute("width"))||null;var X=parseInt(creative_xml.getAttribute("height"))||null;if(static_xml=creative_xml.getElementsByTagName("StaticResource")[0]){var aa={};aa.url=static_xml.textContent.trim();aa.type=(static_xml.getAttribute("creativeType")||"").trim()||null;aa.width=ab;aa.height=X;Z.files.push(aa)}}else{if(creative_xml=W.getElementsByTagName("Companion")[0]){Z.type="campanion"}}}if(creative_xml){K(S(creative_xml.getElementsByTagName("TrackingEvents")[0]),Z)}return ac(Z)}).$asyncbind(this,true)}function N(X,W){return(function(af,Y){var ac,ag,ab,aa,ae;ac={version:null,ads:[]};if(!(X=new DOMParser().parseFromString(X,"text/xml"))){return Y(new Error("Bad xml"))}if(!(ag=X.getElementsByTagName("VAST")[0])){return Y(new Error("Bad vast tag. Not found VAST"))}ab=ag.getElementsByTagName("Ad");aa=0;return(function Z(ai,ad){function al(){aa++;return Z(ai,ad)}if(aa<ab.length){function ak(){return void al.call(this)}var ah=(function(am){console.log(am);return ak.call(this)}).$asyncbind(this,ad);try{return R(ab[aa],W).then((function(am){ae=am;ac.ads.push(ae);return ak.call(this)}).$asyncbind(this,ah),ah)}catch(aj){ah(aj)}}else{return void ai()}}).$asyncbind(this).then((function(ad){if(ab.length==0){return Y(new Error("Bad vast tag. Not found Ad"))}ac.ads.sort(function(ai,ah){return ai.sequence-ah.sequence});return af(ac)}).$asyncbind(this,Y),Y)}).$asyncbind(this,true)}function V(X,W){return(function(ab,Y){var aa;W=W||{};var Z=(function(ad){if(ad instanceof Q.HTTPError){if(ad.status==204){return Y(new L.VPAIDError(303))}}console.log(ad);return Y(new L.VPAIDError(100))}).$asyncbind(this,Y);try{return Q.asyncLoad(X,W.timeout).then((function(ad){aa=ad;function af(){return ab()}var ae=(function(ah){console.log(ah);return Y(new L.VPAIDError(100))}).$asyncbind(this,Y);try{return N(aa,W).then(ab,ae)}catch(ag){ae(ag)}}).$asyncbind(this,Z),Z)}catch(ac){Z(ac)}}).$asyncbind(this,true)}function S(W){var X={};if(W&&W.tagName.match(/^TrackingEvents$/i)){Q.map(W.getElementsByTagName("Tracking"),function(Y){var aa={};var Z=Y.getAttribute("event");if(typeof X[Z]==="undefined"){X[Z]=[]}X[Z].push(Y.textContent.trim())})}return X}function K(Z,aa){var aa=aa instanceof Array?aa:[aa];for(var Y in Z){var ab=Z[Y] instanceof Array?Z[Y]:[Z[Y]];for(var X=0;X<aa.length;X++){var W=aa[X];W.events[Y]=(W.events[Y]||[]).concat(ab)}}}J.exports.parse=N;J.exports.load=V}).call(this,I("_process"))},{"./Exceptions.js":3,"./lib.js":10,_process:1}],6:[function(I,J,H){(function(O){Function.prototype.$asyncbind=function N(T,S){var W=this;if(S===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function R(aa){var ab=[];if(!aa){try{aa=O.nextTick}catch(Z){aa=function(ad){setTimeout(ad,0)}}}function X(){for(var af=0;af<ab.length;af+=2){var ae=ab[af+1],ag=ab[af];for(var ad=0;ad<ae.length;ad++){ae[ad].call(null,ag)}}ab=[]}function ac(ad){return ad&&(ad instanceof Object)&&typeof ad.then==="function"}function Y(af){function ai(ap){var ao;if(aj||am<0||(ao=al[am]).length===0){return}ab.push(an,ao);al=[[],[]];if(ab.length===2){ap?X():aa(X)}}function ad(ao){if(am>=0){return}if(ac(ao)){return ao.then(ad,ah)}am=0;an=ao;ai(true)}function ah(ao){if(am>=0){return}if(ac(ao)){return ao.then(ad,ah)}am=1;an=ao;ai(true)}function ag(ap,ao){al[0].push(ap);al[1].push(ao);ai()}function ae(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[am]+"}="+an.toString()}function ak(){try{af.call(null,ad,ah)}catch(ao){ah(ao)}}this.then=ag;this.toString=ae;var al=[[],[]],aj=true,am=-1,an;ak();aj=false;ai()}Y.resolve=function(ad){return ac(ad)?ad:{then:function(af,ae){return af(ad)}}};return Y}()}return new (Function.prototype.$asyncbind.EagerThenable)(U)}if(S){if(Function.prototype.$asyncbind.wrapAsyncStack){S=Function.prototype.$asyncbind.wrapAsyncStack(S)}return V}function V(X,Y){try{return X&&(X instanceof Object)&&typeof X.then==="function"?X.then(V,S):W.call(T,X,Y||S)}catch(Z){return(Y||S)(Z)}}function U(X,Y){return W.call(T,X,Y)}U.then=U;return U};window.$error=window.$error||function(R){throw R};var Q=I("./lib.js");var K=I("./Exceptions.js");var P=I("./VASTParser.js");var M=I("./CreativePlayer.js");J.exports=L;function L(R){if(!R.place){throw new Error("place rquired for VASTPlayer")}this.place=R.place;this.debug=R.debug||false;this.onparse_complete=R.onparse_complete||null;this.timeout={load:5000,mount:30000,start:10000};if(R.timeout){if(typeof R.timeout.load!=="undefined"){this.timeout.load=R.timeout.load}if(typeof R.timeout.mount!=="undefined"){this.timeout.mount=R.timeout.mount}if(typeof R.timeout.start!=="undefined"){this.timeout.start=R.timeout.start}}this.creative_player=new M({video_player:R.video_player||null,vpaid_flash_bridge:R.vpaid_flash_bridge||null,flash_video_player:R.flash_video_player||null,timeout:{mount:this.timeout.mount,start:this.timeout.start}});this.creative_player.eventHandler=(function(T,U){switch(T){case"vpaid":switch(U){case"AdLinearChange":var S=arguments[2];this.eventHandler("change_ad_mode",S?"linear":"nonlinear");break}this.eventHandler("vpaid",arguments[1],arguments[2]);break}}).bind(this);if(this.debug){Q.debug.prefix=R.debug_prefix||null;Q.debug.on()}this.vast=null;this.is_loaded=false}L.prototype={eventHandler:function(){},load:function(R,S){return(function(V,T){function X(){return V()}var U=(function(Y){if(Y.code==303){this.eventHandler("no_content",Y)}else{console.error(Y);this.eventHandler("error",Y)}return X.call(this)}).$asyncbind(this,T);try{return P.load(R,{timeout:this.timeout.load}).then((function(Y){this.vast=Y;if(this.onparse_complete){this.onparse_complete(this.vast)}this.is_loaded=true;this.eventHandler("loaded");return X.call(this)}).$asyncbind(this,U),U)}catch(W){U(W)}}).$asyncbind(this,true)},show:function(){var U,R,S,V;if(!this.is_loaded){throw new Error("Tag not loaded")}return(function T(Y,W){function Z(){return T.$asyncbind(this)(Y,W)}if(U=this.arrayNext(this.vast.ads)){return(function X(ac,aa){function ad(){return X.$asyncbind(this)(ac,aa)}if(S=this.arrayNext(U.creatives)){function ab(){return void ad.call(this)}if(S.type=="linear"){return this.showCreative(S,this.place).then((function(ae){return ab.call(this)}).$asyncbind(this,aa),aa)}return ab.call(this)}else{return void ac()}}).$asyncbind(this).then((function(aa){return void Z.call(this)}).$asyncbind(this,W),W)}else{return void Y()}}).$asyncbind(this).then((function(W){this.eventHandler("done")}).$asyncbind(this,$error),$error)},stop:function(){return(function(S,R){return this.creative_player.stop().then((function(T){return S()}).$asyncbind(this,R),R)}).$asyncbind(this,true)},showCreative:function(S,R){return(function(Y,T){var W,V;function aa(){return Y()}var U=(function(ab){console.error(ab);if(ab instanceof K.VPAIDError){Q.debug.log("VPAID error "+ab.code+" "+ab.message);W=S.events.error;if(W){for(V=0;V<W.length;V++){Q.fire_pixel(W[V],{ERRORCODE:ab.code})}}}return aa.call(this)}).$asyncbind(this,T);try{var X=(function(ac){function ab(){return U(ac)}if(ac instanceof K.NonLinearVPAID){Q.debug.log("Skip. Creative is nonlinear. Change creative type");S.type="nonlinear";return this.creative_player.unmount().then((function(ad){return Y()}).$asyncbind(this,U),U)}return U(ac)}).$asyncbind(this,U);try{Q.debug.log("Try to play linear creative");return this.creative_player.mount(S,R).then((function(ab){return this.creative_player.start().then((function(ac){return aa.call(this)}).$asyncbind(this,U),U)}).$asyncbind(this,X),X)}catch(Z){X(Z)}}catch(Z){U(Z)}}).$asyncbind(this,true)},arrayNext:function(R){R._cur=typeof R._cur==="undefined"?0:R._cur;return R[R._cur++]},arrayReset:function(R){R._cur=0}}}).call(this,I("_process"))},{"./CreativePlayer.js":2,"./Exceptions.js":3,"./VASTParser.js":5,"./lib.js":10,_process:1}],7:[function(I,J,H){(function(O){Function.prototype.$asyncbind=function N(S,R){var V=this;if(R===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function Q(Z){var aa=[];if(!Z){try{Z=O.nextTick}catch(Y){Z=function(ac){setTimeout(ac,0)}}}function W(){for(var ae=0;ae<aa.length;ae+=2){var ad=aa[ae+1],af=aa[ae];for(var ac=0;ac<ad.length;ac++){ad[ac].call(null,af)}}aa=[]}function ab(ac){return ac&&(ac instanceof Object)&&typeof ac.then==="function"}function X(ae){function ah(ao){var an;if(ai||al<0||(an=ak[al]).length===0){return}aa.push(am,an);ak=[[],[]];if(aa.length===2){ao?W():Z(W)}}function ac(an){if(al>=0){return}if(ab(an)){return an.then(ac,ag)}al=0;am=an;ah(true)}function ag(an){if(al>=0){return}if(ab(an)){return an.then(ac,ag)}al=1;am=an;ah(true)}function af(ao,an){ak[0].push(ao);ak[1].push(an);ah()}function ad(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[al]+"}="+am.toString()}function aj(){try{ae.call(null,ac,ag)}catch(an){ag(an)}}this.then=af;this.toString=ad;var ak=[[],[]],ai=true,al=-1,am;aj();ai=false;ah()}X.resolve=function(ac){return ab(ac)?ac:{then:function(ae,ad){return ae(ac)}}};return X}()}return new (Function.prototype.$asyncbind.EagerThenable)(T)}if(R){if(Function.prototype.$asyncbind.wrapAsyncStack){R=Function.prototype.$asyncbind.wrapAsyncStack(R)}return U}function U(W,X){try{return W&&(W instanceof Object)&&typeof W.then==="function"?W.then(U,R):V.call(S,W,X||R)}catch(Y){return(X||R)(Y)}}function T(W,X){return V.call(S,W,X)}T.then=T;return T};window.$error=window.$error||function(Q){throw Q};var L=I("./Exceptions.js");var P=I("./lib.js");var K=["AdLoaded","AdSkipped","AdStarted","AdStopped","AdLinearChange","AdSkippableStateChange","AdSizeChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"];function M(Q,T){this.creative=Q;this.vpaid_flash_bridge=T.vpaid_flash_bridge||null;this.video_element=T.video_player||null;this.allow_flash=T.allow_flash&&P.flash_support();this.file=null;this.methods={};for(var V=0;V<this.creative.files.length;V++){var R=[];var U=this.creative.files[V];if((R=this.get_support_methods(U)).length>0){for(var S=0;S<R.length;S++){var W=R[S];this.methods[W]=this.methods[W]||[];this.methods[W].push(U)}}}this.backend=P.sortByMap(Object.keys(this.methods),["js","flash"])[0];if(!this.backend){throw new Error("No support")}this.file=this.methods[this.backend][0];this.scope=window;this.vpaid=null;this.iframe=null;this.place=null;this.vpaid_version=null;this.has_events={};this.scenario="vast"}M.prototype={eventHandler:function(R,Q){},get_support_methods:function(R,S){if(!R.is_vpaid){return[]}var Q=[];if(["application/javascript","application/x-javascript"].indexOf(R.type)>=0){Q.push("js")}if(this.allow_flash&&R.type=="application/x-shockwave-flash"){Q.push("flash")}return Q},mount:function(Q){return(function(S,R){var T;this.place=Q;T=this.place.ownerDocument;this.scope=T.defaultView||T.parentWindow;P.debug.log("Mount "+this.backend);return this[this.backend+"_mount"]().then((function(U){return S()}).$asyncbind(this,R),R)}).$asyncbind(this,true)},initVPAID:function(Q){return(function(W,S){var U,R,V,T;this.vpaid=Q;if(typeof this.vpaid.subscribe!=="function"){return S(new Error("Bad VPAID: not defined subscribe"))}if(typeof this.vpaid.handshakeVersion!=="function"){return S(new Error("Bad VPAID: not defined handshakeVersion"))}this.vpaid_version=this.vpaid.handshakeVersion("2.0");P.debug.log("VPAID version: "+this.vpaid_version);P.map(K,(function(Y){this._vpaid_subscribe(Y,(function(){var Z=Array.prototype.slice.call(arguments);setTimeout((function(){this.handle_vpaid_event(Y,Z)}).bind(this),0)}).bind(this))}).bind(this));U=this.place.offsetWidth;R=this.place.offsetHeight;P.debug.log("Size: "+U+"x"+R);P.debug.log("Call VPAID initAd "+this.backend);try{if(this.backend=="js"){this.vpaid.initAd(U,R,"normal",500,{AdParameters:this.creative.ad_params},{slot:this.place,videoSlot:this.video_element,videoSlotCanAutoPlay:false})}else{this.vpaid.initAd(U,R,"normal",500,this.creative.ad_params,"")}}catch(X){console.log("error on initAd",X);return S(new L.VPAIDError(901))}V=setTimeout((function(){P.debug.log("ERROR: timeot for AdLoaded");return S(new L.VPAIDError(901))}).bind(this),10000);return this.waitFor(["AdLoaded","AdError"]).then((function(Y){T=Y;clearTimeout(V);if(T.event=="AdLoaded"){return W()}else{return S(new L.VPAIDError(901,T.args[0]))}}).$asyncbind(this,S),S)}).$asyncbind(this,true)},unmount:function(){return(function(R,Q){P.debug.log("start UNMOUNT VPAID");this.remove_event_handlers();if(this.backend=="js"){this.iframe.parentElement.removeChild(this.iframe)}this.vpaid=null;P.debug.log("done UNMOUNT VPAID");return R()}).$asyncbind(this,true)},start:function(){return(function(R,Q){if(this.backend=="js"){this.iframe.contentWindow.onerror=function(T,S){return Q(new Error('Error in vpaid file "'+S+'": '+T))}}this.on_vpaid("AdError",(function(){P.debug.log("VPAID error",JSON.stringify(arguments));return Q(Error("VPAID error"))}).bind(this));this.on_vpaid("AdSkipped",(function(){return R()}).bind(this));this.on_vpaid("AdStarted",(function(){P.debug.log("getAdLinear "+(this.vpaid.getAdLinear()?"yes":"no"));return this.waitFor("AdStopped").then((function(S){return R()}).$asyncbind(this,Q),Q)}).bind(this),true);this.vpaid.startAd()}).$asyncbind(this,true)},stop:function(){return(function(S,Q){this.remove_event_handlers();var R=setTimeout((function(){return this.unmount().then((function(T){return S()}).$asyncbind(this,Q),Q)}).bind(this),5000);this.on_vpaid("AdStopped",(function(){clearTimeout(R);return this.unmount().then((function(T){return S()}).$asyncbind(this,Q),Q)}).bind(this));P.debug.log("call stopAd");this.vpaid.stopAd()}).$asyncbind(this,true)},js_mount:function(){return(function(S,Q){if(!this.video_element){this.video_element=document.createElement("VIDEO");this.video_element.style.position="absolute";this.video_element.style.left=0;this.video_element.style.top=0;this.video_element.style.width="100%";this.video_element.style.height="100%";this.video_element.style.zIndex="-1";this.place.appendChild(this.video_element)}var R=this.iframe=document.createElement("iframe");R.src="javascript:false";R.style.display="none";document.body.appendChild(R);R.contentWindow.document.open();R.contentWindow.document.write('<body style="margin:0; padding:0; width:100%; height:100%;"><script>setTimeout(function(){var s = document.createElement("script");s.onload = trigger_load();s.onerror = trigger_error();s.src = "'+this.file.url+'";document.body.appendChild(s);}, 100);<\/script></body>');R.contentWindow.document.close();R.contentWindow.trigger_error=function(){return Q(new Error("Can't load vpaid file"))};R.contentWindow.trigger_load=(function(){var T,U;U=R.contentWindow.getVPAIDAd;if(typeof U!=="function"){return Q(new Error("Bad VPAID: not defined getVPAIDAd"))}if(!(T=U())){return Q(new Error("Bad VPAID: getVPAIDAd return nothing"))}return this.initVPAID(T).then((function(V){return S()}).$asyncbind(this,Q),Q)}).bind(this)}).$asyncbind(this,true)},flash_mount:function(){return(function(U,Q){var T=null;var R=this._gen_fn_name("vpaid_on_ready");var S=this._gen_fn_name("vpaid_on_error");this.scope[S]=(function(){return Q(new Error("Can't load vpaid file"))}).bind(this);this.scope[R]=(function(){return this.initVPAID(T).then((function(V){return U()}).$asyncbind(this,Q),Q)}).bind(this);T=P.html('<object type="application/x-shockwave-flash" width="100%" height="100%" data="'+this.vpaid_flash_bridge+'"><param name="allowScriptAccess" value="always"></param><param name="allowNetworking" value="all"></param><param name="wmode" value="transparent"><param name="flashvars" value="onReady='+R+"&onError="+S+"&src="+encodeURIComponent(this.file.url)+'"></param></object>');this.place.appendChild(T)}).$asyncbind(this,true)},remove_event_handlers:function(){this.eventHandler=function(){}},_gen_fn_name:function(Q){this.__gen_fn_name_idx=this.__gen_fn_name_idx||0;return Q+Math.random().toString(16).split(".")[1]+(this.__gen_fn_name_idx++).toString()},_vpaid_subscribe:function(S,R){if(this.backend=="js"){this.vpaid.subscribe(R,S)}else{var Q=this._gen_fn_name(S);this.scope[Q]=R;this.vpaid.subscribe(S,Q)}},on_vpaid:function(S,R,Q){this._vpaid_event_handlers=this._vpaid_event_handlers||{};this._vpaid_event_handlers[S]=this._vpaid_event_handlers[S]||[];this._vpaid_event_handlers[S].push({handler:R,one:Q})},handle_vpaid_event:function(S,R){if(S=="AdStarted"){if(this.vpaid.getAdDuration()==-1){P.debug.log("USE GOOGLE TAG SCENARIO");this.scenario="google";this.process_vpaid_event(false,"AdLinearChange",false)}}if(S=="AdLinearChange"){R=this.vpaid.getAdLinear()}if(S=="AdRemainingTimeChange"){var Q=this.vpaid.getAdRemainingTime();var T=this.vpaid.getAdDuration();if(Q<0||T<0){return}if(Q==0){this.process_vpaid_event(true,"AdVideoComplete");this.process_vpaid_event(true,"AdStopped");return}R=Q}if(this.scenario=="google"){if(["AdVideoStart"].indexOf(S)>=0){return}}if(this.scenario=="vast"){}this.process_vpaid_event(false,S,R)},process_vpaid_event:function(Q,U,R){P.debug.log((Q?"Emulate":"Source")+" VPAID event",U);this.has_events[U]=true;this.eventHandler(U,R);var T=null;if(this._vpaid_event_handlers[U]){for(var S=0;S<this._vpaid_event_handlers[U].length;S++){if(T=this._vpaid_event_handlers[U][S]){T.handler.call(this,U,R);if(T.one){this._vpaid_event_handlers[U][S]=null}}}}},waitFor:function(Q){var R=arguments;return(function(V,S){var U=R[0] instanceof Array?R[0]:[R[0]];for(var T=0;T<U.length;T++){this.on_vpaid(U[T],function(X,W){return V({event:X,args:W})},true)}}).$asyncbind(this,true)}};J.exports=M}).call(this,I("_process"))},{"./Exceptions.js":3,"./lib.js":10,_process:1}],8:[function(I,J,H){(function(L){Function.prototype.$asyncbind=function K(P,O){var S=this;if(O===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function N(W){var X=[];if(!W){try{W=L.nextTick}catch(V){W=function(Z){setTimeout(Z,0)}}}function T(){for(var ab=0;ab<X.length;ab+=2){var aa=X[ab+1],ac=X[ab];for(var Z=0;Z<aa.length;Z++){aa[Z].call(null,ac)}}X=[]}function Y(Z){return Z&&(Z instanceof Object)&&typeof Z.then==="function"}function U(ab){function ae(al){var ak;if(af||ai<0||(ak=ah[ai]).length===0){return}X.push(aj,ak);ah=[[],[]];if(X.length===2){al?T():W(T)}}function Z(ak){if(ai>=0){return}if(Y(ak)){return ak.then(Z,ad)}ai=0;aj=ak;ae(true)}function ad(ak){if(ai>=0){return}if(Y(ak)){return ak.then(Z,ad)}ai=1;aj=ak;ae(true)}function ac(al,ak){ah[0].push(al);ah[1].push(ak);ae()}function aa(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[ai]+"}="+aj.toString()}function ag(){try{ab.call(null,Z,ad)}catch(ak){ad(ak)}}this.then=ac;this.toString=aa;var ah=[[],[]],af=true,ai=-1,aj;ag();af=false;ae()}U.resolve=function(Z){return Y(Z)?Z:{then:function(ab,aa){return ab(Z)}}};return U}()}return new (Function.prototype.$asyncbind.EagerThenable)(Q)}if(O){if(Function.prototype.$asyncbind.wrapAsyncStack){O=Function.prototype.$asyncbind.wrapAsyncStack(O)}return R}function R(T,U){try{return T&&(T instanceof Object)&&typeof T.then==="function"?T.then(R,O):S.call(P,T,U||O)}catch(V){return(U||O)(V)}}function Q(T,U){return S.call(P,T,U)}Q.then=Q;return Q};window.$error=window.$error||function(N){throw N};J.exports=M;function M(){this.duration=null;this.currentTime=null;this.dom=null;this.init();this.update()}M.prototype={setDuration:function(N){this.duration=N|0;this.update()},setCurrentTime:function(N){this.currentTime=N|0;this.update()},init:function(){this.dom=document.createElement("div");this.dom.style.position="absolute";this.dom.style.top="0px";this.dom.style.left="0";this.dom.style.right="0";this.dom.style.padding="10px 20px";this.dom.style.color="#fff";this.dom.style.background="rgba(100, 100, 100, 0.5)";this.dom.style.font="12px monospace";this.dom.style.textAlign="right"},update:function(){if(this.duration){var N=Math.max(0,this.duration-this.currentTime);this.dom.innerHTML="Ad: "+this.format_time(N)}else{this.dom.innerHTML="Please wait..."}},format_time:function(O){var N=O/60|0;var O=O-N*60;return("00"+N).substr(-2)+":"+("00"+O).substr(-2)}}}).call(this,I("_process"))},{_process:1}],9:[function(I,J,H){(function(M){Function.prototype.$asyncbind=function L(S,R){var V=this;if(R===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function Q(Z){var aa=[];if(!Z){try{Z=M.nextTick}catch(Y){Z=function(ac){setTimeout(ac,0)}}}function W(){for(var ae=0;ae<aa.length;ae+=2){var ad=aa[ae+1],af=aa[ae];for(var ac=0;ac<ad.length;ac++){ad[ac].call(null,af)}}aa=[]}function ab(ac){return ac&&(ac instanceof Object)&&typeof ac.then==="function"}function X(ae){function ah(ao){var an;if(ai||al<0||(an=ak[al]).length===0){return}aa.push(am,an);ak=[[],[]];if(aa.length===2){ao?W():Z(W)}}function ac(an){if(al>=0){return}if(ab(an)){return an.then(ac,ag)}al=0;am=an;ah(true)}function ag(an){if(al>=0){return}if(ab(an)){return an.then(ac,ag)}al=1;am=an;ah(true)}function af(ao,an){ak[0].push(ao);ak[1].push(an);ah()}function ad(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[al]+"}="+am.toString()}function aj(){try{ae.call(null,ac,ag)}catch(an){ag(an)}}this.then=af;this.toString=ad;var ak=[[],[]],ai=true,al=-1,am;aj();ai=false;ah()}X.resolve=function(ac){return ab(ac)?ac:{then:function(ae,ad){return ae(ac)}}};return X}()}return new (Function.prototype.$asyncbind.EagerThenable)(T)}if(R){if(Function.prototype.$asyncbind.wrapAsyncStack){R=Function.prototype.$asyncbind.wrapAsyncStack(R)}return U}function U(W,X){try{return W&&(W instanceof Object)&&typeof W.then==="function"?W.then(U,R):V.call(S,W,X||R)}catch(Y){return(X||R)(Y)}}function T(W,X){return V.call(S,W,X)}T.then=T;return T};window.$error=window.$error||function(Q){throw Q};var K=I("./Exceptions.js");var P=I("./VideoAdUI.js");var N=I("./lib.js");J.exports=O;function O(Q,T){this.creative=Q;this.video_player=T.video_player||null;this.flash_video_player=T.flash_video_player||null;this.click_thru=Q.click_thru||null;this.video=null;this.file=null;this.methods=[];for(var V=0;V<this.creative.files.length;V++){var R=[];var U=this.creative.files[V];if((R=this.get_support_methods(U)).length>0){for(var S=0;S<R.length;S++){var W=R[S];this.methods[W]=this.methods[W]||[];this.methods[W].push(U)}}}this.backend=N.sortByMap(Object.keys(this.methods),["native","hls","flash"])[0];if(!this.backend){throw new Error("No support")}this.file=this.methods[this.backend][0];this.place=null;this.ui=null}O.prototype={eventHandler:function(R,Q){},get_support_methods:function(R){if(R.is_vpaid){return[]}var Q=[];if(["maybe","probably"].indexOf(document.createElement("VIDEO").canPlayType(R.type))>=0){Q.push("native")}if(this.allow_flash&&["video/mp4","video/flv","video/x-flv","video/m4v","application/x-mpegURL"].indexOf(R.type)>=0){Q.push("flash")}return Q},mount:function(Q){return(function(S,R){this.place=Q;N.debug.log("Mount "+this.backend);return this["mount_"+this.backend](Q).then((function(T){if(this.click_thru){this.video.addEventListener("click",(function(){this.eventHandler("AdClickThru",true)}).bind(this))}return S()}).$asyncbind(this,R),R)}).$asyncbind(this,true)},mount_native:function(){return(function(R,Q){if(!this.video_player){this.video_player=document.createElement("VIDEO")}this.place.appendChild(this.video_player);this.video=this.video_player;return R()}).$asyncbind(this,true)},mount_flash:function(){return(function(U,Q){if(!this.flash_video_player){return Q(new Error("Bad config for video player. Not set flash_video_player url"))}this.video=document.createElement("OBJECT");this.video.setAttribute("type","application/x-shockwave-flash");this.video.setAttribute("width","100%");this.video.setAttribute("height","100%");this.video.setAttribute("data",this.flash_video_player);var W={wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all",quality:"high"};for(var R in W){var V=document.createElement("PARAM");V.setAttribute("name",R);V.setAttribute("value",W[R]);this.video.appendChild(V)}this.place.appendChild(this.video);var T=new Date().getTime();var S=setInterval((function(){var X=new Date().getTime()-T;if(this.video.vjs_setProperty){clearInterval(S);return U()}else{if(X>5000){clearInterval(S);return Q(new K.VPAIDError(402))}}}).bind(this),10)}).$asyncbind(this,true)},unmount:function(){return(function(R,Q){if(this.backend=="flash"){clearInterval(this._flash_time_interval)}if(this.video.parentElement){this.video.parentElement.removeChild(this.video)}this.video=null;this.eventHandler=O.prototype.eventHandler;N.debug.log("UNMOUNT VIDEO");return R()}).$asyncbind(this,true)},stop:function(){return(function(R,Q){return this.unmount().then((function(S){return R()}).$asyncbind(this,Q),Q)}).$asyncbind(this,true)},start:function(){return(function(R,Q){N.debug.log("Play "+this.backend);return this.initUI().then((function(S){return this["play_"+this.backend]().then((function(T){return this.destroyUI().then((function(U){this.eventHandler("AdStopped");return R()}).$asyncbind(this,Q),Q)}).$asyncbind(this,Q),Q)}).$asyncbind(this,Q),Q)}).$asyncbind(this,true)},initUI:function(){return(function(R,Q){this.ui=new P();this.place.appendChild(this.ui.dom);return R()}).$asyncbind(this,true)},destroyUI:function(){return(function(R,Q){this.place.removeChild(this.ui.dom);return R()}).$asyncbind(this,true)},play_native:function(){return(function(R,Q){this.video.addEventListener("canplay",(function(){this.eventHandler("AdStarted");try{this.video.play()}catch(S){}}).bind(this));this.video.addEventListener("timeupdate",(function(){if(!this.video||!this.video.duration||!this.video.currentTime){return}if(this.handleChangeProgress(this.video.currentTime,this.video.duration)){return R()}}).bind(this));this.video.src=this.file.url;this.video.load()}).$asyncbind(this,true)},play_flash:function(){return(function(R,Q){this.video.vjs_setProperty("eventProxyFunction",this._flashFn((function(T,S){}).bind(this)));this.video.vjs_setProperty("errorEventProxyFunction",this._flashFn((function(T,S){console.log("flash video error",arguments)}).bind(this)));this._flash_time_interval=setInterval((function(){var T=this.video.vjs_getProperty("duration");var S=this.video.vjs_getProperty("currentTime");if(!S||!T){return}if(this.handleChangeProgress(S,T)){clearInterval(this._flash_time_interval);return R()}}).bind(this),500);this.video.vjs_src(this.file.url);this.video.vjs_load();this.video.vjs_play()}).$asyncbind(this,true)},handleChangeProgress:function(R,S){this._step=this._step||1;var Q=R/S*100;this.ui.setDuration(S);this.ui.setCurrentTime(R);if(Q>=0&&this._step==1){this._step++;this.eventHandler("AdStarted");this.eventHandler("AdImpression");this.eventHandler("AdVideoStart")}if(Q>=25&&this._step==2){this._step++;this.eventHandler("AdVideoFirstQuartile")}if(Q>=50&&this._step==3){this._step++;this.eventHandler("AdVideoMidpoint")}if(Q>=75&&this._step==4){this._step++;this.eventHandler("AdVideoThirdQuartile")}if(Q>=99&&this._step==5&&S-R<0.5){this._step++;this.eventHandler("AdVideoComplete");return true}},_flashFn:function(S){var T=this.place.ownerDocument;var R=T.defaultView||T.parentWindow;var Q="window";var U="__"+Math.random().toString(16).split(".")[1];R[U]=function(){S.apply(R,arguments)};return Q+"."+U}}}).call(this,I("_process"))},{"./Exceptions.js":3,"./VideoAdUI.js":8,"./lib.js":10,_process:1}],10:[function(I,J,H){(function(L){Function.prototype.$asyncbind=function U(ab,aa){var ae=this;if(aa===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function Z(ai){var aj=[];if(!ai){try{ai=L.nextTick}catch(ah){ai=function(al){setTimeout(al,0)}}}function af(){for(var an=0;an<aj.length;an+=2){var am=aj[an+1],ao=aj[an];for(var al=0;al<am.length;al++){am[al].call(null,ao)}}aj=[]}function ak(al){return al&&(al instanceof Object)&&typeof al.then==="function"}function ag(an){function aq(ay){var ax;if(ar||av<0||(ax=au[av]).length===0){return}aj.push(aw,ax);au=[[],[]];if(aj.length===2){ay?af():ai(af)}}function al(ax){if(av>=0){return}if(ak(ax)){return ax.then(al,ap)}av=0;aw=ax;aq(true)}function ap(ax){if(av>=0){return}if(ak(ax)){return ax.then(al,ap)}av=1;aw=ax;aq(true)}function ao(ay,ax){au[0].push(ay);au[1].push(ax);aq()}function am(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[av]+"}="+aw.toString()}function at(){try{an.call(null,al,ap)}catch(ax){ap(ax)}}this.then=ao;this.toString=am;var au=[[],[]],ar=true,av=-1,aw;at();ar=false;aq()}ag.resolve=function(al){return ak(al)?al:{then:function(an,am){return an(al)}}};return ag}()}return new (Function.prototype.$asyncbind.EagerThenable)(ac)}if(aa){if(Function.prototype.$asyncbind.wrapAsyncStack){aa=Function.prototype.$asyncbind.wrapAsyncStack(aa)}return ad}function ad(af,ag){try{return af&&(af instanceof Object)&&typeof af.then==="function"?af.then(ad,aa):ae.call(ab,af,ag||aa)}catch(ah){return(ag||aa)(ah)}}function ac(af,ag){return ae.call(ab,af,ag)}ac.then=ac;return ac};window.$error=window.$error||function(Z){throw Z};J.exports.HTTPError=S;function S(Z){this.status=Z.status;this.xhr=Z}J.exports.html=O;function O(Z){var aa=document.createElement("DIV");aa.innerHTML=Z;return aa.firstChild}J.exports.extend_url=X;function X(Z,ab){var aa=new Date().getTime()/1000|0;var ab=R({CACHEBUSTER:aa,CACHE_BUSTER:aa,timestamp:aa},ab);K(Object.keys(ab),function(ac){Z=Z.replace("["+ac+"]",encodeURIComponent(ab[ac]))});return Z}J.exports.open_window=M;function M(Z,aa){var aa=aa||{};window.open(X(Z,aa),"_blank")}var V={count:0};J.exports.fire_pixel_info=V;J.exports.fire_pixel=W;function W(Z,ab){var ab=ab||{};var Z=X(Z,ab);J.exports.debug.log("Fire pixel "+Z);var aa=document.createElement("iframe");aa.style.display="none";V.count++;aa.onload=(aa.onerror=function(){V.count--;this.parentElement.removeChild(this)});aa.src=Z;document.body.appendChild(aa)}function P(){if(window.XDomainRequest){return new XDomainRequest()}else{if(window.XMLHttpRequest){return new XMLHttpRequest()}else{return false}}}J.exports.asyncLoad=function(Z,aa){return(function(ac,ab){var ad=P();ad.onload=function(){if(ad.status!==200){return ab(new S(ad))}return ac(ad.responseText)};ad.onerror=function(){return ab(new S(ad))};ad.open("GET",Z,true);ad.send(null)}).$asyncbind(this,true)};J.exports.load=function(aa,ad){var Z=this;var ac=P();ac.onload=function(){if(ad){ad(true,ac.responseText)}};ac.onerror=function(){if(ad){ad(false,null)}};ac.open("GET",aa,true);try{ac.send(null)}catch(ab){ad(false,null)}return ac};J.exports.getDeviceInfo=function(){var Z,aa={};if(Z=navigator.userAgent.match(/\bandroid\s(\d+)\.(\d+)(\.(\d+))?\b/i)){aa.is_android=true;aa.version=[Z[1]|0,Z[2]|0,Z[4]|0]}else{if(/iPhone/.test(navigator.platform)||/iPhone/.test(navigator.userAgent)){aa.is_iphone=true}else{if(/iPad/.test(navigator.platform)||/iPad/.test(navigator.userAgent)){aa.is_ipad=true}else{if(/iPod/.test(navigator.platform)||/iPod/.test(navigator.userAgent)){aa.is_ipod=true}}}}aa.is_mobile=aa.is_android||aa.is_iphone||aa.is_ipad||aa.is_ipod;return aa};J.exports.flash_support=function(){var Z=navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description;return !(!Z)};J.exports.wait=function(ab,ac){var aa=new Date().getTime();var Z=setInterval(function(){var ad=new Date().getTime()-aa;if(ad>=ab){clearInterval(Z);ac()}},100);return Z};J.exports.map=K;function K(ab,aa){if(ab){for(var Z=0;Z<ab.length;Z++){if(aa(ab[Z],Z)===false){break}}}}J.exports.is_object=Q;function Q(Z){return typeof Z==="object"&&Z!==null&&Z.constructor===Object}J.exports.is_empty=N;function N(Z){return Z?Q(Z)?Object.keys(Z).length==0:Z.length==0:true}J.exports.extend=R;function R(aa,Z){K(Object.keys(Z),function(ab){if(Q(aa[ab])&&Q(Z[ab])&&!N(aa[ab])){R(aa[ab],Z[ab])}else{aa[ab]=Z[ab]}});return aa}J.exports.clone=T;function T(Z){return JSON.parse(JSON.stringify(Z))}J.exports.debug={enable:false,prefix:null,on:function(){this.enable=true},off:function(){this.enable=false},log:function(){if(this.enable){var ac=new Date();var ab=this.prefix?"["+this.prefix+"]":"";var Z=("0"+ac.getHours()).substr(-2)+":"+("0"+ac.getMinutes()).substr(-2)+":"+("0"+ac.getSeconds()).substr(-2);var aa=ab+"[DEBUG]["+Z+"]"+[].join.call(arguments," ");console.info(aa)}}};J.exports.sortByMap=Y;function Y(ab,ac){var Z=ac.filter(function(ad){return ab.indexOf(ad)>=0});var aa=ab.filter(function(ad){return ac.indexOf(ad)<0});return Z.concat(aa)}}).call(this,I("_process"))},{_process:1}],11:[function(I,J,H){(function(L){Function.prototype.$asyncbind=function K(O,N){var R=this;if(N===true){if(!Function.prototype.$asyncbind.EagerThenable){Function.prototype.$asyncbind.EagerThenable=function M(V){var W=[];if(!V){try{V=L.nextTick}catch(U){V=function(Y){setTimeout(Y,0)}}}function S(){for(var aa=0;aa<W.length;aa+=2){var Z=W[aa+1],ab=W[aa];for(var Y=0;Y<Z.length;Y++){Z[Y].call(null,ab)}}W=[]}function X(Y){return Y&&(Y instanceof Object)&&typeof Y.then==="function"}function T(aa){function ad(ak){var aj;if(ae||ah<0||(aj=ag[ah]).length===0){return}W.push(ai,aj);ag=[[],[]];if(W.length===2){ak?S():V(S)}}function Y(aj){if(ah>=0){return}if(X(aj)){return aj.then(Y,ac)}ah=0;ai=aj;ad(true)}function ac(aj){if(ah>=0){return}if(X(aj)){return aj.then(Y,ac)}ah=1;ai=aj;ad(true)}function ab(ak,aj){ag[0].push(ak);ag[1].push(aj);ad()}function Z(){return"EagerThenable{"+{"-1":"pending",0:"resolved",1:"rejected"}[ah]+"}="+ai.toString()}function af(){try{aa.call(null,Y,ac)}catch(aj){ac(aj)}}this.then=ab;this.toString=Z;var ag=[[],[]],ae=true,ah=-1,ai;af();ae=false;ad()}T.resolve=function(Y){return X(Y)?Y:{then:function(aa,Z){return aa(Y)}}};return T}()}return new (Function.prototype.$asyncbind.EagerThenable)(P)}if(N){if(Function.prototype.$asyncbind.wrapAsyncStack){N=Function.prototype.$asyncbind.wrapAsyncStack(N)}return Q}function Q(S,T){try{return S&&(S instanceof Object)&&typeof S.then==="function"?S.then(Q,N):R.call(O,S,T||N)}catch(U){return(T||N)(U)}}function P(S,T){return R.call(O,S,T)}P.then=P;return P};window.$error=window.$error||function(M){throw M};F.VASTPlayer=I("./VASTPlayer.js")}).call(this,I("_process"))},{"./VASTPlayer.js":6,_process:1}]},{},[11]);var D=F.VASTPlayer;function E(J,I){var H=this;this.player=J;this.conf={debug:false,vpaid_flash_bridge:"vpaid_bridge.swf",schedule:[],companion_places:[],onlineardone:function(){},onvastevent:function(){},onvasterror:function(){}};s(this.conf,I);if(this.conf.debug){q.on()}this.vast_player=null;this.ad_place=j('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');this.queue=[];y(this.conf.schedule,function(L){var L=s({offset:"pre",tag:null,onvastevent:function(){},onvasterror:function(){},prepareXML:null},L);if(typeof L.tag==="function"){L.tag=L.tag()}if(L.offset=="pre"){H.player.one("play",function(N){H.processVast(L)})}if(L.offset=="post"){H.player.on("timeupdate",function(N,O){if((H.player.getDuration()-O)<=2){N.handler.remove();H.processVast(L)}})}if(m=/^(\d+)$/.exec(L.offset)){var K=m[1]|0;H.player.on("timeupdate",function(N,O){if(O>K){N.handler.remove();H.processVast(L)}})}if(m=/^(\d+)%$/.exec(L.offset)){var M=m[1]|0;H.player.on("timeupdate",function(N){if(H.player.getProgress()>M){N.handler.remove();H.processVast(L)}})}})}E.prototype={processVast:function(O){var U=O.tag;var M=null;var K=ctrl.conf.useMobileFallback&&e().is_mobile;var N=this.player.backend;var H=null;var R=null;var L={debug:this.conf.debug,debug_prefix:"PLAYER",place:this.ad_place,timeout:{load:null,mount:null,start:null},vpaid_flash_bridge:this.conf.vpaid_flash_bridge,flash_video_player:this.player.conf.backend_options.flash_swf};var P=this.player.root.getElementsByClassName("ui")[0];var T=function(){if(K){P.style.display="block"}P.getElementsByClassName("loader")[0].style.visibility="hidden";P.getElementsByClassName("start-screen")[0].style.visibility="hidden";P.getElementsByClassName("controls")[0].style.visibility="hidden"};var Q=function(){if(K){P.style.display="none"}P.getElementsByClassName("loader")[0].style.visibility="";P.getElementsByClassName("start-screen")[0].style.visibility="";P.getElementsByClassName("controls")[0].style.visibility=""};var J=function(){if(M=="linear"){return}M="linear";T();this.player.pause();this.ad_place.style.background="#000";this.ad_place.style.zIndex=1000;this.ad_place.style.top=0}.bind(this);var S=function(){if(M=="nonlinear"){return}M="nonlinear";Q();this.ad_place.style.background="transparent";this.ad_place.style.zIndex=5;this.ad_place.style.top="-40px";this.player.play()}.bind(this);P.appendChild(this.ad_place);var I=this.vast_player=new D(L);I.eventHandler=function(V,W){switch(V){case"loaded":I.show();break;case"change_ad_mode":switch(W){case"linear":J();break;default:S();break}break;case"vpaid":this.conf.onvastevent(arguments[1],arguments[2],null);break;case"done":S();P.removeChild(this.ad_place);break;case"error":this.conf.onvasterror();S();break}if(V=="done"||V=="error"){this.conf.onlineardone(V)}}.bind(this);J();I.load(U)}};return E})();z.prototype.__plugins.VAST=VASTPlugin;function a(F,E){var D=this;this.player=F;this.conf={bigClass:"big",target:document.body};s(this.conf,E);this.state=c(D.conf.target,D.conf.bigClass);this.btn=j('<div class="big">	<svg>		<path d="M18.984 17.016v-10.031h-13.969v10.031h13.969zM18.984 5.016c1.078 0 2.016 0.891 2.016 1.969v10.031c0 1.078-0.938 1.969-2.016 1.969h-13.969c-1.078 0-2.016-0.891-2.016-1.969v-10.031c0-1.078 0.938-1.969 2.016-1.969h13.969z"></path>		<path d="M18.984 15v-6h-13.969v6h13.969zM18.984 6.984c1.078 0 2.016 0.938 2.016 2.016v6c0 1.078-0.938 2.016-2.016 2.016h-13.969c-1.078 0-2.016-0.938-2.016-2.016v-6c0-1.078 0.938-2.016 2.016-2.016h13.969z"></path>	</svg></div>');this.player.on("tray_ready",function(H,G){if(G.lastChild&&G.lastChild.className=="fullscreen"){G.insertBefore(this.btn,G.lastChild)}else{G.appendChild(this.btn)}var I=this.btn.getElementsByTagName("path");function J(){if(D.state){D.btn.title="Default screen";k(D.conf.target,D.conf.bigClass);I[0].style.display="none";I[1].style.display=""}else{D.btn.title="Wide screen";n(D.conf.target,D.conf.bigClass);I[1].style.display="none";I[0].style.display=""}}J();i(this.btn,"click",function(){D.state=!D.state;J()})},this)}z.prototype.__plugins.BigMode=a;function g(F,E){var D=this;this.conf={src:null,href:null,title:null,width:null,height:null};this.player=F;s(this.conf,E);if(!this.conf.src){return}this.icon=j('<a target="_blank"></a>');this.icon.style.position="absolute";this.icon.style.zIndex=200;this.icon.style.top="1%";this.icon.style.right="1%";this.icon.style.opacity=0.5;this.icon.style.display="none";if(this.conf.href){this.icon.href=this.conf.href}if(this.conf.title){this.icon.title=this.conf.title}this.img=new Image;this.img.src=this.conf.src;if(this.conf.width){this.img.width=this.conf.width}if(this.conf.height){this.img.height=this.conf.height}this.icon.appendChild(this.img);this.player.root.appendChild(this.icon);this.player.on("play",function(){D.icon.style.display=""});i(this.icon,"click",function(){D.player.pause()});i(this.icon,"mouseover",function(){this.style.opacity=1});i(this.icon,"mouseout",function(){this.style.opacity=0.5})}z.prototype.__plugins.Icon=g;return function(D,E){var E=w({allow_backends:["HTML5","Flash"],controls:{}},E);var F=new z(D,E);if(E.controls){ctrl=new o(F,s({useMobileFallback:true,poster:E.poster},E.controls));F._controls=ctrl;ctrl.on(["play","pause","mute","unmute"],function(G){F[G.type]()});ctrl.on("positionchange",function(H,G){F.setProgress(G*100)});ctrl.on("volumechange",function(H,G){F.setVolume(G)});if(F._plugins.FullScreen){ctrl.on("fullscreentoggle",function(){var G=F._plugins.FullScreen;if(G.is_fullscreen){G.exitFullscreen()}else{G.requestFullscreen()}});ctrl.on("exitfullscreen",function(){F._plugins.FullScreen.exitFullscreen()})}D.appendChild(ctrl.getElement())}return F}})();window.CustomPlayer.version="c0db06a.1513150849";